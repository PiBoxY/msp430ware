<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>MSP PMBus Library Users Guide: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
    <img alt="Logo" width=25% src="ti_hz_2c_pos_rgb_png.png"/>
    <table cellspacing="0" cellpadding="0">
        <tbody>
        <tr style="height: 56px;">
            <td style="padding-left: 0.5em;">
                <div id="projectname">MSP PMBus Library Users Guide
                    &#160;<span id="projectnumber">v1.00.00.00</span>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ch03_Examples.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section describes the examples included with the PMBus library.</p>
<h1><a class="anchor" id="ch03_sec01"></a>
Supported Devices</h1>
<p>The PMBus library examples were developed and tested in the following MSP430&trade; families of devices:</p>
<center> <table class="doxtable">
<tr>
<th align="left">Device </th><th align="left">I2C Interface  </th></tr>
<tr>
<td align="left">MSP430FR59xx </td><td align="left">Enhanced Universal Serial Communication Interface (eUSCI) </td></tr>
<tr>
<td align="left">MSP430G2xx3 </td><td align="left">Universal Serial Communication Interface (USCI) </td></tr>
</table>
<p><b>MSP430 devices supported by PMBus library examples</b> </center><p>The code examples and PMBus library can be implemented in different derivatives of the same family with little effort, and they can be migrated to other MSP430&trade; devices with the same I2C interface with some considerations such as pin usage, memory and timeout-timer availability.</p>
<h1><a class="anchor" id="ch03_sec02"></a>
Summary of the examples</h1>
<p>Each example in this software package is provided with full source code and includes the necessary project files to build the project in IAR and CCS.</p>
<p>Each of the examples are written as PMBus master application communicating to a <a href="http://www.ti.com/product/tps544c20">TPS544C20</a>.</p>
<center> <table class="doxtable">
<tr>
<th align="left">Name </th><th align="left">Description  </th></tr>
<tr>
<td align="left">PMBus_Master01_TPS544C20 </td><td align="left">Basic PMBus communication </td></tr>
<tr>
<td align="left">PMBus_Master02_TPS544C20_SMBAlert </td><td align="left">PMBus with SMBALERT </td></tr>
<tr>
<td align="left">PMBus_Master03_TPS544C20_Control </td><td align="left">PMBus with device on/off through CONTROL line </td></tr>
</table>
<p><b>PMBus library examples</b> </center><p>The hardware setup and their funtionality are described in more detail in the following sections.</p>
<h1><a class="anchor" id="ch03_sec03"></a>
Running the examples</h1>
<h2><a class="anchor" id="ch03_sec03_01"></a>
Obtaining Code Composer Studio (CCS) or IAR Kickstart</h2>
<p>The PMBus library and examples build and run on both the <a href="http://www.ti.com/lsds/ti/microcontroller/16-bit_msp430/tools_software.page">IAR and CodeComposer Studio(CCS)</a> environments for MSP430&trade; microcontrollers. See the Release Notes in the PMBus library package for specific IAR and CCS version information.</p>
<p>IAR and CCS are both available in free, code-size-limited versions (8K and 16k, respectively, of object code). Applications that require less than 8K of memory can be run on both free versions. Applications that require more than 8K of memory cannot be build using the free IAR Ickstart tool. Instead, the free version of CCS can be used, or a licensed version of either environment.</p>
<h2><a class="anchor" id="ch03_sec03_02"></a>
Hardware support</h2>
<p>Most of the examples can run on any hardware TI sells in the eStore, supporting the devices mentioned in the <a class="el" href="ch03_Examples.html#ch03_sec01">Supported Devices</a>Supported Devices"". This includes:</p><ul>
<li>FR5969 LaunchPad (<a href="http://www.ti.com/msp-exp430fr5969">MSP-EXP430FR5969</a>)</li>
<li>MSP430&trade; Value Line Launchpad (<a href="http://www.ti.com/tool/msp-exp430G2">MSP-EXP430G2</a>)</li>
<li>Any FET target board for supported MSP430&trade; derivatives</li>
</ul>
<p>Every example has a HAL layer which can be used to initialize ports, clocks and any other hardware used by the application and PMBus/SMBus layers.</p>
<p>The following tables list the resources used by the examples:</p>
<center> <table class="doxtable">
<tr>
<th align="left">Description </th><th align="left">Resource  </th></tr>
<tr>
<td align="left">I2C </td><td align="left">eUSCI_B0 </td></tr>
<tr>
<td align="left">I2C_SDA </td><td align="left">P1.6/USCB0SDA </td></tr>
<tr>
<td align="left">I2C_SCL </td><td align="left">P1.7/USCB0SCL </td></tr>
<tr>
<td align="left">SMBAlert </td><td align="left">P1.5 </td></tr>
<tr>
<td align="left">Control1 </td><td align="left">P1.4 </td></tr>
<tr>
<td align="left">Control2 </td><td align="left">P1.3 </td></tr>
<tr>
<td align="left">LED0 </td><td align="left">P1.0 </td></tr>
<tr>
<td align="left">LED1 </td><td align="left">P4.6 </td></tr>
</table>
<p><b>MSP430FR59xx examples</b> </center><center> <table class="doxtable">
<tr>
<th align="left">Description </th><th align="left">Resource  </th></tr>
<tr>
<td align="left">I2C </td><td align="left">USCI_B0 </td></tr>
<tr>
<td align="left">I2C_SDA </td><td align="left">P1.7/USCB0SDA </td></tr>
<tr>
<td align="left">I2C_SCL </td><td align="left">P1.6/USCB0SCL </td></tr>
<tr>
<td align="left">SMBAlert </td><td align="left">P2.5 </td></tr>
<tr>
<td align="left">Control1 </td><td align="left">P2.4 </td></tr>
<tr>
<td align="left">Control1 </td><td align="left">P2.3 </td></tr>
<tr>
<td align="left">LED0 </td><td align="left">P1.0 </td></tr>
<tr>
<td align="left">LED1 </td><td align="left">P2.0 </td></tr>
</table>
<p><b>MSP430G2xx3 examples</b> </center><h2><a class="anchor" id="ch03_sec03_03"></a>
Obtaining and building the examples</h2>
<p>The PMBus Library examples have the following structure: </p><pre class="fragment">&lt;install&gt;
  |--smbuslib           &lt;- SMBus Library source code
  |    |--driverlib     &lt;- MSP430 driverlib used to access the microcontroller peripherals
  |--src                &lt;- Contains the PMBus Library source code
  |--examples
       |--MSP430*       &lt;- MSP430 device supported by examples
            |--CCS
            |    |--PMB*.projectspec  &lt;-- Individual project files for CCS  
            |
            |--IAR
            |    |--PMB*
            |         |--*.{ewd,ewp}  &lt;-- Individual project files for IAR
            |         |--*.eww        &lt;-- Project workspace file for IAR
            |--Src
                 |--PMB*
                      |-- main.c           &lt;-- The example main code
                      |-- Master_HAL.{h,c} &lt;-- Hardware abstraction layer for example
                      |-- *.{h,c}          &lt;-- Other source files used by example
</pre><h3><a class="anchor" id="ch03_sec03_03_01"></a>
IAR projects</h3>
<p>Each IAR project has a workspace. To use the examples in IAR, open the corresponding workspace file (*.eww) by selecting File-&gt;Open-&gt;Workspace.</p>
<p>The project can be build using the F&amp; key, Menu-&gt;Project-&gt;rebuild All, or clicking on the <em>Make</em> icon. Projects can be downloaded to the MSP430&trade; microcontroller using Ctrl+D, Menu-&gt;Project-&gt;Download, or by clicking the <em>Download and Debug</em> icon.</p>
<div class="image">
<img src="IAR_build.png" alt="IAR_build.png"/>
<div class="caption">
IAR project build and debug icons</div></div>
  <h3><a class="anchor" id="ch03_sec03_03_02"></a>
CCS projects</h3>
<p>CCS project must be imported into a CCS workspace. The projects are defined by *.projectspec files, which contain the information CCS needs to import the project.</p>
<p>Open CCS, and choose Project-&gt;Import CCS Projects. Browse to the examples/MSP430*/CCS directory (containing the *.projectspec) files). CCS will show a list of all the projects that were discovered in this directory.</p>
<p>Select any projects and click "Finish". The project(s) should appear in the <em>Project Explorer</em> view.</p>
<div class="image">
<img src="CCS_project_import.png" alt="CCS_project_import.png"/>
<div class="caption">
Importing CCS projects</div></div>
  <p>The active project can be selected by simply left-clicking on the project and it will be highlighted with bold letters as shown in the following figure:</p>
<div class="image">
<img src="CCS_project_view.png" alt="CCS_project_view.png"/>
<div class="caption">
Active project in CCS</div></div>
  <p>The project can be built using Ctrl+B, Menu-&gt;Project-&gt;Build All, or by clicking the <em>Build</em> icon. Projects can be downloaded to the MSP430&trade; microcontroller using F11, Menu-&gt;Run-&gt;Debug, or by by clicking the <em>Debug</em> icon.</p>
<div class="image">
<img src="CCS_build.png" alt="CCS_build.png"/>
<div class="caption">
CCS project build and debug icons</div></div>
  <h1><a class="anchor" id="ch03_sec04"></a>
Example Descriptions</h1>
<p>This section contains information that is common to all PMBus examples. Specific information for each example is provided after this section.</p>
<h2><a class="anchor" id="ch03_sec04_01"></a>
Hardware connection</h2>
<p>The required basic connection between Master and Slave PMBus devices is shown below.</p>
<div class="image">
<img src="MasterSlaveConnection.png" alt="MasterSlaveConnection.png"/>
<div class="caption">
Basic connection between Master and Slave</div></div>
  <p>The pins used for SDA and SCL for the supported devies are described in the <a class="el" href="ch03_Examples.html#ch03_sec03_02">_Hardware Support_</a> section.</p>
<p>The value of the pull-up resistors (Rp) will depend on the system VDD and the bus capacitance. Typical values are in the range of 1K-10K ohms.</p>
<h2><a class="anchor" id="ch03_sec04_02"></a>
Building and excuting the examples</h2>
<ol type="1">
<li>Select and example and import the project into CCS or IAR</li>
<li>Connect the master and slave devices. All of the examples are written as PMBus master application communicating to a <a href="http://www.ti.com/product/tps544c20">TPS544C20</a>. With minor modifications, each example could be modified to work with any PMBus compliant device.</li>
</ol>
<pre class="fragment">                             /|\  /|\
                             Rp    Rp
                Master        |    |        Slave
                MSP430        |    |        TPS544C20
          -----------------   |    |      -------------
         |             SDA*|&lt;-|----+----&gt; |DATA       |
         |                 |  |           |           |--&gt; VOUT
         |             SCL*|&lt;-+---------&gt; |CLK        |
         |       /|\       |              |           |
 LED0 &lt;--|Px.y*   |---Pb.c*|&lt;-------------|SMBAlert   |
 LED1 &lt;--|Pz.a*            |              |           |
         |                 |              |           |
         |         Control*|-------------&gt;|CNTL       | 
</pre><ol type="1">
<li>Open, build and download the example project to the MSP430&trade; device</li>
<li>Check the results as described in the individual example section below.</li>
</ol>
<p>Check the comments in the source code for each example for detailed information of the example functions.</p>
<h2><a class="anchor" id="ch03_sec04_03"></a>
PMBus_Master01_TPS544C20</h2>
<p>This example configures some parameters of the TPS544C20 to illustrate some basic calls of the PMBus Library.</p>
<p>After initializing the MSP430&trade; device and GPIO the example will:</p><ol type="1">
<li>Initialize the PMBus library</li>
<li>Verify the DEVICE_CODE for the TPS544C20</li>
<li>Write the PMBus VIN_OFF command to set the value of the input voltage at wich the unit should stop power conversion</li>
<li>Write the PMBus VIN_ON command to set the value of the input voltage at wich the unit should start power conversion</li>
<li>Write the PMBus IOUT_OC_WARN_LIMIT command to set the value of the output current that cause an output overcurrent warning</li>
<li>Write the PMBus ON_OFF_CONFIG and PMB_OPERATION commands to turn on the TPS544C20</li>
</ol>
<h2><a class="anchor" id="ch03_sec04_04"></a>
PMBus_Master02_TPS544C20_SMBAlert</h2>
<p>This example configures the TPS544C20 and enables SMBAlert functionality. When an alert is detected by the slave device, the MSP430 reads the fault and clears the flag. If enabled, MSP430 will send an ARA packet to double-check if the TPS544C20 is the device asserting the SMBAlert line.</p>
<p>The example can be tested by lowering the TPS544C20's VIN.</p>
<p>After initializing the MSP430&trade; device and GPIO the example will:</p><ol type="1">
<li>Initialize the PMBus library</li>
<li>Clear SMBAlert interrupt flags and eanble SMBAlert interrupts</li>
<li>Verify the DEVICE_CODE for the TPS544C20</li>
<li>Write the PMBus VIN_OFF command to set the value of the input voltage at wich the unit should stop power conversion</li>
<li>Write the PMBus VIN_ON command to set the value of the input voltage at wich the unit should start power conversion</li>
<li>Write the PMBus IOUT_OC_WARN_LIMIT command to set the value of the output current that cause an output overcurrent warning</li>
<li>Write the TPS544C20 device specific PMBus command to unmask all alerts, and enable auto-ARA</li>
<li>Write the PMBus ON_OFF_CONFIG and PMB_OPERATION commands to turn on the TPS544C20</li>
<li>Enter LPM and wake up on a SMBAlert detection. When an alert is detected<ul>
<li>use ARA to check if the TPS544C20 was the device calling the alert,</li>
<li>send PMBus STATUS_WORD to retrieve the fault</li>
<li>send PMBus CLEAR_FAULTS to clear the TPS544C20 fault status</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="ch03_sec04_05"></a>
PMBus_Master03_TPS544C20_SMBControl</h2>
<p>This example configures the TPS544C20 using the CONTROL line. The CONTROL line turns the output ON/OFF together or independently of the OPERATION command. The signal is optional per PMBus spec but it is implemented in many PMBus devices.</p>
<p>After initializing the MSP430&trade; device and GPIO the example will:</p><ol type="1">
<li>Initialize the PMBus library</li>
<li>Clear SMBAlert interrupt flags and eanble SMBAlert interrupts</li>
<li>Verify the DEVICE_CODE for the TPS544C20</li>
<li>Write the PMBus VIN_OFF command to set the value of the input voltage at wich the unit should stop power conversion</li>
<li>Write the PMBus VIN_ON command to set the value of the input voltage at wich the unit should start power conversion</li>
<li>Write the PMBus IOUT_OC_WARN_LIMIT command to set the value of the output current that cause an output overcurrent warning</li>
<li>Write the TPS544C20 device specific PMBus command to unmask all alerts, and enable auto-ARA</li>
<li>Write the PMBus ON_OFF_CONFIG and PMB_OPERATION commands to COONTROL-only mode.</li>
<li>Set the GPIO CONTROL line to turn the TPS544C20 on. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
	<p>Copyright &#169; 2015, Texas Instruments Incorporated</p>	
    </li>
  </ul>
</div>
</body>
</html>
