

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Design Guide &mdash; CapTIvate &amp;trade; Technology Guide 1.70.00.03 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="CapTIvate &amp;trade; Technology Guide 1.70.00.03 documentation" href="../index.html"/>
        <link rel="next" title="Design Center GUI" href="ch_designcenter.html"/>
        <link rel="prev" title="Technology" href="ch_technology.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CapTIvate &trade; Technology Guide
          

          
          </a>

          
            
            
              <div class="version">
                1.70.00.03
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ch_getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_basics.html">Capacitive Sensing Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_technology.html">Technology</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Design Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#starting-a-new-design">Starting a New Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design-process">Design Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mechanicals">Mechanicals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#typical-stackup">Typical Stackup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overlay">Overlay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrode-and-trace-materials">Electrode and Trace Materials</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#other-situations">Other Situations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gaps">Gaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gloves">Gloves</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-layout-considerations">Common Layout Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#routing">Routing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#routing-material">Routing Material</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrode-material">Electrode Material</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrode-design">Electrode Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spacing-between-electrodes">Spacing Between Electrodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shapes">Shapes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#crosstalk">Crosstalk</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adjacent-capacitive-touch-signals">Adjacent Capacitive Touch Signals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#digital-signals">Digital Signals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#leds-led-backlighting">LEDs/LED Backlighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ground-planes">Ground Planes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#separation">Separation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pour">Pour</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-poly-cut-out-to-control-ground-pour-around-sensors">Using Poly Cut Out to control Ground Pour around Sensors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutual-capacitance-traces">Mutual Capacitance Traces</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#captivate-pin-selection">CapTIvate Pin Selection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#captivate-pin-nomenclature">CapTIvate Pin Nomenclature</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrode-to-pin-assignment-procedure">Electrode to Pin Assignment Procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#buttons">Buttons</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#self-capacitive-buttons">Self Capacitive Buttons</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#self-capacitive-button-shapes">Self Capacitive Button Shapes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mutual-capacitive-buttons">Mutual Capacitive Buttons</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mutual-capacitive-button-shapes">Mutual Capacitive Button Shapes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sliders-and-wheels">Sliders and Wheels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#slider-and-wheel-resolution">Slider and Wheel Resolution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-note-about-resolution-vs-number-of-positions">A Note About Resolution vs. Number of Positions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#self-capacitive-sensor-shapes">Self Capacitive Sensor Shapes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#self-capacitive-slider">Self Capacitive Slider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#self-capacitive-wheel">Self Capacitive Wheel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mutual-capacitive-sensor-shapes">Mutual Capacitive Sensor Shapes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mutual-capacitive-slider">Mutual Capacitive Slider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutual-capacitive-wheel">Mutual Capacitive Wheel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutual-capacitive-wheel-with-center-button">Mutual Capacitive Wheel with Center Button</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutual-capacitive-wheel-with-center-leds">Mutual Capacitive Wheel with Center LEDs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#proximity">Proximity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#proximity-design-considerations">Proximity Design Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proximity-ground-and-shielding">Proximity Ground and Shielding</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#electric-field-propagation">Electric Field Propagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proximity-sensor-with-no-shield">Proximity Sensor with No Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proximity-sensor-with-ground-shield">Proximity Sensor with Ground Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proximity-sensor-with-driven-shield">Proximity Sensor with Driven Shield</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#proximity-range-test">Proximity Range Test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#metal-touch">Metal Touch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#design-considerations">Design Considerations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#transparent-touch">Transparent Touch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#indium-tin-oxide-ito">Indium Tin Oxide (ITO)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ultra-low-power">Ultra Low Power</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expectations">Expectations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimization-steps">Optimization Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#selecting-a-low-frequency-clock">Selecting a Low Frequency Clock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizing-the-application-scan-period">Optimizing the Application Scan Period</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizing-for-the-smallest-parasitic-capacitance">Optimizing for the Smallest Parasitic Capacitance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizing-for-the-shortest-measurement-time">Optimizing for the Shortest Measurement Time</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-wake-on-proximity-state-machine-effectively">Using the Wake-on-Proximity State Machine Effectively</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#walking-through-the-optimization-process">Walking Through the Optimization Process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-creating-a-new-project">Step 1: Creating a New Project</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-switch-from-uart-to-i2c">Step 2: Switch from UART to I2C</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-optimize-the-conversion-count">Step 3: Optimize the Conversion Count</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-adjusting-the-active-mode-scan-period">Step 4: Adjusting the Active Mode Scan Period</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-enabling-and-adjusting-the-wake-on-proximity-mode">Step 5: Enabling and Adjusting the Wake-on-Proximity Mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-note-about-mutual-capacitance-and-bias-current">A Note about Mutual Capacitance and Bias Current</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bias-current-optimization-procedure">Bias Current Optimization Procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#moisture">Moisture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Expectations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moisture-physics">Moisture Physics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moisture-problems">Moisture Problems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moisture-mitigation-techniques">Moisture Mitigation Techniques</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#moisture-tolerance-applications">Moisture Tolerance Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spill-rejection-applications">Spill Rejection Applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#noise-immunity">Noise Immunity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-use-this-section">How to Use This Section</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aggressor-victim-philosophy">Aggressor-Victim Philosophy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-three-sided-approach">The Three Sided Approach</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction-to-electromagnetic-compatibility-emc-standards">Introduction to Electromagnetic Compatibility (EMC) Standards</a></li>
<li class="toctree-l4"><a class="reference internal" href="#signal-to-noise-ratio">Signal-to-Noise Ratio</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#types-of-noise">Types of Noise</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#differential-mode-supply-rail-noise">Differential Mode Supply Rail Noise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrostatic-discharge-esd">Electrostatic Discharge (ESD)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrical-fast-transient-eft">Electrical Fast Transient (EFT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rf-susceptibility-conducted-and-radiated">RF Susceptibility (Conducted and Radiated)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#noise-mitigation-steps">Noise Mitigation Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#noise-immunity-hardware-check-list">Noise Immunity Hardware Check List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tuning-check-list">Tuning Check List</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ch_designcenter.html">Design Center GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_device.html">Device Family</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_library.html">Software Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_evm.html">MSP-CAPT-FR2633 Development Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_evm_boostxl_capkeypad.html">BOOSTXL-CAPKEYPAD Development Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_evm_CAP_MINI.html">EVM430-CAPMINI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_workshop.html">Workshop (Getting Started)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch_revision.html">Revision History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CapTIvate &trade; Technology Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Design Guide</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="design-guide">
<h1>Design Guide<a class="headerlink" href="#design-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Capacitive touch detection is sometimes considered more art than science. This often results in multiple design iterations before the optimum performance is achieved. There are, however, good design practices for circuit layout and principles of materials that need to be understood to keep the number of iterations to a minimum.</p>
<p>Good sensor design are the foundation for a successful touch product.</p>
<div class="figure">
<img alt="" src="../_images/design_products.png" />
</div>
<p>The purpose of this design guide is to provide guidance for the design and layout of capacitive touch sensors so that they can achieve maximum performance. By achieving maximum performance in the hardware, the CapTIvate™ capacitive touch software library can perform the capacitive touch measurements consuming the lowest power. Tuning guides, along with the CapTIvate™ Design Center are used to help tune the performance of the capacitive touch application.</p>
</div>
<div class="section" id="starting-a-new-design">
<h2>Starting a New Design<a class="headerlink" href="#starting-a-new-design" title="Permalink to this headline">¶</a></h2>
<p>Starting any new capacitive touch design can be a challenging task. This section will guide you through this process and help determine what is important for your design and end application.</p>
<p><strong>Identify Sensors</strong></p>
<p>First we want to identify the types of sensors that you are considering for your application and provide some basic design guidelines.</p>
<ul class="simple">
<li><a class="reference external" href="ch_design_guide.html#best-practices">Best Practices</a></li>
<li><a class="reference external" href="ch_design_guide.html#buttons">Buttons</a></li>
<li><a class="reference external" href="ch_design_guide.html#sliders-and-wheels">Sliders and Wheels</a></li>
<li><a class="reference external" href="ch_design_guide.html#proximity">Proximity</a></li>
</ul>
<p><strong>Identify Care Abouts</strong></p>
<p>Next it is important to identify any special requirements for the end application, such as low-power, noise immunity, moisture, etc.</p>
<ul class="simple">
<li><a class="reference external" href="ch_design_guide.html#ultra-low-power">Ultra Low Power</a></li>
<li><a class="reference external" href="ch_design_guide.html#moisture">Moisture</a></li>
<li><a class="reference external" href="ch_design_guide.html#noise-immunity">Noise</a></li>
</ul>
</div>
<div class="section" id="design-process">
<h2>Design Process<a class="headerlink" href="#design-process" title="Permalink to this headline">¶</a></h2>
<p>Creating a reliable capacitive touch design can be a time consuming process that starts with designing sensors, laying out a PCB, writing lots of code and finally performing an iterative sensor tuning process to achieve the desired performance. The CapTIvate™ Technology sensor design process <em>accelerates</em> the capacitive touch development cycle through automation, helping get your product to market faster.</p>
<p><strong>Creating a new sensor design</strong></p>
<p>We begin the process by creating a new capacitive touch design using the CapTIvate™ Design Center. With a few simple drag-n-drop inputs and configuration selections, the CapTIvate™ Design Center will automatically determine the optimal pin assignments between the target MCU and the sensors (CapTIvate™ Technology peripheral can measure four channels in parallel). Alternatively, connections can be manually assigned or reserved for those applications with specific routing requirements.</p>
<div class="figure">
<img alt="" src="../_images/design_process_step1.png" />
</div>
<p><strong>Layout PCB</strong></p>
<p>Once the pin assignments have been made, the MCU pin to sensor electrode connection information is exported to a .csv file and can be used during the PCB layout and design.</p>
<div class="figure">
<img alt="" src="../_images/design_process_step2.png" />
</div>
<p><strong>Generate configuration and starter project files</strong></p>
<p>Now we are ready to create a custom starter code project based on our sensor design. The CapTIvate™ Design Center creates a fully working capacitive touch application that can be imported into Texas Instruments Code Composer Studio (CCS) or IAR Embedded Workbench. In addition to the application, the CapTIvate™ Software Library and MSP430 driver-lib are automatically included with the project, as portions of the libraries are needed during the development cycle.</p>
<div class="figure">
<img alt="" src="../_images/design_process_step3.png" />
</div>
<p><strong>Program target MCU</strong></p>
<p>Import the generated CapTIvate™ project into Code Composer Studio or IAR IDE, compile and program the target MCU. The specific steps to perform the programming operation depend on the IDE, however, once the target MCU is programed, you are ready to start running your first capacitive touch application without having to write a <em>single line of code!</em></p>
<p>Didn&#8217;t get it right the first time? Changes to a sensor design is simple. We use the CapTIvate™ Design Center to modify our sensor design project, then generate an updated configuration file. Simply copy the new configuration file and replace the existing one in the CCS or IAR application project and rebuild the application. That&#8217;s it!</p>
<p><strong>Tune Sensors</strong></p>
<p>Our PCB is ready to go so we can now begin the process of tuning the sensors for the desired touch and feel. With the MCU programmed with our application and running, the sensors are scanned and real-time data is transmitted to the CapTIvate™ Design Center using the high-speed HID serial bridge MCU on the CAPTIVATE-PGMR PCB. The CapTIvate™ Design Center has several different views to display and monitor the sensor response and allow quick modifications in real-time to the sensor&#8217;s parameters, providing instant feedback.</p>
<div class="figure">
<img alt="" src="../_images/design_process_step4.png" />
</div>
<p><strong>Measure SNR and Design Margins</strong></p>
<p>Now that a first-pass tuning has been created, TI recommends assessing the reliability of each sensor by utilizing the <a class="reference external" href="ch_designcenter.html#snr-measurements">SNR measurement tool</a> in the CapTIvate Design Center to measure the SNR and design margins. For details on this process, see the application report <a class="reference external" href="http://www.ti.com/lit/slaa843">Sensitivity, SNR, and Design Margin in Capacitive Touch Applications</a>.</p>
<p><strong>Generate final configuration</strong></p>
<p>Once our desired touch and feel is achieved, the final sensor configuration can be generated and then programmed into the target MCU. That&#8217;s it! Using the steps outlined above, capacitive sensor design time can be dramatically reduced.</p>
<p><em>Congratulations!</em> You are done with your design and ready to go to market.</p>
</div>
<div class="section" id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<p>In this section we will cover both mechanical as well as common layout practices.</p>
<p>Capacitive touch detection is a type of analog-to-digital converter (ADC), specifically a capacitance-to- digital converter. As with most ADCs, the terms of interest are resolution, signal-to-noise ratio (SNR), and linearity, in the specific cases of wheels and sliders. Throughout this document, the design guidance helps to maximize signal, minimize noise, and address when these two goals are at odds.</p>
<p>As mentioned above, the basis of capacitive touch detection is the ability to measure a change in capacitance. This change in capacitance is the signal that the capacitive touch solution identifies. The term sensitivity is often used to describe the signal strength a more sensitive solution has a stronger signal.</p>
<p>Sensitivity is measured in capacitance per counts. In the context of capacitive touch detection, the magnitude of change introduced by a touch is on the order of picofarads or hundreds of femtofarads. It is not uncommon for a solution to see a touch introduce 1 pF of change and be measured as 300 counts. And while the sensitivity might be 3.3 fF/count, this should not be considered until the noise is factored in. Refer to the section on <a class="reference external" href="ch_design_guide.html#noise-immunity">Noise</a> below.</p>
<p>Sensitivity can be controlled within firmware, but the goal is to provide good sensitivity with the hardware, so that the lowest sensitivity settings can be used in firmware, which provides the lowest-power solution. Referring to the <a class="reference external" href="ch_basics.html#self-capacitance">Equivalent circuit</a> for a self capacitive sensor, C_touch must be maximized, while the other four capacitances must be minimized. The capacitances of the trace and electrode are approximated as parallel plate capacitances. The following equation serves as the basis for layout recommendations.</p>
<p>C = Er x E0 x A/d (1)</p>
<p>The dielectric constant (Er), area (A), and distance (d) are described throughout this document with the intent of positively influencing the capacitance for a touch system.</p>
<p>Although parasitic capacitance is presented separately, it is a part of the sensitivity and signal. As already mentioned, the capacitance of interest is the relative change in capacitance. The change in capacitance is based upon the touch interaction, but this change is perceived relative to the parasitic capacitance of the system. The parasitic capacitance is also called the steady-state capacitance or baseline capacitance. If the introduced change is 100 fF, then the sensitivity, which is the relative change in capacitance, can be increased by decreasing the parasitic capacitance.</p>
<p>The capacitances C_trace, C_electrode, and C_parasitics are generically referred to as parasitic capacitance.</p>
<div class="section" id="mechanicals">
<h3>Mechanicals<a class="headerlink" href="#mechanicals" title="Permalink to this headline">¶</a></h3>
<p>The mechanicals are the mechanical characteristics of the design. The mechanicals include the overlay material, ink on top of the overlay, any adhesives used to bond the electrode to the overlay or enclosure, and any transition materials used to remove air gaps between the electrode and the overlay. Mechanicals also include the types of materials used for the electrodes. The mechanicals affect both the signal and the parasitic capacitance.</p>
<p>The goal of this section is threefold:</p>
<ol class="arabic simple">
<li>To understand the benefits in terms of both aesthetics and robustness</li>
<li>To understand how the materials on top of the electrode and the electrode material itself influence the layout of the electrodes</li>
<li>To avoid mistakes in the mechanicals that are detrimental to the electrical performance</li>
</ol>
<div class="section" id="typical-stackup">
<h4>Typical Stackup<a class="headerlink" href="#typical-stackup" title="Permalink to this headline">¶</a></h4>
<p>The following figure shows a typical stackup for a capacitive touch solution. One of the main goals of this stackup is to reduce (or eliminate, if possible) any low-dielectric (air) gaps between the electrode and the area where the touch takes place. The capacitance associated with the stackup has a very strong effect on the signal (change in capacitance from a touch). The signal is directly proportional to the dielectric of the materials. If possible, high-dielectric materials should be used, but at a minimum the stackup should eliminate any air gaps.</p>
<p>Air gaps can also contain moisture, which can influence performance or even damage the stackup as temperatures vary and the contents of the gap expand and contract.</p>
<div class="figure" id="id16">
<img alt="Typical Material Stackup" src="../_images/design_material_stackup.png" />
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Typical Material Stackup</span></p>
</div>
<p>Another critical attribute of the stackup is that it should be non-conductive. This is not usually a problem with the overlay material but can be overlooked when choosing adhesives, labels, or inks. Popular adhesives for capacitive touch solutions include 200MP products from 3M™ such as 467MP and 468MP.</p>
</div>
<div class="section" id="overlay">
<h4>Overlay<a class="headerlink" href="#overlay" title="Permalink to this headline">¶</a></h4>
<p><strong>Why you want to have an Overlay?</strong></p>
<p>Overlays are very important part of the capacitive touch system, it allows the designers to give their product a sleek industrial design and also provide the ESD and environment protections like the pictures showing below.</p>
<div class="figure" id="id17">
<img alt="Overlay Purpose" src="../_images/Overlay_1.png" />
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Overlay Purpose</span></p>
</div>
<p><strong>What is the trade-off?</strong></p>
<p>It provides many benefits to product designers by adding an overlay on top of the capacitive sensor however the benefits come with a trade-off. When an overlay is placed between a sensor and the point of contact for a finger, a sensor’s sensitivity is greatly reduced because the overlay reduces the effective electric field going out from the sensor. The dielectric constants determines how efficiently electric Field passes through material and the distance between the overlay and the sensor determines how much electric field left in target point of contact area.</p>
<p>As the diagrams show below, adding an overlay over a sensor reduce the electric field going out from the sensor which reduces the strength or range of a sensor to a touch condition.</p>
<div class="figure" id="id18">
<img alt="Overlay Trade-off" src="../_images/Overlay_2.png" />
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Overlay Trade-off</span></p>
</div>
<p>The following figure shows the relationship between the thickness of the overlay and the sensitivity of the circuit. From the parallel plate capacitance equation, the capacitance in inversely proportional to the material thickness (C ~ 1/d).</p>
<div class="figure" id="id19">
<img alt="Sensitivity vs Thickness" src="../_images/design_plot.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Sensitivity vs Thickness</span></p>
</div>
<p>The thickness and dielectric of the material influence the electrode design. The electrode area is a function of the area of interaction (a fingertip or the palm of the hand) while the spacing (to adjacent electrodes or ground fill) is related to the thickness of the overlay. For example, with a 2-mm overlay that has a dielectric of 3, the spacing should be approximately 1 mm (half of the thickness). Using a higher dielectric material (for example, Er = 6) the thickness could be doubled while maintaining the same level of performance. The following table shows dielectric values for various materials used as overlays.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="40%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Material</th>
<th class="head">Dielectric Constant (Er) (1)</th>
<th class="head">Breakdown Voltage (V/mm)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Air</td>
<td>1.0</td>
<td>3300 (STP)</td>
</tr>
<tr class="row-odd"><td>FR-4</td>
<td>4.8</td>
<td>20000</td>
</tr>
<tr class="row-even"><td>Glass</td>
<td>7.6 to 8.0</td>
<td>7900</td>
</tr>
<tr class="row-odd"><td>Gorilla&amp;reg Glass</td>
<td>7.2 to 7.6</td>
<td>See Manufacturer (2)</td>
</tr>
<tr class="row-even"><td>Polycarbonate</td>
<td>2.9 to 3.0</td>
<td>16000</td>
</tr>
<tr class="row-odd"><td>Acrylic</td>
<td>2.8</td>
<td>13000</td>
</tr>
<tr class="row-even"><td>ABS</td>
<td>2.4 to 4.1</td>
<td>16000</td>
</tr>
</tbody>
</table>
<p>Table: Material Dielectric and Breakdown Voltage</p>
<ol class="arabic simple">
<li>Relative permittivity</li>
<li><a class="reference external" href="http://www.corninggorillaglass.com">http://www.corninggorillaglass.com</a></li>
</ol>
<p>The table above also includes the breakdown voltage for different overlay materials. This should be considered when designed for ESD protection. ESD solutions should be system solutions, and any additional components should complement the protection provided by the overlay.</p>
</div>
<div class="section" id="electrode-and-trace-materials">
<h4>Electrode and Trace Materials<a class="headerlink" href="#electrode-and-trace-materials" title="Permalink to this headline">¶</a></h4>
<p>The performance is affected by the conductive materials that are used for the electrode and for the trace between the electrode and the microcontroller. Most applications use copper on a PCB, and copper has a resistivity of 1.7x10-6 Ohm-cm (1). As the resistivity of the conductor increases, the ability to move charge to and from the electrode decreases. This has the same effect as an increase in parasitic capacitance. This increase in resistivity, like an increase in parasitic capacitance, reduces the system sensitivity. The table below shows the resistivity for materials that are commonly used in touch applications.</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Material</th>
<th class="head">Resistivity, p (Ohm-cm)(1)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Copper</td>
<td>1.68x10-6</td>
</tr>
<tr class="row-odd"><td>Silver</td>
<td>1.59x10-6</td>
</tr>
<tr class="row-even"><td>Tin</td>
<td>1.09x10-5</td>
</tr>
<tr class="row-odd"><td>Indium Tin Oxide</td>
<td>1.05x10-3 (2)</td>
</tr>
</tbody>
</table>
<p>Table: Resistivity of Materials</p>
<ol class="arabic simple">
<li>Resistivity is given in Ohm-cm so that resistance is equal to the resistivity times the length divided by the cross-sectional area : R = p x L / A.</li>
<li>This resistivity is for a film thickness of 270 nm. Typically, vendors provide sheet resistance instead of resistivity for ITO, which is on the order of 10 to 100 Ohms per square.</li>
</ol>
<p>When using high-resistivity materials, generally the recommendation is to increase the area of traces to reduce the resistance (at the cost of capacitance). ITO solutions provide lower sensitivity, which must be compensated for in the capacitance measurement algorithm by longer measurement times.</p>
</div>
</div>
<div class="section" id="other-situations">
<h3>Other Situations<a class="headerlink" href="#other-situations" title="Permalink to this headline">¶</a></h3>
<p>Not all applications fit into the typical category, and this section describes two special cases. The first is intentional air gaps that are greater than 2 mm between the electrode and the overlay material, and the second is the use of gloves.</p>
<div class="section" id="gaps">
<h4>Gaps<a class="headerlink" href="#gaps" title="Permalink to this headline">¶</a></h4>
<p><strong>Why you want to have a gap?</strong></p>
<p>In some applications, components are on the same layer as the electrode. This prevents the overlay from being directly applied to the electrode. A common example of this is when an LCD is mounted near the electrode (see diagram below). Another scenario is when the overlay material is not a uniform surface and, therefore, the electrode cannot make direct contact with the overlay.</p>
<div class="figure" id="id20">
<img alt="Intentional Gaps Between Electrode and Overlay" src="../_images/design_gaps.png" />
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Intentional Gaps Between Electrode and Overlay</span></p>
</div>
<p><strong>What is the trade-off?</strong></p>
<p>As we discussed in the Overlay section, air has really low dielectric constant and therefore does not pass the electric field very efficiently.</p>
<p>As the diagram shows, theoretically the sensitivity for 1mm air gap without any moisture will be similar to an 8mm thick glass. Typical dielectric values for Air is 1. (Without moisture) Typical dielectric values for Glass is 8.</p>
<div class="figure" id="id21">
<img alt="Gap dielectric values" src="../_images/airgap_1.png" />
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">Gap dielectric values</span></p>
</div>
<p>To keep the air gap without affecting too much of the sensor performance, we must bridge the gap for the sensor area with a non-conductive filler (typically adhesive) or a conductive extension. When the gap is in excess of 2 mm, then a conductive extension, either foam or metal, should be used. The metal or foam must be malleable to conform to the shape of the surfaces and prevent the formation of gaps.</p>
<p>When customer choice their bridge materials please take in consideration of dielectric values, transparency, mechanical support, manufacture cost, noise tolerance. The diagram below shows several materials we experimented to help to bridge the air gap and the sensitivity increase goes to an order of: Metal Spring &gt; Conductive Foam &gt; Carbon Fiber &gt; Polycarbonate &gt; ABS &gt; Silicone</p>
<div class="figure" id="id22">
<img alt="Gap Bridge" src="../_images/airgap_2.png" />
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">Gap Bridge</span></p>
</div>
<p>In either case, the gap must be filled or bridged with a non-conductive filler (typically adhesive) or a conductive extension. When the gap is in excess of 2 mm, then a conductive extension, either foam or metal, should be used. The metal or foam must be malleable to conform to the shape of the surfaces and prevent the formation of gaps. As shown in the Figure above, the area created by the foam or metal in contact with the overlay is now the area that influences the capacitance.</p>
</div>
<div class="section" id="gloves">
<h4>Gloves<a class="headerlink" href="#gloves" title="Permalink to this headline">¶</a></h4>
<p>Gloves are simply another layer of medium between the electrode and the finger, and the same principles of thickness and dielectric apply. The challenges with glove applications include the ability to support both gloved and ungloved hands as well as the variation in the types of gloves the application might require. Typical leather or plastic gloves have a dielectric constant in the range of 2 to 4, and fabric gloves and gloves with insulation can have a dielectric constant less than 2.</p>
</div>
</div>
<div class="section" id="common-layout-considerations">
<h3>Common Layout Considerations<a class="headerlink" href="#common-layout-considerations" title="Permalink to this headline">¶</a></h3>
<p>After the mechanicals are understood, the electrodes can be sized and designed to provide the most signal. Independent of the mechanicals, the layout design is affected by the distance between the microcontroller and the electrodes, the PCB stackup (for example, one layer, two layer, or four layer), and other electrical circuits on the PCB.</p>
<p>The first item to consider relates to the schematic and the placement of any external components that are associated with the capacitive touch solution. A typical example is ESD protection components such as a series current limiting resistor. In all cases, the components should be kept as close as possible to the microcontroller. As the components move farther away from the microcontroller, the increased area correlates to an increased risk of noise or ESD conducting into the device.</p>
<div class="section" id="routing">
<h4>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h4>
<p>The parasitic capacitance of the trace comprises several major and minor capacitance contributors. For simplicity, C_trace represents the major capacitances formed between the trace line and the ground pour on the bottom side and surrounding it. The top and cross-sectional views of a typical two layer PCB are shown in Figure 6. The capacitance, C_trace, is determined by the trace line width (W), dielectric thickness (H), trace thickness (T), and the relative permittivity of the PCB material (Er).</p>
<div class="figure" id="id23">
<img alt="Top and Cross-Sectional Views of Trace Line in PCB" src="../_images/design_routing.png" />
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Top and Cross-Sectional Views of Trace Line in PCB</span></p>
</div>
<p>The capacitance per unit length of the trace is an important concept to emphasize the need for short traces. Increasing the distance of the trace increases the parasitic capacitance associated with the trace. Increasing the trace length can also increase susceptibility to noise. Therefore, the trace routing between the microcontroller and the electrode should be kept as short as possible. This is not always possible, so it is important to understand the increase in parasitic capacitance associated with the trace routing.</p>
<div class="section" id="capacitance-per-unit-length">
<h5>Capacitance per Unit Length<a class="headerlink" href="#capacitance-per-unit-length" title="Permalink to this headline">¶</a></h5>
<p>The capacitance per unit length should be kept as small as possible to minimize the parasitic capacitance (C_trace) and ultimately maximize sensitivity. As previously mentioned, the dominant capacitance in C_trace is the parallel plate capacitance between the trace and the surrounding ground pour. The ability to reduce this capacitance is a direct function of the PCB manufacturing capabilities. Tighter tolerances and smaller minimum dimensions (trace width and separation) allow for thinner traces and larger separation, which result in lower capacitance per unit length. These manufacturing capabilities typically come at a higher cost.</p>
<p>The table below shows how the capacitance per unit length changes with the variation of different dimensions. These values are taken from <a class="reference external" href="ch_design_guide.html#references">Reference Section</a> in the Coplanar Waveguide Analysis/Synthesis Calculators.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="12%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">W (mm)</th>
<th class="head">S (mm)</th>
<th class="head">T (mm)</th>
<th class="head">H (mm)</th>
<th class="head">Er</th>
<th class="head">C (pF/cm)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0.152</td>
<td>0.152</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.633</td>
</tr>
<tr class="row-odd"><td>0.152</td>
<td>0.254</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.555</td>
</tr>
<tr class="row-even"><td>0.152</td>
<td>0.381</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.496</td>
</tr>
<tr class="row-odd"><td>0.203</td>
<td>0.152</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.692</td>
</tr>
<tr class="row-even"><td>0.203</td>
<td>0.254</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.602</td>
</tr>
<tr class="row-odd"><td>0.203</td>
<td>0.381</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.543</td>
</tr>
<tr class="row-even"><td>0.254</td>
<td>0.152</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.740</td>
</tr>
<tr class="row-odd"><td>0.254</td>
<td>0.254</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.641</td>
</tr>
<tr class="row-even"><td>0.254</td>
<td>0.381</td>
<td>0.036</td>
<td>1.6</td>
<td>4.6</td>
<td>0.578</td>
</tr>
<tr class="row-odd"><td>0.254</td>
<td>0.152</td>
<td>0.036</td>
<td>2.54</td>
<td>4.6</td>
<td>0.736</td>
</tr>
<tr class="row-even"><td>0.254</td>
<td>0.254</td>
<td>0.036</td>
<td>2.54</td>
<td>4.6</td>
<td>0.637</td>
</tr>
<tr class="row-odd"><td>0.254</td>
<td>0.381</td>
<td>0.036</td>
<td>2.54</td>
<td>4.6</td>
<td>0.566</td>
</tr>
</tbody>
</table>
<p>Table: Calculating Results of Capacitance per Unit Length</p>
<p>The table above shows that increasing the space, S, between the trace line and the ground is an effective way to reduce the parasitic capacitance. However, increasing the separation can have negative effects that need to be understood. One effect is simply increased board space. Increasing the dimensions can lead to larger PCBs and higher cost. Another effect is related to noise. The larger separation makes traces more sensitive to touch events (touching the trace instead of the electrode) and more susceptible to radiated emissions.</p>
<p>In practice, the designer should choose a balanced S value, and a value of 1/8 of the overlay thickness is typically acceptable. Additionally, a hatched ground is commonly used instead of solid fill near the trace lines to reduce the area and consequently the parasitic capacitance.</p>
<p>The table above also shows that as H gets smaller, the parasitic capacitance increases, which results in a decrease in sensitivity. In most applications, a two-layer PCB is used, and a standard FR4 PCB with the thickness of 1 mm to 1.6 mm is recommended. If a multilayer board is used, it is recommended to keep the H as large as possible. With complex multilayer boards (more than six layers), it is important to recognize that the absence of copper in the internal layers can cause issues and the height, H, between the top layer and the bottom may be smaller than predicted.</p>
<p>The figure below shows an example of a four-layer PCB, which may be desired in applications with limited board space. To reduce parasitic capacitance, the ground pour is usually placed on the lowest layer underneath the trace to provide the largest H. If it is difficult to achieve the maximum height, then a narrower W, a larger S, or even a hatched ground fill are alternatives to reducing the parasitic capacitance.</p>
<div class="figure" id="id24">
<img alt="Trace Without Copper Pouring Underneath in Multilayer PCB" src="../_images/design_multilayer_pcb.png" />
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">Trace Without Copper Pouring Underneath in Multilayer PCB</span></p>
</div>
<p>To determine the maximum trace length from the capacitance per unit length, some additional information is needed. The following example is used to calculate the maximum distance for a trace with a capacitance per unit length of 0.58 pF/cm. The capacitance introduced by a touch, C_touch, is assumed to be approximately 1 pF. To make sure that the capacitance induced by a finger is large relative to the parasitic capacitance, the total parasitic capacitance (C_parasitics, C_trace, and C_electrode) should be in the range of 10 pF to 20 pF (the change is at least a 5% change). Assuming that the C_electrode is approximately 3 pF, the C_parasitics is 5 pF, and the capacitance per unit length is 0.58 pF/cm, so the trace line length L should be no longer than 210 mm. If the electrode is larger (for a proximity application), the capacitance itself is larger (assume approximately 8 pF for this example), so the maximum trace line length L is reduced to 120 mm.</p>
<p>Generally speaking, the trace width W should be as thin as the PCB technology allows, because a short and narrow trace line is preferred. The trace thickness T and the relative permittivity of the material Er also have significant influence on capacitance per unit length, but they are determined by PCB manufacture process and are usually difficult to change.</p>
</div>
<div class="section" id="connectors">
<h5>Connectors<a class="headerlink" href="#connectors" title="Permalink to this headline">¶</a></h5>
<p>Some designs require the electrode to be off-board, and consequently a connector is used to transition the trace from the PCB to a cable or to another PCB. Connectors are generally not desired because like any component there is an associated parasitic capacitance with connector PCB footprint and structure.</p>
<p>In terms of parasitic capacitance and sensitivity, the connector is treated as a parasitic capacitance reducing the sensitivity of the solution. Because the connector is treated as a lumped capacitance, the placement is irrelevant to the sensitivity. However, the placement is important with respect to noise.</p>
<p>The figure below shows that if the aggressor (noise source, N1) is located on the PCB, then the preferred placement of the connector is near the MSP430 microcontroller. The parasitic capacitance associated with the connector shunts high-frequency noise (Z 1/jwC) and increases the noise immunity of the circuit. Conversely, if the aggressor is located off-board (noise source, N2), then the connector should be placed farther from the microcontroller and closer to the electrode. This arrangement minimizes the off-board trace and cable length (which acts like an antenna). When multiple aggressors exist as is shown in the figure below, it is recommended to reduce the effect of the radiators that most closely match the operating frequency of the touch detection circuit.</p>
<div class="figure" id="id25">
<img alt="Top View of Connector and Noise Source" src="../_images/design_connectors.png" />
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">Top View of Connector and Noise Source</span></p>
</div>
<p>When deciding the position of the connector, the designer must balance the length of the trace and the cable while considering parameters like the background noise.</p>
</div>
</div>
<div class="section" id="routing-material">
<h4>Routing Material<a class="headerlink" href="#routing-material" title="Permalink to this headline">¶</a></h4>
<p>The routing is typically done with copper, but other materials like silver and ITO can be used. Silver is similar to copper and similar performance can be expected (if the thickness of the materials are also equivalent). ITO is very different from copper, and the difference in resistivity degrades the sensitivity of the solution. Lowering the impedance of the trace (by increasing the width) should be a high priority in the design, even though this comes at the cost of increased parasitic capacitance and reduced noise immunity. Ultimately, the use of materials like ITO requires more processing by the MSP430 microcontroller to adjust to lower sensitivity and increased noise.</p>
</div>
<div class="section" id="electrode-material">
<h4>Electrode Material<a class="headerlink" href="#electrode-material" title="Permalink to this headline">¶</a></h4>
<p>As discussed in the <a class="reference external" href="ch_design_guide.html#routing">Routing section</a>, conductivity becomes an issue in more resistive materials like ITO. Although the transparency of ITO is very good, the resistivity is high when compared to materials like silver and copper. Typically the physical dimensions prohibit increasing the area of the ITO electrodes, and therefore any degradation in sensitivity must be compensated for in the firmware. This typically results in slightly longer measurement times and consequently increased power consumption.</p>
</div>
<div class="section" id="electrode-design">
<h4>Electrode Design<a class="headerlink" href="#electrode-design" title="Permalink to this headline">¶</a></h4>
<p>The electrode design must accomplish two goals. First, the design must provide sufficient signal (change in capacitance with interaction). The design must project the e-field up and out so that the appropriate level of sensitivity is achieved at the desired distance. Understanding the stackup, thickness and dielectric, the electrode can be sized and shaped to provide the maximum signal. Second, the electrode design needs to have a minimal parasitic capacitance.</p>
<p>In the following sections the shape and area of the electrode are discussed with the intent of maximizing the signal for different implementations (buttons, sliders, and wheels). The basis for controlling the parasitic capacitance is common to different sensor implementations and is discussed here.</p>
<p>The figure below shows an example PCB cross-section and the important parameters that influence the parasitic capacitance. The height, width, and separation have a direct effect on the parasitic capacitance of the electrode, C_electrode. The fundamental parameter area is not shown in the figure below because this has a direct effect on both the touch capacitance (C_touch) and the parasitic capacitance (C_electrode). This section describes how changes to the height and separation can minimize the parasitic capacitance. The following sections describe how changes to the area can maximize C_touch.</p>
<div class="figure" id="id26">
<img alt="Capacitance of the Electrode" src="../_images/design_electrode_capacitance.png" />
<p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">Capacitance of the Electrode</span></p>
</div>
<p>The separation (S_electrode) is directly related to the height of the overlay as described in the <a class="reference external" href="ch_design_guide.html#mechanicals">Mechanical section</a>. The height is a function of the PCB and is not a parameter that can be easily controlled. The separation is typically the parameter with the most flexibility.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="15%" />
<col width="20%" />
<col width="19%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Area(mm2)</th>
<th class="head">Height(mm)</th>
<th class="head">Description</th>
<th class="head">Separation(mm)</th>
<th class="head">Capacitance(pF)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10x10, FR-4 (Er = 4.4)</td>
<td>1.572</td>
<td>2 Layer PCB, L2</td>
<td>0.508</td>
<td>3.3</td>
</tr>
<tr class="row-odd"><td>10x10, FR-4 (Er = 4.4)</td>
<td>1.572</td>
<td>2 Layer PCB, L2</td>
<td>1.02</td>
<td>3.2</td>
</tr>
<tr class="row-even"><td>10x10, FR-4 (Er = 4.4)</td>
<td>1.572</td>
<td>2 Layer PCB, L2</td>
<td>1.52</td>
<td>3.1</td>
</tr>
<tr class="row-odd"><td>10x10, FR-4 (Er = 4.4)</td>
<td>1.30</td>
<td>4 Layer PCB, L2</td>
<td>0.508</td>
<td>3.8</td>
</tr>
<tr class="row-even"><td>10x10, FR-4 (Er = 4.4)</td>
<td>1.57</td>
<td>4 Layer PCB, L3</td>
<td>0.508</td>
<td>3.3</td>
</tr>
</tbody>
</table>
<p>Table: Baseline Electrode Capacitance</p>
<p>The table above shows that increasing the height (the distance between the electrode and the reference plane) decreases the capacitance. By decreasing the parasitic capacitance, the relative change in capacitance caused by a touch event is increased. For example, if the change in capacitance associated with a touch is 0.5 pF, the relative change is greater when the base capacitance is 11 pF instead of 12 pF, (4.5% instead of 4.2%).</p>
</div>
<div class="section" id="spacing-between-electrodes">
<h4>Spacing Between Electrodes<a class="headerlink" href="#spacing-between-electrodes" title="Permalink to this headline">¶</a></h4>
<p>By default, the CapTIvate™ Software Library drives non-actively scanned electrodes to ground allowing neighboring electrodes to be treated as an extension of the ground pour. Therefore, the spacing between the electrodes follows the same rules for spacing from ground. The goal is provide enough spacing so that the e-field propagates up and through the overlay material. A minimum spacing of one-half the laminate thickness has been found to provide sufficient signal (sensitivity).</p>
</div>
<div class="section" id="shapes">
<h4>Shapes<a class="headerlink" href="#shapes" title="Permalink to this headline">¶</a></h4>
<p>The capacitance of the electrode is a function of area, but the shape is important to consider, because the shape can influence the area. An important detail of designing the electrode shape is not to design shapes that have low surface area. The area of each electrode must provide the maximum C_touch, which in turn produces the most signal (the change in capacitance) when a touch event occurs.</p>
</div>
<div class="section" id="crosstalk">
<h4>Crosstalk<a class="headerlink" href="#crosstalk" title="Permalink to this headline">¶</a></h4>
<p>In the Connectors section above, the aggressor is assumed to be a point source of noise. In this section, the aggressors are different signals that are routed in close proximity to the capacitive touch sensor trace. These aggressors can be another capacitance sensor trace or non-capacitance sensor lines. Examples of non-capacitance sensor lines include digital signals, analog signals, and high-current signals used to drive LEDs.</p>
</div>
<div class="section" id="adjacent-capacitive-touch-signals">
<h4>Adjacent Capacitive Touch Signals<a class="headerlink" href="#adjacent-capacitive-touch-signals" title="Permalink to this headline">¶</a></h4>
<p>Capacitive sensor traces influence neighboring capacitive touch sensor traces. The space between capacitance sensor trace lines, Scs, should be kept as a safe distance (see figure below).</p>
<div class="figure" id="id27">
<img alt="Trace Spacing" src="../_images/design_traces_spacing.png" />
<p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">Trace Spacing</span></p>
</div>
</div>
<div class="section" id="digital-signals">
<h4>Digital Signals<a class="headerlink" href="#digital-signals" title="Permalink to this headline">¶</a></h4>
<p>Digital signals are typically PWM signals or communications like I2C or SPI. Unlike the capacitive traces, these signals can act as aggressors and can be active during a capacitance measurement. It is recommended to keep these types of signals at least 4 mm away from the capacitive touch trace. If the digital signal and the capacitive touch trace must cross, then it is recommended to keep the crossing at a 90 degree angle.</p>
<div class="figure" id="id28">
<img alt="Digital Traces" src="../_images/design_traces_digital.png" />
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Digital Traces</span></p>
</div>
</div>
<div class="section" id="leds-led-backlighting">
<h4>LEDs/LED Backlighting<a class="headerlink" href="#leds-led-backlighting" title="Permalink to this headline">¶</a></h4>
<p>Signals used to drive LEDs (unless the LEDs require high-strength drivers) are similar to other digital signals. As with digital signals, a distance of at least 4 mm is strongly recommended for S_LED as shown in the figure below.</p>
<div class="figure" id="id29">
<img alt="LED Traces" src="../_images/design_traces_leds.png" />
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">LED Traces</span></p>
</div>
<p>As a general rule, LEDs should be driven and the use of high-impedance states should not be used to control the LED. The use of a high impedance to prevent an LED from conducting can result in a significant difference between the on-state and off-state capacitances. This change in capacitance may be detected by the touch solution and treated as a change in the system capacitance, or even worse as a false detection. If the use of high-impedance control of the LED is unavoidable, a discrete capacitor (typically 1 nF is acceptable) in parallel with the LED is recommended.</p>
<ul class="simple">
<li>Avoid tri-stating the LED as the LED capacitance will change when turned on and off</li>
<li>If LED must be tri-stated, add small bypass capacitor to control change in LED capacitance</li>
<li>Capacitor does not have to be physically near LED, just in the circuit</li>
</ul>
<div class="figure" id="id30">
<img alt="Recommended methods to drive LEDs" src="../_images/design_backlighting2.png" />
<p class="caption"><span class="caption-number">Fig. 16 </span><span class="caption-text">Recommended methods to drive LEDs</span></p>
</div>
<p>LED BackLighting can be done easily using a back lighting LED on the opposite side of the PCB</p>
<ul class="simple">
<li>Keep hole as small as possible to eliminate possible dead spots in sensor</li>
<li>LEDs may require bypass capacitor (see above)</li>
</ul>
<div class="figure" id="id31">
<img alt="Backlighting LEDs" src="../_images/design_backlighting1.png" />
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Backlighting LEDs</span></p>
</div>
<p>As an example of an LED backlighting technique, the following wheel design has an LED mounted on the backside of the PCB and illuminates through a small hole. In parallel to the LED, a small 1nF capacitor is used to reject changes in capacitance when the LED is switched between ground and high-Z. Also note the hatched ground on both the top and bottom layers to help with noise immunity.</p>
<div class="figure" id="id32">
<img alt="LED BackLight Example" src="../_images/design_mutual_led_backlight.png" />
<p class="caption"><span class="caption-number">Fig. 18 </span><span class="caption-text">LED BackLight Example</span></p>
</div>
</div>
<div class="section" id="ground-planes">
<h4>Ground Planes<a class="headerlink" href="#ground-planes" title="Permalink to this headline">¶</a></h4>
<p><strong>Why you want to have a Ground pours around the sensors?</strong></p>
<p>Ground planes have a purpose by helping with noise immunity and cross-talk between neighboring sensors. Although generally recommended, the amount of fill (solid vs a hatched) depends on the system environment.</p>
<div class="figure" id="id33">
<img alt="Ground Pours" src="../_images/Ground_Pours.png" />
<p class="caption"><span class="caption-number">Fig. 19 </span><span class="caption-text">Ground Pours</span></p>
</div>
<p><strong>What are the trades-off?</strong></p>
<p><strong>Parasitic capacitance</strong></p>
<p>The ground pours add the parasitic capacitance into the base capacitance as the separation from the ground decreases and the area of the ground pour increases. As shown in the illustrations, adding a hatched or solid ground pour will increases the total sensor capacitance, making it less sensitive to the small change in capacitance caused by a touch condition. Fortunately the CapTIvate peripheral has the ability to subtract off these parasitic effects, restoring a sensor’s sensitivity.</p>
<div class="figure" id="id34">
<img alt="Ground Pours Parasitic Capacitance Trade-off" src="../_images/Ground_Pours_1.png" />
<p class="caption"><span class="caption-number">Fig. 20 </span><span class="caption-text">Ground Pours Parasitic Capacitance Trade-off</span></p>
</div>
<p><strong>Electric field</strong></p>
<p>These same ground pours can also have a negative effect by pulling the sensor’s electric field towards the ground pour, creating a potentially large parasitic capacitance. This parasitic capacitance degrades the overall strength of a touch signal, making the sensor less sensitive to a touch condition. As shown in the illustration, more of the sensor’s electric field lines are attracted to the ground pour rather than extending outward from the sensor. This effectively reduces the strength or range of a sensor to a touch condition. However, the system cannot re-gain the electric field strength.</p>
<div class="figure" id="id35">
<img alt="Ground Pours Electric Field Trade-off" src="../_images/Ground_Pours_2.png" />
<p class="caption"><span class="caption-number">Fig. 21 </span><span class="caption-text">Ground Pours Electric Field Trade-off</span></p>
</div>
<p>Planes and pours near the electrode and trace must be connected to a potential and cannot be left floating or in a high impedance state. Such structures serve as a mechanism for noise coupling and are strongly discouraged.</p>
</div>
<div class="section" id="separation">
<h4>Separation<a class="headerlink" href="#separation" title="Permalink to this headline">¶</a></h4>
<p>Ground planes, both coplanar and on neighboring PCB layers, reduce noise. This is the same principle discussed in the <a class="reference external" href="ch_design_guide.html#routing">Routing section</a>. The ground or guard structures are placed as close as possible to reduce noise but also kept far enough away to minimize parasitic capacitance. This separation is a function of the thickness of the materials (overlay, adhesive, etc.) on top of the trace. As mentioned in the <a class="reference external" href="ch_design_guide.html#routing">Routing section</a>, a good rule is one-eighth the thickness for separation between traces and ground. The separation between electrodes and ground should be at least one-half the thickness.</p>
<div class="figure" id="id36">
<img alt="Ground Separation" src="../_images/design_ground_separation.png" />
<p class="caption"><span class="caption-number">Fig. 22 </span><span class="caption-text">Ground Separation</span></p>
</div>
<p>As shown in the figure above, the separation between the electrode and the coplanar ground pour should be at least one half the thickness of the overlay material. Any unused electrode should be held at a logic low level (Vss potential) and not allowed to float. In this way the spacing between electrodes is the same as the ground and electrode distance.</p>
</div>
<div class="section" id="pour">
<h4>Pour<a class="headerlink" href="#pour" title="Permalink to this headline">¶</a></h4>
<p>The use of a hatched pour instead of a solid ground pour is a good design practice. This reduces the area and consequently the parasitic capacitance associated with both C_trace and C_electrode. Typically, a 25% fill hatch is sufficient, but this percentage can be increased or decreased to improve noise immunity or sensitivity, respectively.</p>
<div class="figure" id="id37">
<img alt="Example Hatched Ground Fill" src="../_images/design_hatched_gnd_fill.png" />
<p class="caption"><span class="caption-number">Fig. 23 </span><span class="caption-text">Example Hatched Ground Fill</span></p>
</div>
</div>
<div class="section" id="using-poly-cut-out-to-control-ground-pour-around-sensors">
<h4>Using Poly Cut Out to control Ground Pour around Sensors<a class="headerlink" href="#using-poly-cut-out-to-control-ground-pour-around-sensors" title="Permalink to this headline">¶</a></h4>
<p>When designing a button, slider or wheel of any size or shape, a flexible method to control the distance between any sensor and the ground pour is to provide a poly cut-out region around the sensor as shown below.</p>
<div class="figure" id="id38">
<img alt="Define Poly Cut Out Region" src="../_images/design_mutual_buttons_poly_cut.png" />
<p class="caption"><span class="caption-number">Fig. 24 </span><span class="caption-text">Define Poly Cut Out Region</span></p>
</div>
<div class="figure" id="id39">
<img alt="Ground Pour Spacing Controlled" src="../_images/design_mutual_buttons_poly_cut_plane.png" />
<p class="caption"><span class="caption-number">Fig. 25 </span><span class="caption-text">Ground Pour Spacing Controlled</span></p>
</div>
</div>
<div class="section" id="mutual-capacitance-traces">
<h4>Mutual Capacitance Traces<a class="headerlink" href="#mutual-capacitance-traces" title="Permalink to this headline">¶</a></h4>
<p>Routing mutual capacitive traces has special considerations compared to self capacitive traces. Specifically, the TX and RX signals on the same layer should be close only in those areas where coupling through a finger touch is expected by design, such as the case with button, slider or wheel elements (electrodes). Anywhere else that TX and RX traces on the same layer are routed close can be susceptible to a &#8220;ghost&#8221; touch should a finger touch in that area.</p>
<div class="section" id="traces">
<h5>Traces<a class="headerlink" href="#traces" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Avoid routing TX lines near RX lines when possible<ul>
<li>Within a finger spacing, they will create a button</li>
<li>If unable to avoid on same layer, put ground trace in between (adds parasitic capacitance)</li>
<li>If TX needs to cross RX, make crossing perpendicular (minimize surface area intersection)</li>
<li>Avoid running TX on one layer of PCB parallel to RX on other layer of PCB</li>
</ul>
</li>
<li>Route TX lines next to other TX lines</li>
<li>Route RX lines next to other RX lines</li>
<li>Keep nearby ground away from TX and RX traces by 1/2 panel thickness (reduces parasitic capacitance)</li>
</ul>
<p>The diagram below shows an 8-button keypad using (2) TX and (4) RX traces. In this layout the TX and RX traces are on the same layer. The TX traces are routed close to each other as are the RX traces. The TX traces are routed away from the RX traces. In this example there is one RX that must be routed near a TX trace. A ground trace/fill is used to separate the RX and TX traces.</p>
<div class="figure" id="id40">
<img alt="Routing mutual capacitance sensors" src="../_images/design_mutual_mcu.png" />
<p class="caption"><span class="caption-number">Fig. 26 </span><span class="caption-text">Routing mutual capacitance sensors</span></p>
</div>
</div>
<div class="section" id="electrodes">
<h5>Electrodes<a class="headerlink" href="#electrodes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>For noise suppression, use 25% hatched ground on:<ul>
<li>Bottom layer of PCB and/or</li>
<li>On top layer of PCB keeping ground 1/2 panel thickness away from electrode</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="captivate-pin-selection">
<h3>CapTIvate Pin Selection<a class="headerlink" href="#captivate-pin-selection" title="Permalink to this headline">¶</a></h3>
<p>It is important to consider the electrode-to-pin mapping early in the design process, as the pin selection can have significant impact on performance. The pin mapping primarily effects the following parameters:</p>
<ul class="simple">
<li>Measurement time and power consumption, in designs with more than one electrode</li>
<li>Parasitic capacitance, in designs using mutual capacitance</li>
<li>Signal crosstalk, in designs where digital port pins are switching near the CapTIvate pins.</li>
</ul>
<div class="section" id="captivate-pin-nomenclature">
<h4>CapTIvate Pin Nomenclature<a class="headerlink" href="#captivate-pin-nomenclature" title="Permalink to this headline">¶</a></h4>
<p>CapTIvate pins are named CAPx.y on a device datasheet and in the CapTIvate Design Center. In this scheme, &#8216;x&#8217; refers to the CapTIvate block the pin is connected to, and &#8216;y&#8217; refers to the ID of the pin on that CapTIvate block. A CapTIvate block is a capactitance-to-digital conversion engine, and many CapTIvate devices have multiple blocks to enable parallel measurement of multiple sensors, reducing measurement times. For example, let&#8217;s consider a design with two buttons. On an MSP430FR2522 MCU, we could connect those two buttons to the same block or to two different blocks. If we connected both buttons to CAP0.x (say, CAP0.0 and CAP0.1), then we would have to measure them sequentially (one after the other) since they both share the same measurement engine. However, if we would have connected them to CAP0.0 and CAP1.0, we would have been able to measure them at the same time- resulting in half the measurement time. This reduction in measurement time gives the flexibility of being able to
reduce power consumption or increase the scan rate to improve the responsiveness of the sensors.</p>
</div>
<div class="section" id="electrode-to-pin-assignment-procedure">
<h4>Electrode to Pin Assignment Procedure<a class="headerlink" href="#electrode-to-pin-assignment-procedure" title="Permalink to this headline">¶</a></h4>
<p>To obtain an optimum routing, it is recommended to either assign pins automatically (using the CapTIvate Design Center <a class="reference external" href="ch_designcenter.html#mapping-sensor-ports-to-controller-pins">Auto-Assign</a> feature), or manually, using the procedure outlined below.</p>
<ol class="arabic simple">
<li>If the design has more than one electrode (more than one button), and the device selected has more than one CapTIvate block, it is best to assign RX&#8217;s to seperate CapTIvate blocks. This allows for parallel scanning, which reduces measurement time and power consumption. To determine if the device being used has more than one block, check the <a class="reference external" href="ch_device.html#devices">device family</a> chapter.</li>
<li>If the design has mutual capacitance sensors, select the TX pins to be as far away as possible from the RX pins. This reduces parasitic mutual capacitance between the RX&#8217;s and TX&#8217;s, and improves sensitivity. As a general rule, it is still best to spread the RX&#8217;s out across different blocks before considering this step.</li>
<li>If you plan to have digital IO&#8217;s on the MCU that are switching in a frequency range similar to the electrode acquisition frequency, it is best to isolate those signals as much as possible from any RX pins to reduce noise resulting from trace crosstalk. The frequency range of concern is generally 500kHz to 4 MHz. Common offenders in this area are SPI signals and PWM signals routed near sensor RX traces.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="buttons">
<h2>Buttons<a class="headerlink" href="#buttons" title="Permalink to this headline">¶</a></h2>
<div class="section" id="self-capacitive-buttons">
<h3>Self Capacitive Buttons<a class="headerlink" href="#self-capacitive-buttons" title="Permalink to this headline">¶</a></h3>
<p>A self capacitive button sensor is a single electrode. Self capacitive buttons are simple to layout and each button is assigned to only one pin on the MCU. Self capacitive buttons will provide greater sensitivity as compared to a mutual capacitive button, but are more influenced by parasitic capacitances to ground.</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Guidance</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Radiation Pattern</td>
<td>Between Electrode and Ground</td>
</tr>
<tr class="row-odd"><td>Size</td>
<td>Equivalent to interaction</td>
</tr>
<tr class="row-even"><td>Shape</td>
<td>Various: typically round or square</td>
</tr>
<tr class="row-odd"><td>Spacing</td>
<td>0.5 x Overlay minimum thickness</td>
</tr>
</tbody>
</table>
<div class="figure" id="id41">
<img alt="Example Self Capacitive Button Designs" src="../_images/design_self_buttons_finger.png" />
<p class="caption"><span class="caption-number">Fig. 27 </span><span class="caption-text">Example Self Capacitive Button Designs</span></p>
</div>
<div class="section" id="self-capacitive-button-shapes">
<h4>Self Capacitive Button Shapes<a class="headerlink" href="#self-capacitive-button-shapes" title="Permalink to this headline">¶</a></h4>
<p>The electrode shape is typically rectangular or round with common sizes of 10mm and 12mm. Ultimately, the size will depend on the required touch area. A good design practice is to keep the size of the button as small as possible, which minimizes the capacitance and will help with the following:</p>
<ul class="simple">
<li>Reduce susceptibility to noise</li>
<li>Improve sensitivity</li>
<li>Lower power operation due to smaller capacitance and reduced electrode scan time</li>
</ul>
<p>In the diagram below, an example silkscreen button outline pattern is shown.</p>
<div class="figure" id="id42">
<img alt="Example Self Capacitive Button Designs" src="../_images/design_self_buttons.png" />
<p class="caption"><span class="caption-number">Fig. 28 </span><span class="caption-text">Example Self Capacitive Button Designs</span></p>
</div>
<p>The goal of the button area is to provide sufficient signal when the user touches the overlay above the button electrode. Typically a nonconductive decal or ink is used to identify the touch area above the electrode. The relationship between the decal and the electrode can be varied so that contact with the outer edge of the decal registers a touch. Conversely, the electrode could be small to ensure that the button is activated only when the center of the decal is touched. The two figures below show how the effective touch area is a function of the electrode size and the size of the finger.</p>
<div class="figure" id="id43">
<img alt="Effective Area Example for Electrodes Larger Than Decal" src="../_images/design_larger_than_decal.png" />
<p class="caption"><span class="caption-number">Fig. 29 </span><span class="caption-text">Effective Area Example for Electrodes Larger Than Decal</span></p>
</div>
<div class="figure" id="id44">
<img alt="Effective Area Example for Electrode Smaller Than Decal" src="../_images/design_smaller_than_decal.png" />
<p class="caption"><span class="caption-number">Fig. 30 </span><span class="caption-text">Effective Area Example for Electrode Smaller Than Decal</span></p>
</div>
<p>One common mistake is to make the electrode the same shape as the icons printed (in nonconductive ink) on the overlay. As shown in the figure below, this can lead to electrodes with odd shapes that create discontinuities and reduce surface area.</p>
<div class="figure" id="id45">
<img alt="Button Shape Examples, Dos and Don'ts" src="../_images/design_buttons.png" />
<p class="caption"><span class="caption-number">Fig. 31 </span><span class="caption-text">Button Shape Examples, Dos and Don&#8217;ts</span></p>
</div>
<p>As the distance of the overlay increases, the effective area decreases. Therefore, it is important to keep the button electrode diameter at least three times the laminate thickness.</p>
</div>
</div>
<div class="section" id="mutual-capacitive-buttons">
<h3>Mutual Capacitive Buttons<a class="headerlink" href="#mutual-capacitive-buttons" title="Permalink to this headline">¶</a></h3>
<p>A mutual or &#8220;projected&#8221; capacitive button sensor requires two electrodes, one as a TX and the other for RX. It is possible to pack the electrodes closer together with a low risk of cross talk between neighboring electrodes. With mutual capacitive electrodes, multi-touch is also possible by multiplexing the channels. Multiplexing creates up to 64 electrode pairs or &#8220;buttons&#8221; that can be scanned using only 16 CapTIvate™ I/O pins.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Guidance</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Radiation Pattern</td>
<td>Between TX and RX and ground</td>
</tr>
<tr class="row-odd"><td>Size</td>
<td>Equivalent to interaction</td>
</tr>
<tr class="row-even"><td>Shape</td>
<td>Various: recommend square or shape with corners</td>
</tr>
<tr class="row-odd"><td>RX-to-TX Spacing</td>
<td>0.5mm typical</td>
</tr>
<tr class="row-even"><td>RX Thickness</td>
<td>0.5mm typical</td>
</tr>
<tr class="row-odd"><td>TX Thickness</td>
<td>1mm typical</td>
</tr>
</tbody>
</table>
<div class="figure" id="id46">
<img alt="Example Mutual Capacitive Button Designs" src="../_images/design_mutual_buttons_finger.png" />
<p class="caption"><span class="caption-number">Fig. 32 </span><span class="caption-text">Example Mutual Capacitive Button Designs</span></p>
</div>
<div class="section" id="mutual-capacitive-button-shapes">
<h4>Mutual Capacitive Button Shapes<a class="headerlink" href="#mutual-capacitive-button-shapes" title="Permalink to this headline">¶</a></h4>
<p>The electrode shape is typically rectangular with common sizes being 10mm and smaller. Ultimately, the size will depend on the required touch area. In the diagram below, the TX and RX electrodes are identified and a suggested silkscreen button outline pattern is shown. The position of the vias on the TX and RX electrodes provide flexible signal connection points when routing traces.</p>
<ul class="simple">
<li>Simple Square Electrode<ul>
<li>Easiest to layout</li>
<li>Highest sensitivity</li>
<li>TX on outside, RX on inside</li>
<li>For single layer designs, can open TX on one side and feed RX trace through (preferably not in a corner)</li>
<li>Better sensitivity if traces on two layers</li>
</ul>
</li>
</ul>
<div class="figure" id="id47">
<img alt="Example 10mm Mutual Capacitive Button Design)" src="../_images/design_mutual_buttons.png" />
<p class="caption"><span class="caption-number">Fig. 33 </span><span class="caption-text">Example 10mm Mutual Capacitive Button Design)</span></p>
</div>
<p>A good design practice is to keep the size of the button as small as possible, which minimizes the capacitance and will help with the following:</p>
<ul class="simple">
<li>Reduce susceptibility to noise</li>
<li>Improve sensitivity</li>
<li>Lower power operation due to smaller capacitance and reduced electrode scan time</li>
</ul>
<p>The dimensions shown on a 10mm x 10mm example button are suitable for overlay thickness up to 2mm.</p>
<div class="figure" id="id48">
<img alt="10mm Mutual Capacitive Button Dimensions" src="../_images/design_electrode_mut_10mm.png" />
<p class="caption"><span class="caption-number">Fig. 34 </span><span class="caption-text">10mm Mutual Capacitive Button Dimensions</span></p>
</div>
<div class="section" id="mutual-capacitive-tx-rx-electrode-spacing-considerations">
<h5>Mutual Capacitive TX / RX Electrode Spacing Considerations<a class="headerlink" href="#mutual-capacitive-tx-rx-electrode-spacing-considerations" title="Permalink to this headline">¶</a></h5>
<p>The RX-TX spacing is an important design parameter that affects sensitivity, measurement time, and reliability. This is because the RX-TX spacing is a key contributor to the size of the base mutual capacitance that is built in to the PCB. The closer the RX and TX are to each other, the higher the base mutual capacitance. The farther apart they are, the lower the base mutual capacitance. Having a higher base mutual capacitance improves measurement accuracy and repeatability by providing a larger RX voltage swing during measurement. However, the downside of this is that the sensitivity is reduced (because of the higher mutual capacitance, and the lower E-field propagation). TI&#8217;s recommended value for most applications is an RX-TX spacing of 0.5mm.</p>
<div class="figure" id="id49">
<img alt="Example Mutual Capacitive Button Designs" src="../_images/design_mutual_button_flux_spacing.png" />
<p class="caption"><span class="caption-number">Fig. 35 </span><span class="caption-text">Example Mutual Capacitive Button Designs</span></p>
</div>
<p>As mentioned earlier, mutual capacitive electrodes can be multiplexed with other mutual capacitive electrodes. This means that more than one button can share a common signal. In the 8-button example below, the design of the button and placement of vias allow for easy routing to the neighboring buttons. Depending on the orientation of the routing signals, the buttons could be rotated if needed. Taking advantage of CapTIvate™ Technology hardware feature allowing up to four channels to be scanned in parallel, the top four RX channels are measured while TX_0 is driven. The sequence is then repeated for the bottom row. Scanning four channels in parallel reduces the device&#8217;s overall power by reducing the scan time by 4x and it should become apparent that the eight buttons were measured with only six CapTIvate™ I/O pins.</p>
<div class="figure" id="id50">
<img alt="8-Button Multiplexed Mutual Capacitive Example Design" src="../_images/design_mutual_buttons_multiplexed.png" />
<p class="caption"><span class="caption-number">Fig. 36 </span><span class="caption-text">8-Button Multiplexed Mutual Capacitive Example Design</span></p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="sliders-and-wheels">
<h2>Sliders and Wheels<a class="headerlink" href="#sliders-and-wheels" title="Permalink to this headline">¶</a></h2>
<p>Sliders and wheels are multi-electrode sensors. Sliders and wheels with as few as three or four electrodes can provide excellent performance. The CapTIvate™ Software Library supports both sliders and wheels, ranging from 3 to 12 electrodes. While it is certainly possible to use as many electrodes, the layout becomes more difficult, requires more MCU RX pins and generally does not improve the sensor&#8217;s performance. A powerful feature of CapTIvate™ Technology is the ability to scan 4 electrodes in parallel. Optimizing a sensor to take advantage of this hardware feature for a slider or wheel provides the best power and measurement time efficiency.</p>
<p>For both sliders and wheels, the area of the electrode is not as critical as the percentage of coverage across multiple electrodes. As shown in the examples below, interdigitated slider and wheel designs provide the most efficient and optimal coupling, but can be complicated to create. Simpler designs are possible, but require experimentation.</p>
<p>For reference, several self and mutual capacitive slider and wheel sensors examples are illustrated throughout this section and are the same sensors used on the CAPTIVATE-BSWP and CAPTIVATE-PHONE demo PCBs.</p>
<div class="section" id="slider-and-wheel-resolution">
<h3>Slider and Wheel Resolution<a class="headerlink" href="#slider-and-wheel-resolution" title="Permalink to this headline">¶</a></h3>
<p>CapTIvate™ Technology&#8217;s increased sensitivity combined with the CapTIvate™ Software Library provide exceptional linearity and accuracy for slider and wheel resolutions well beyond 10-bit of resolution. By following the design guidelines and examples that follow in this section, designing a slider or wheel with great performance is easy.</p>
<div class="section" id="a-note-about-resolution-vs-number-of-positions">
<h4>A Note About Resolution vs. Number of Positions<a class="headerlink" href="#a-note-about-resolution-vs-number-of-positions" title="Permalink to this headline">¶</a></h4>
<p>For sliders and wheels, the number of discrete positions = the resolution, but because 0 is included as a position, the reported range of positions covers from 0 to (resolution - 1). As an example, if a slider or wheel has a resolution of 1000, the sensor will report 1000 positions, from 0 to 999.</p>
</div>
</div>
<div class="section" id="self-capacitive-sensor-shapes">
<h3>Self Capacitive Sensor Shapes<a class="headerlink" href="#self-capacitive-sensor-shapes" title="Permalink to this headline">¶</a></h3>
<p>In general, self capacitive sensors are also easy to design and route on a PCB. Due to the nature of self-capacitance, self capacitive sliders and wheels have higher sensitivity compared to mutual capacitive sliders and wheels. For that reason they should be considered as a first choice when designing an application. However, self capacitive sensors require one CapTIvate™ I/O pin for each electrode.</p>
<div class="section" id="self-capacitive-slider">
<h4>Self Capacitive Slider<a class="headerlink" href="#self-capacitive-slider" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, a self capacitive slider with great performance can be designed with only three or four electrodes depending the size of the sensor. In fact, a 30cm slider using only four electrodes has been successfully demonstrated with superior linearity and resolution. A basic slider design below uses four RX electrodes. Each electrode is interdigitated and the two end electrodes are electrically connected.</p>
<div class="figure" id="id51">
<img alt="Example 4-Element Slider Design" src="../_images/design_self_slider.png" />
<p class="caption"><span class="caption-number">Fig. 37 </span><span class="caption-text">Example 4-Element Slider Design</span></p>
</div>
</div>
<div class="section" id="self-capacitive-wheel">
<h4>Self Capacitive Wheel<a class="headerlink" href="#self-capacitive-wheel" title="Permalink to this headline">¶</a></h4>
<p>A wheel is basically a slider design with both ends wrapped around and connected together. With CapTIvate™ Technology, a self capacitive wheel only needs three elements to provide exceptional linearity and resolution. A basic wheel design below uses three RX channels. Each electrode is interdigitated.</p>
<div class="figure" id="id52">
<img alt="Example 3-Element Wheel Design" src="../_images/design_self_wheel.png" />
<p class="caption"><span class="caption-number">Fig. 38 </span><span class="caption-text">Example 3-Element Wheel Design</span></p>
</div>
</div>
</div>
<div class="section" id="mutual-capacitive-sensor-shapes">
<h3>Mutual Capacitive Sensor Shapes<a class="headerlink" href="#mutual-capacitive-sensor-shapes" title="Permalink to this headline">¶</a></h3>
<p>Mutual capacitance has a unique feature that allows sensors to multiplexed. Mutual capacitive sliders and wheels can take advantage of this feature by sharing several RX channels with one or more sensors. Because of this, it is possible to have up to 64 electrodes using 16 CapTIvate™ I/O pins. As mentioned earlier, mutual capacitive sensor doesn&#8217;t have the same sensitivity as a self capacitive slider or wheel. However, with CapTIvate™ Technology, mutual capacitive sliders and wheels will provide the same performance as self capacitive sensors.</p>
<div class="section" id="mutual-capacitive-slider">
<h4>Mutual Capacitive Slider<a class="headerlink" href="#mutual-capacitive-slider" title="Permalink to this headline">¶</a></h4>
<p>The following diagram illustrates a four element slider. The outer TX electrode traces surround the interdigitated RX electrodes and are connected together at both ends of the slider. This simple slider design uses four RX and one TX channels.</p>
<div class="figure" id="id53">
<img alt="4 Element Slider Design" src="../_images/design_mutual_slider.png" />
<p class="caption"><span class="caption-number">Fig. 39 </span><span class="caption-text">4 Element Slider Design</span></p>
</div>
<ul class="simple">
<li>TX on outside (track on top and bottom)</li>
<li>RX on inside as triangles</li>
<li>Spacing from TX to RX is 1/2 the overlay thickness</li>
<li>1st and last RX triangle connected to each other</li>
<li>Spacing between TX and RX ~0.5mm</li>
</ul>
</div>
<div class="section" id="mutual-capacitive-wheel">
<h4>Mutual Capacitive Wheel<a class="headerlink" href="#mutual-capacitive-wheel" title="Permalink to this headline">¶</a></h4>
<p>The diagram below illustrates a basic 3 element wheel design. The wheel has two TX circle electrodes surrounding the interdigitated RX electrodes. The wheel is basically a slider design with both ends wrapped around and connected together. This wheel design uses three RX and one TX channels.</p>
<div class="figure" id="id54">
<img alt="3 Element Wheel Design" src="../_images/design_mutual_wheel.png" />
<p class="caption"><span class="caption-number">Fig. 40 </span><span class="caption-text">3 Element Wheel Design</span></p>
</div>
<ul class="simple">
<li>TX Circles on outside and inside of wheel (Need to connect inside and outside together on backside of board)</li>
<li>RX as interdigitated patterns (similar to Self Capacitance Wheel)</li>
<li>Spacing between TX and RX ~1/2 overlay thickness</li>
<li>Ground hatch added inside wheel to provide noise stability. Also ok to have hatching on backside of board. (be careful of total ground loading</li>
<li>Possible to include LED/LED backlight in the center</li>
<li>Difficult to draw</li>
</ul>
<p>As a variation to the design above, the open portion of the wheel on the top PCB layer can be filled with either a solid or hatched ground to improve noise immunity. Providing a additional hatched ground on the bottom layer of the PCB will also help with noise. Using a solid ground on the bottom layer may present too much capacitive loading, so be careful.</p>
<div class="figure" id="id55">
<img alt="3 Element Wheel Design with Center Grounded" src="../_images/design_mutual_wheel_center_ground.png" />
<p class="caption"><span class="caption-number">Fig. 41 </span><span class="caption-text">3 Element Wheel Design with Center Grounded</span></p>
</div>
</div>
<div class="section" id="mutual-capacitive-wheel-with-center-button">
<h4>Mutual Capacitive Wheel with Center Button<a class="headerlink" href="#mutual-capacitive-wheel-with-center-button" title="Permalink to this headline">¶</a></h4>
<p>A great feature to add is a separate &#8220;button&#8221; sensor inside the wheel sensor, if size permits. The design is the same as the basic wheel but a ground separation trace is added between the wheel electrodes and button electrodes. This helps prevent cross talk between the two sensors, should a finger wander slightly off the wheel sensor. This wheel design with center button uses three RX channels and one TX channel for the wheel, one RX and TX channel for the button.</p>
<div class="figure" id="id56">
<img alt="3 Element Wheel Design with Center Button Sensor" src="../_images/design_mutual_wheel_button.png" />
<p class="caption"><span class="caption-number">Fig. 42 </span><span class="caption-text">3 Element Wheel Design with Center Button Sensor</span></p>
</div>
</div>
<div class="section" id="mutual-capacitive-wheel-with-center-leds">
<h4>Mutual Capacitive Wheel with Center LEDs<a class="headerlink" href="#mutual-capacitive-wheel-with-center-leds" title="Permalink to this headline">¶</a></h4>
<p>Similar to the wheel design with a button in the center, it is simple to add a backlighted LED as illustrated in the next diagram. This wheel design with center LED uses three RX channels and one TX channel for the wheel. The LED is driven separately. For additional information about LEDs, refer to <a class="reference external" href="ch_design_guide.html#leds-led-backlighting">LEDs and Backlighting</a>.</p>
<div class="figure" id="id57">
<img alt="3 Element Wheel Design with Center LED" src="../_images/design_mutual_wheel_led.png" />
<p class="caption"><span class="caption-number">Fig. 43 </span><span class="caption-text">3 Element Wheel Design with Center LED</span></p>
</div>
</div>
</div>
</div>
<div class="section" id="proximity">
<h2>Proximity<a class="headerlink" href="#proximity" title="Permalink to this headline">¶</a></h2>
<p>Proximity sensors are electrodes designed to detect a hand or other conductive object at some distance using greater sensitivity compared to buttons, sliders or wheels. For this reason, proximity sensors are recommended to use self capacitive mode and can have one or more electrodes. By having the proximity sensor in your design can reduce the system power consumption and provide the feedback to human interact.</p>
<div class="section" id="proximity-design-considerations">
<h3>Proximity Design Considerations<a class="headerlink" href="#proximity-design-considerations" title="Permalink to this headline">¶</a></h3>
<p>The sensing range of a proximity sensor is dependent upon several factors:</p>
<ol class="arabic simple">
<li>The size and shape of the proximity sensor<ul>
<li>The proximity range increases with the larger sensor size.</li>
<li>The proximity range also affect by the area of the object approaching to the sensor.</li>
<li>The shape of sensor is most limited by end product and it varies from a solid rectangular pad to a piece of wire.</li>
</ul>
</li>
<li>The sensor configuration tuning values<ul>
<li>The proximity range increases with higher sensitivity tuning values.</li>
<li>The values include conversion count, conversion gain, and proximity threshold.</li>
</ul>
</li>
<li>The surrounding conductors<ul>
<li>The proximity range increases with increasing the separation of the sensor from other conductors, such as ground.</li>
</ul>
</li>
<li>The system surrounding environment<ul>
<li>Increasing the sensitivity of the proximity sensor will also enlarge the effects of noise, temperature drifts and humidity drift to the system.</li>
</ul>
</li>
</ol>
<p>Overall, proximity sensor design involves carefully balancing sensor size, sensor configuration, ground shielding and system stability.</p>
</div>
<div class="section" id="proximity-ground-and-shielding">
<h3>Proximity Ground and Shielding<a class="headerlink" href="#proximity-ground-and-shielding" title="Permalink to this headline">¶</a></h3>
<div class="section" id="electric-field-propagation">
<h4>Electric Field Propagation<a class="headerlink" href="#electric-field-propagation" title="Permalink to this headline">¶</a></h4>
<p>As with any self-capacitive sensor, an isotropic electric field is generated from the electrode and is projected in all directions. The field lines will flow from the electrode to any nearby ground potential and can include a nearby hand or earth ground. This means a hand can approach the sensor from any angle and interact with the E-field. If proximity detection is undesirable from the back or the side of the device, this could easily be prevented by manipulating the direction of the E-field’s projection using different shield implementation methods.</p>
<div class="figure" id="id58">
<img alt="PCB with Minimal Parasitic Capacitances" src="../_images/design_proximity_no_parasitic.png" />
<p class="caption"><span class="caption-number">Fig. 44 </span><span class="caption-text">PCB with Minimal Parasitic Capacitances</span></p>
</div>
</div>
<div class="section" id="proximity-sensor-with-no-shield">
<h4>Proximity Sensor with No Shield<a class="headerlink" href="#proximity-sensor-with-no-shield" title="Permalink to this headline">¶</a></h4>
<p>A proximity sensor without any shielding mechanism can be fully functional, but only applicable if detection from any angle can be permitted. In comparison with other implementation methods, having no shield provides high sensitivity, yielding a long range of sensing distance in 360 degrees. Unfortunately, it is almost impossible to avoid having some ground structures on a PCB or in the product. The presence of these ground structures leads to increase parasitic loading on the sensor, which reduces the percentage change in capacitance when a user approaches the sensor. This leads to a reduction in the sensor&#8217;s sensitivity and, ultimately, the detection distance. The proximity electrode on the CAPTIVATE-BSWP board is an example of a sensor without significant shielding.</p>
<div class="figure" id="id59">
<img alt="PCB with Typical Parasitic Capacitances" src="../_images/design_proximity_small_parasitic.png" />
<p class="caption"><span class="caption-number">Fig. 45 </span><span class="caption-text">PCB with Typical Parasitic Capacitances</span></p>
</div>
</div>
<div class="section" id="proximity-sensor-with-ground-shield">
<h4>Proximity Sensor with Ground Shield<a class="headerlink" href="#proximity-sensor-with-ground-shield" title="Permalink to this headline">¶</a></h4>
<p>A proximity sensor with a ground shield is the best implementation method if the goal is to completely obstruct the E-fields projecting towards the back of the electrode. However, utilizing this method significantly reduces the proximity sensor’s range of distance as it introduces parasitic capacitance between the two electrodes and reduces the E-field propagation out into the desired sensing area. The proximity electrode on the CAPTIVATE-PHONE board is an example of a sensor with ground shielding.</p>
<div class="figure" id="id60">
<img alt="PCB with Large Parasitic Capacitances" src="../_images/design_proximity_large_parasitic.png" />
<p class="caption"><span class="caption-number">Fig. 46 </span><span class="caption-text">PCB with Large Parasitic Capacitances</span></p>
</div>
</div>
<div class="section" id="proximity-sensor-with-driven-shield">
<h4>Proximity Sensor with Driven Shield<a class="headerlink" href="#proximity-sensor-with-driven-shield" title="Permalink to this headline">¶</a></h4>
<p>One method to control the amount of parasitic capacitance to nearby ground while maintaining adequate sensitivity is through the use of a driven shield. A driven shield can be implemented by placing a conductive plane directly under the proximity electrode (separated by insulation) and driving it with a signal identical to the signal driving the sensor.</p>
<div class="figure" id="id61">
<img alt="PCB with Proximity Driven Shield" src="../_images/design_proximity_driven_shield.png" />
<p class="caption"><span class="caption-number">Fig. 47 </span><span class="caption-text">PCB with Proximity Driven Shield</span></p>
</div>
<p>If the signals driving both the sensor and shield are in-phase and of the same potential, there will be an absence of an electric field between the two electrodes. Furthermore, the shield’s electric field will repel the sensor’s electric field towards the front of the sensor, providing a fair amount of shielding. As a result, this method greatly restores the sensor’s sensitivity and SNR by minimizing parasitic capacitance.</p>
<p>As shown below, an operational amplifier configured as a voltage-follower buffer is required to drive the shield with a signal identical to the signal driving the sensor. A buffer must be used to continuously supply ample current to the shield to maintain a potential difference of zero between the sensor and the shield elements. As the oscilloscope shot shows that the drive signals for the sensor and the shield are identical.</p>
<div class="figure" id="id62">
<img alt="Driven Shield Configuration" src="../_images/BD_Driving_Sensor_Shield.png" />
<p class="caption"><span class="caption-number">Fig. 48 </span><span class="caption-text">Driven Shield Configuration</span></p>
</div>
<div class="figure" id="id63">
<img alt="Oscilloscope Shot of Signals Driving Sensor and Shield" src="../_images/Oscilloscope_Driving_Sensor_Shield.png" />
<p class="caption"><span class="caption-number">Fig. 49 </span><span class="caption-text">Oscilloscope Shot of Signals Driving Sensor and Shield</span></p>
</div>
<p>The Texas Instruments OPA354 operational amplifier is the recommended IC for this application. The primary requirements for the op-amp are rail-to-rail drive capability, a high slew rate, and high input impedance. The input impedance should consist of a large resistance and a very low common-mode capacitance to ground. The OPA354 has a slew rate of 150V/µs and an input impedance of approximately 10^13Ω in parallel with 2pF of capacitance. The trade-off of using this implementation is higher BOM cost and increased power consumption.</p>
<p>The graph below shows how the three different implementation methods (ground shield, driven shield, and no shield) respond to approaches above and below the sensor. Data was collected for each variation of shields by holding a 15.2cm x 10.2cm grounded copper plate (simulating a hand) approximately 3cm over and under a sensor board (shown below) with a 4.6cm x 3.8cm sensor electrode. The measurement delta was obtained using the CapTIvate Design Center GUI. Comparing the driven shield data to the ground shield, the MCU is still able to detect a small change in capacitance caused by an object 3cm under the proximity sensor but is able to deliver approximately 7 times the sensitivity from the front. An easy solution to completely eliminate detection from the back is placing an additional grounded shield under the driven shield. Adding the ground shield will not weaken the proximity sensor’s sensitivity.</p>
<div class="figure">
<img alt="" src="../_images/Data_Driving_Sensor_Shield.png" />
</div>
</div>
</div>
<div class="section" id="proximity-range-test">
<h3>Proximity Range Test<a class="headerlink" href="#proximity-range-test" title="Permalink to this headline">¶</a></h3>
<p>We performed the proximity range test with six different sensor designs using the setup shown below. The copper plate (simulating a hand) is mounted on a robust moving metal rod structure. This provide an accurate test system to collect proximity range data without interference of the object around the sensor.</p>
<div class="figure" id="id64">
<img alt="Proximity Range Test Setup" src="../_images/Range_Test_Setup.png" />
<p class="caption"><span class="caption-number">Fig. 50 </span><span class="caption-text">Proximity Range Test Setup</span></p>
</div>
<p>The layout and the actual sensor boards are shown below:</p>
<ul class="simple">
<li>Sensor 1 is a 80mm by 50mm with 10mm wide rectangular ring shape with a full back hatched ground.</li>
<li>Sensor 2 is a 80mm by 50mm with 10mm wide rectangular ring shape with a center hatched ground.</li>
<li>Sensor 3 is a 80mm by 50mm with 10mm wide rectangular ring shape with no ground.</li>
<li>Sensor 4 is a 80mm by 50mm with 10mm wide rectangular ring shape with a driven shield.</li>
<li>Sensor 5 is a 80mm by 50mm solid rectangular shape with no ground.</li>
<li>Sensor 6 is a 60mm by 30mm solid rectangular shape with no ground.</li>
</ul>
<div class="figure" id="id65">
<img alt="Proximity Range Test PCB Layouts" src="../_images/Range_Test_PCB.png" />
<p class="caption"><span class="caption-number">Fig. 51 </span><span class="caption-text">Proximity Range Test PCB Layouts</span></p>
</div>
<div class="figure" id="id66">
<img alt="Proximity Range Test Hardware" src="../_images/Range_Test_HW.png" />
<p class="caption"><span class="caption-number">Fig. 52 </span><span class="caption-text">Proximity Range Test Hardware</span></p>
</div>
<p>The tables below shows the range data we collected based on different sensors, conversion count, and proximity threshold. The range data meet the expectation of the proximity sensor design consideration.</p>
<ul class="simple">
<li>Compare sensor 3, 5, 6, the range increase with the sensor size</li>
<li>Compare sensor 1, 2, 3, 4, the range increase with increasing the separation of sensor from GND.</li>
<li>Compare table 1 and table 2, the range increase with increasing the conversion count.</li>
<li>Compare table 3 and table 4, the range increase with decreasing the proximity threshold.</li>
</ul>
<div class="figure" id="id67">
<img alt="Proximity Range Test Results With Change of Conversion Count" src="../_images/Range_Test_Count.png" />
<p class="caption"><span class="caption-number">Fig. 53 </span><span class="caption-text">Proximity Range Test Results With Change of Conversion Count</span></p>
</div>
<div class="figure" id="id68">
<img alt="Proximity Range Test Results With Change of Proximity Threshold" src="../_images/Range_Test_Threshold.png" />
<p class="caption"><span class="caption-number">Fig. 54 </span><span class="caption-text">Proximity Range Test Results With Change of Proximity Threshold</span></p>
</div>
</div>
</div>
<div class="section" id="metal-touch">
<h2>Metal Touch<a class="headerlink" href="#metal-touch" title="Permalink to this headline">¶</a></h2>
<p>Compared to traditional capacitive sensing through plastics or glass, capacitive metal touch is only sensitive to an applied force and for this reason is an excellent choice for harsh or hostile environments where there are liquids, grease, mud or grime present and environments where a user may be wearing gloves. The principle of measuring the capacitance is straight forward for metal touch applications as the deflection in the grounded metal overlay causes a change in the capacitance between the electrodes and the metal overlay.</p>
<div class="figure" id="id69">
<img alt="pcb" src="../_images/evm_metal_how_it_works.png" />
<p class="caption"><span class="caption-number">Fig. 55 </span><span class="caption-text">pcb</span></p>
</div>
<div class="section" id="design-considerations">
<h3>Design Considerations<a class="headerlink" href="#design-considerations" title="Permalink to this headline">¶</a></h3>
<p>The mechanical stackup plays an important role as it will ultimately determine the sensitivity and quality of user experience. There are many design factors to consider, such as the thickness of the metal overlay, the size of the electrode, what type of bonding material, thickness and technique, etc.</p>
<p>For design assistance, refer to the CapTIvate™ Metal Touch application notes and metal deflection tool located at <a class="reference external" href="http://www.ti.com/captivate">http://www.ti.com/captivate</a></p>
</div>
</div>
<div class="section" id="transparent-touch">
<h2>Transparent Touch<a class="headerlink" href="#transparent-touch" title="Permalink to this headline">¶</a></h2>
<p>For applications that incorporates capacitive-touch technology in a HMI designs as touch sensors over liquid crystal displays (LCDs), optically transparent&nbsp;sensors are required. And most transparent capacitive-touch sensors are built using indium tin oxide (ITO).</p>
<div class="section" id="indium-tin-oxide-ito">
<h3>Indium Tin Oxide (ITO)<a class="headerlink" href="#indium-tin-oxide-ito" title="Permalink to this headline">¶</a></h3>
<p>Indium Tin Oxide (ITO) is a transparent conductor sputtered onto a substrate such as glass or plastic. Once the substrate has been coated with ITO, a pattern can be etched using a variety of processes.</p>
<div class="figure" id="id70">
<img alt="ITO\_1" src="../_images/ITO_1.png" />
<p class="caption"><span class="caption-number">Fig. 56 </span><span class="caption-text">ITO_1</span></p>
</div>
<p>Because ITO is a optical transparent material so the stack up of the ITO capacitive touch sensor is different from a traditional copper sensors like the below graph shows.</p>
<div class="figure" id="id71">
<img alt="ITO Stack Up 1" src="../_images/ITO_3.png" />
<p class="caption"><span class="caption-number">Fig. 57 </span><span class="caption-text">ITO Stack Up 1</span></p>
</div>
<div class="figure" id="id72">
<img alt="ITO Stack Up 2" src="../_images/ITO_4.png" />
<p class="caption"><span class="caption-number">Fig. 58 </span><span class="caption-text">ITO Stack Up 2</span></p>
</div>
<p>There are many advantages over a full-featured touchscreen solution by using CapTIvate technology with ITO sensors:</p>
<ul class="simple">
<li>Lower system cost</li>
<li>Shorter development time</li>
<li>Higher reliability</li>
<li>Lower power consumption</li>
<li>Proximity sensing feature</li>
<li>Preserving durability</li>
</ul>
<p>To learn more about ITO capacitive touch sensor with CapTIvate technology please refer to:</p>
<p>White Paper: <a class="reference external" href="http://www.ti.com/lit/wp/sway006/sway006.pdf">http://www.ti.com/lit/wp/sway006/sway006.pdf</a></p>
<p>Demo Video: <a class="reference external" href="http://www.ti.com/product/MSP430FR2633/support">http://www.ti.com/product/MSP430FR2633/support</a></p>
<p>Blog: <a class="reference external" href="https://e2e.ti.com/blogs_/b/msp430blog/archive/2017/10/26/the-power-of-capacitive-touch-that-you-can-t-see">https://e2e.ti.com/blogs_/b/msp430blog/archive/2017/10/26/the-power-of-capacitive-touch-that-you-can-t-see</a></p>
<!---

## Haptics
Add haptics content here
---></div>
</div>
<div class="section" id="ultra-low-power">
<h2>Ultra Low Power<a class="headerlink" href="#ultra-low-power" title="Permalink to this headline">¶</a></h2>
<p>The MSP430 CapTIvate™ peripheral is capable of enabling user interface designs with extremely low power consumption. This is possible because the CapTIvate™ peripheral includes a processing state machine that is capable of performing the following functions from LPM3 without any CPU interaction whatsoever:</p>
<ol class="arabic simple">
<li>Wake up the CapTIvate measurement blocks from deep sleep (LPM3) at a periodic interval</li>
<li>Start a conversion automatically (1 electrode per measurement block, or 4 electrodes on the MSP430FR2633)</li>
<li>Finish the conversion</li>
<li>Perform IIR noise filtering (adjustable strength)</li>
<li>Perform a threshold crossing detection (adjustable window comparator)</li>
<li>If a threshold was crossed, wake up the CPU</li>
<li>Otherwise, perform environmental drift compensation (adjustable strength)</li>
<li>Shut down the CapTIvate measurement blocks and wait until the next interval, then go back to #1</li>
</ol>
<p>This capability combined with the MSP430 FRAM low power architecture enables designs with average current in the single digit microamps.</p>
<div class="section" id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Designing for low power consumption involves optimizing the hardware and the tuning to achieve 5 basic things:</p>
<ol class="arabic simple">
<li>The lowest <a class="reference external" href="ch_design_guide.html#optimization-steps">base LPM3 current</a> possible</li>
<li>The slowest <a class="reference external" href="ch_glossary.html#system-report-rate">UI refresh rate</a> possible (software design)</li>
<li>The smallest <a class="reference external" href="ch_basics.html#self-capacitance-parsitics">parasitic capacitance</a> possible (hardware design)</li>
<li>The shortest <a class="reference external" href="ch_glossary.html#time-estimation">measurement time</a> possible (hardware and software design)</li>
<li>The most effective use of the wake-on-proximity state machine</li>
</ol>
<p>In short, achieving the lowest possible power consumption is all about optimizing the duty cycle of the application - <strong>minimizing the amount of time that the CPU and high performance analog are awake, and maximizing the amount of time spent in deep sleep</strong>.</p>
</div>
<div class="section" id="expectations">
<h3>Expectations<a class="headerlink" href="#expectations" title="Permalink to this headline">¶</a></h3>
<p>Below are several test cases that have been bench verified with the MSP430FR2633 on the CAPTIVATE-FR2633 processor module.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="13%" />
<col width="6%" />
<col width="8%" />
<col width="11%" />
<col width="7%" />
<col width="7%" />
<col width="13%" />
<col width="10%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sensor Configuration</th>
<th class="head">Mode</th>
<th class="head">Method</th>
<th class="head">Scan Rate</th>
<th class="head">Base Scan Time</th>
<th class="head">LF Clock</th>
<th class="head">I-avg</th>
<th class="head">I-avg / Electrode</th>
<th class="head">Years on AAAs</th>
<th class="head">Years on a CR2032</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1 Proximity Sensor</td>
<td>Wake-on-Proximity</td>
<td>Self</td>
<td>8 Hz</td>
<td>420us</td>
<td>Crystal</td>
<td>5uA</td>
<td>5uA</td>
<td>16</td>
<td>3.6</td>
</tr>
<tr class="row-odd"><td>1 Proximity Sensor</td>
<td>Active (CPU)</td>
<td>Self</td>
<td>8 Hz</td>
<td>420us</td>
<td>Crystal</td>
<td>7.3uA</td>
<td>7.3uA</td>
<td>10.9</td>
<td>2.5</td>
</tr>
<tr class="row-even"><td>1 Button</td>
<td>Wake-on-Proximity</td>
<td>Self</td>
<td>8 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>3.4uA</td>
<td>3.4uA</td>
<td>23.5</td>
<td>5.3</td>
</tr>
<tr class="row-odd"><td>1 Button</td>
<td>Active (CPU)</td>
<td>Self</td>
<td>8 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>6.0uA</td>
<td>6.0uA</td>
<td>13.3</td>
<td>3.0</td>
</tr>
<tr class="row-even"><td>4 Buttons</td>
<td>Wake-on-Proximity</td>
<td>Self</td>
<td>8 Hz</td>
<td>120us</td>
<td>Crystal</td>
<td>3.0uA</td>
<td>750nA</td>
<td>26</td>
<td>6.0</td>
</tr>
<tr class="row-odd"><td>4 Buttons</td>
<td>Wake-on-Proximity</td>
<td>Self</td>
<td>8 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>3.8uA</td>
<td>0.9uA</td>
<td>21</td>
<td>4.7</td>
</tr>
<tr class="row-even"><td>4 Buttons</td>
<td>Wake-on-Proximity</td>
<td>Self</td>
<td>30 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>9.4uA</td>
<td>2.4uA</td>
<td>8.5</td>
<td>1.9</td>
</tr>
<tr class="row-odd"><td>4 Buttons</td>
<td>Active (CPU)</td>
<td>Self</td>
<td>8 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>8.7uA</td>
<td>2.2uA</td>
<td>9.2</td>
<td>2.1</td>
</tr>
<tr class="row-even"><td>8 Buttons</td>
<td>Active (CPU)</td>
<td>Self</td>
<td>8 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>14.5uA</td>
<td>1.8uA</td>
<td>5.5</td>
<td>1.2</td>
</tr>
<tr class="row-odd"><td>8 Buttons</td>
<td>Active (CPU)</td>
<td>Self</td>
<td>15 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>25.9uA</td>
<td>3.2uA</td>
<td>3.0</td>
<td>0.7</td>
</tr>
<tr class="row-even"><td>8 Buttons</td>
<td>Active (CPU)</td>
<td>Self</td>
<td>30 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>50.1uA</td>
<td>6.3uA</td>
<td>1.5</td>
<td>0.3</td>
</tr>
<tr class="row-odd"><td>64 Buttons</td>
<td>Active (CPU)</td>
<td>Mutual</td>
<td>8 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>109.2uA</td>
<td>1.7uA</td>
<td>0.7</td>
<td>0.2</td>
</tr>
<tr class="row-even"><td>64 Buttons</td>
<td>Active (CPU)</td>
<td>Mutual</td>
<td>15 Hz</td>
<td>145us</td>
<td>Crystal</td>
<td>203.5uA</td>
<td>3.0uA</td>
<td>0.35</td>
<td>0.08</td>
</tr>
</tbody>
</table>
<p>Note: These measurements were captured using a high resolution source-meter with UART/I2C communications disabled. Battery life was approximated assuming 1000mAh AAA&#8217;s and 225mAh CR2032 cells with 70% effective usable life.</p>
<div class="figure" id="id73">
<img alt="Power Characterization Bench" src="../_images/design_poweranalyzer.png" />
<p class="caption"><span class="caption-number">Fig. 59 </span><span class="caption-text">Power Characterization Bench</span></p>
</div>
<p>Note how the wake-on-proximity state machine is able to increase the battery life by over a year on a CR2032 coin cell for the proximity sensor, and over 2 years for a basic button.</p>
</div>
<div class="section" id="optimization-steps">
<h3>Optimization Steps<a class="headerlink" href="#optimization-steps" title="Permalink to this headline">¶</a></h3>
<p>The following sections discuss how to optimize the design to achieve the 5 goals introduced above.</p>
<div class="section" id="selecting-a-low-frequency-clock">
<h4>Selecting a Low Frequency Clock<a class="headerlink" href="#selecting-a-low-frequency-clock" title="Permalink to this headline">¶</a></h4>
<p>The lowest power consumption achievable is limited by the deep sleep current consumption of the MCU. From there, power consumption will rise with the complexity of the panel and rate at which the panel is scanned. In deep sleep (low power mode 3), since it is not possible to achieve a lower average current than the LPM3 current, the low frequency clock that is selected for the application must be considered. Below are the low frequency clock options available for the MSP430FR2633 MCU.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="22%" />
<col width="16%" />
<col width="22%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">LF Clock Source</th>
<th class="head">Typical LPM3 Base Current</th>
<th class="head">Typical Frequency</th>
<th class="head">Typical Relative Accuracy</th>
<th class="head">Typical Relative Cost</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Crystal</td>
<td>1.2uA</td>
<td>32768 Hz</td>
<td>Best</td>
<td>External Component (Highest)</td>
</tr>
<tr class="row-odd"><td>REFO</td>
<td>16uA</td>
<td>32768 Hz</td>
<td>Good</td>
<td>Internal (Lowest)</td>
</tr>
<tr class="row-even"><td>VLO</td>
<td>1uA</td>
<td>10000 Hz</td>
<td>Poor</td>
<td>Internal (Lowest)</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>If budget and PCB space constraints allow for it, an external 32 kHz crystal provides the best combination of accuracy and low power.</li>
<li>If accuracy is still required but an external crystal cannot be used, then the REFO will provide a decent 32 kHz time base at the expense of higher power consumption.</li>
<li>If an external crystal cannot be used and accuracy is not application critical, than the VLO provides the lowest possible power.</li>
</ul>
<div class="section" id="using-the-vlo-in-wake-on-proximity-mode">
<h5>Using the VLO in Wake-on-Proximity Mode<a class="headerlink" href="#using-the-vlo-in-wake-on-proximity-mode" title="Permalink to this headline">¶</a></h5>
<p>The CAPT_App layer of the <a class="reference external" href="ch_library.html#starting-from-scratch-with-the-starter-project">Starter Project</a> contains a provision for using the VLO as the clock source to the CapTIvate timer. This may be desirable for applications that require very low power but cannot use a crystal for some reason. When the VLO is used as the clock source for the CapTIvate timer, it is possible to run CapTIvate&#8217;s wake-on-proximity mode while in LPM4, rather than the typical LPM3. When in LPM4, ACLK is turned off completely. This means that if the REFO was the ACLK source, the REFO will also be shut down in LPM4, lowering average power consumption. To enable the VLO+LPM4 combination when in wake-on-proximity mode, go to controller properties and check the Force LPM4 in Wake-on-Prox Mode box. This will cause the application low power mode to switch to LPM4 when in the wake-on-proximity state. It will also set up the CapTIvate timer to run off of the VLO when in the wake-on-proximity state. Once the
application wakes back up and the UI switches to active mode, ACLK and LPM3 will again be used to ensure timing accuracy.</p>
<div class="figure" id="id74">
<img alt="Force LPM4 in Wake-on-Prox Mode" src="../_images/design_force_lpm4.png" />
<p class="caption"><span class="caption-number">Fig. 60 </span><span class="caption-text">Force LPM4 in Wake-on-Prox Mode</span></p>
</div>
<p>While the VLO can provide low power consumption without the use of a crystal, it is not as accurate as a crystal. Designers should be aware that the VLO clock frequency can drift considerably with voltage and temperature. See the device specific datasheet for more details. The variance in the VLO clock frequency can show up as a change in the response time of the application. For example, of the frequency drifts low, CapTIvate touch sensors may take longer than usual to respond. Likewise, if the frequency drifts high, sensors may respond faster than usual. In the second case, the power consumption may also be higher than expected because the sensors are being measured more frequently than intended. It is possible to improve the usage of the VLO by implementing a calibration routine that trims the scan interval setting by comparing the VLO to a more accurate clock (such as the REFO).</p>
</div>
</div>
<div class="section" id="optimizing-the-application-scan-period">
<h4>Optimizing the Application Scan Period<a class="headerlink" href="#optimizing-the-application-scan-period" title="Permalink to this headline">¶</a></h4>
<p>The application <a class="reference external" href="ch_glossary.html#system-report-rate">scan period</a> is the amount of time between each sampling of the user interface. For example, if the period is set to 100ms, then the user interface is sampled every 100ms, or at a rate of 10Hz. If the period is set to 10ms, then the user interface is sampled at a rate of 100Hz. The scan period has a direct effect on the power consumption, as it controls the duty cycle of the application. When a lower period (higher rate) is selected, the CapTIvate analog and possibly the CPU are waking up much more frequently- consuming more power. The design tradeoff here is response time versus power consumption. Scanning less often reduces the power consumption, but also increases the response time of the user interface. The CapTIvate™ starter project implements an active mode scan rate and a wake-on-proximity scan rate. This allows for a longer response time to be used when no one is touching the panel, and a shorter response time to be used
when someone is touching the panel. The <a class="reference external" href="ch_evm.html#captivate-bswp-demonstratio-out-of-box-experience">CAPTIVATE-BSWP</a> demo panel runs at 10 Hz (100ms response time) when in wake-on-proximity mode, and at 30 Hz (33ms response time) when in active mode.</p>
</div>
<div class="section" id="optimizing-for-the-smallest-parasitic-capacitance">
<h4>Optimizing for the Smallest Parasitic Capacitance<a class="headerlink" href="#optimizing-for-the-smallest-parasitic-capacitance" title="Permalink to this headline">¶</a></h4>
<p>When a sensor has a low <a class="reference external" href="ch_basics.html#self-capacitance-parsitics">parasitic capacitance</a>, it is more sensitive to touch (all else being equal). This means that the sensor may be scanned at a lower resolution to obtain the same resolution and SNR. A lower resolution conversion means a lower measurement time. Battery powered applications typically do not have the same noise immunity requirements as line powered applications, so solid ground fills that limit sensitivity are generally not required. In addition, when sensors have low parasitic capacitance the conversion frequency may be increased while still ensuring good charge transfer.</p>
</div>
<div class="section" id="optimizing-for-the-shortest-measurement-time">
<h4>Optimizing for the Shortest Measurement Time<a class="headerlink" href="#optimizing-for-the-shortest-measurement-time" title="Permalink to this headline">¶</a></h4>
<p>The measurement time for each sensor should be optimized to be as small as possible. When the CapTIvate™ analog IP is operational, it draws several 100uA of current. The goal should be to minimize the measurement time so that the analog is only enabled for a brief period of time.</p>
<p>In the CapTIvate™ Design Center, the measurement time is a function of the following factors:</p>
<ol class="arabic simple">
<li><a class="reference external" href="ch_glossary.html#frequency-divider">Frequency Divider</a> (Conversion clock frequency selection)</li>
<li><a class="reference external" href="ch_glossary.html#phase-lengths">Phase Lengths</a></li>
<li><a class="reference external" href="ch_glossary.html#conversion-count">Conversion Count</a> (Base number of charge transfers without a touch)</li>
</ol>
<p>The measurement time may be calculated manually per the following formula. It is also <a class="reference external" href="ch_glossary.html#time-estimation">calculated automatically</a> in the CapTIvate™ Design Center.</p>
<div class="figure" id="id75">
<img alt="Scan Time Calculation" src="../_images/design_scantime_formula.png" />
<p class="caption"><span class="caption-number">Fig. 61 </span><span class="caption-text">Scan Time Calculation</span></p>
</div>
<p><strong>Constants</strong></p>
<ul class="simple">
<li>STABLETIME=320</li>
<li>CAPOSC[0]=16000000</li>
<li>CAPOSC[1]=14700000</li>
<li>CAPOSC[2]=13100000</li>
<li>CAPOSC[3]=11200000</li>
</ul>
<p>If the sensors have fairly low parasitic capacitance, a conversion frequency of 2MHz for self capacitance and 4MHz for mutual capacitance is a reasonable setting. With phase lengths of 1, this is achieved by setting the frequency divider to /4 and /2, respectively.</p>
<p>The <a class="reference external" href="ch_glossary.html#conversion-count">conversion count</a> controls the resolution of the measurement. Decreasing this value decreases the overall resolution of the measurement (in terms of counts per picofarad). To optimize the resolution, decrease this value until the minimum acceptable delta due to a touch is reached.</p>
</div>
<div class="section" id="using-the-wake-on-proximity-state-machine-effectively">
<h4>Using the Wake-on-Proximity State Machine Effectively<a class="headerlink" href="#using-the-wake-on-proximity-state-machine-effectively" title="Permalink to this headline">¶</a></h4>
<p>The wake-on-proximity state machine allows for CPU-less measurement and processing for 1 element per measurement block (4 elements total with the MSP430FR2633). Most sensing panels are actually touched &lt;1% of the total time that they are running. 99% or more of the time, they are waiting for a user. The state machine provides a mechanism to handle the latter 99% without the need to involve the CPU, reducing the average current. A sensor may be <a class="reference external" href="ch_designcenter.html#select-compile-time-options">selected as a wake-on-proximity sensor</a> in the CapTIvate™ Design Center. When a sensor is selected, the starter project that is generated by the CapTIvate™ Design Center will transition into a wake-on-proximity mode whenever the inactivity timeout counter expires. In wake-on-proximity mode, the first cycle of the sensor that was selected for wake-on-proximity will be automatically measured by the state machine, and the CPU will not receive an interrupt until one of the following occurs:</p>
<ol class="arabic simple">
<li>A proximity or negative touch threshold crossing occurs</li>
<li>A conversion counter interrupt occurs</li>
</ol>
<p>The wake-on-proximity feature is best used with longer-range proximity sensors, such as the one on the <a class="reference external" href="ch_evm.html#out-of-box-experience">CAPTIVATE-BSWP</a> demo panel. However, if an MSP430FR2633 design has 4 buttons or less, it is possible to use the wake-on-proximity state machine functionality to wake up on any of the four buttons!</p>
</div>
</div>
<div class="section" id="walking-through-the-optimization-process">
<h3>Walking Through the Optimization Process<a class="headerlink" href="#walking-through-the-optimization-process" title="Permalink to this headline">¶</a></h3>
<p>In this example, the CAPTIVATE-BSWP panel will be used as a piece of test hardware to look at how to optimize an imaginary application that has 4 buttons. From start to finish, going through this exercise will transform the average current of the solution from 100&#8217;s of microamps to single digit microamps. To run the completed example, check out the <a class="reference external" href="ch_evm.html#ultra-low-power-four-buttons-demonstration">UltraLowPower_4Button</a> example project.</p>
<div class="section" id="step-1-creating-a-new-project">
<h4>Step 1: Creating a New Project<a class="headerlink" href="#step-1-creating-a-new-project" title="Permalink to this headline">¶</a></h4>
<p>To start, a new CapTIvate™ Design Center project will be created that has a button group sensor with 4 buttons. The buttons will be on CAP0.0, CAP1.0, CAP2.0, and CAP3.0. This mapping allows for parallel scanning, which is important for power optimization. All of the default tuning parameters will be kept initially:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="17%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Optimized?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>COMM Peripheral</td>
<td>UART</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Active Scan Rate</td>
<td>33</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Wake-on-Proximity Scan Rate</td>
<td>N/A</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Conversion Count</td>
<td>500</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Frequency Divider</td>
<td>f/4</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<div class="figure" id="id76">
<img alt="Design Center Configuration" src="../_images/design_lowpowerbuttons_canvas.png" />
<p class="caption"><span class="caption-number">Fig. 62 </span><span class="caption-text">Design Center Configuration</span></p>
</div>
<p>Out of all the default configuration values, only the frequency divider is optimized (f/4 with phase lengths of 1 for a conversion frequency of 2 MHz). This yields a starting, un-optimized current of approximately <strong>310 uA-avg</strong>. We can do better than this! Note that LED1 and LED2 of the CAPTIVATE-FR2633 processor module must be disconnected, or the measured power will be higher.</p>
</div>
<div class="section" id="step-2-switch-from-uart-to-i2c">
<h4>Step 2: Switch from UART to I2C<a class="headerlink" href="#step-2-switch-from-uart-to-i2c" title="Permalink to this headline">¶</a></h4>
<p>UART requires that SMCLK be active for the baud rate generator to work. By switching to I2C for data transfer, we are able to go to LPM3 instead OF LPM0. This is possible because as a slave, the MSP does not need to provide a clock for I2C to operate.</p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="31%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Optimized?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>COMM Peripheral</td>
<td>Bulk-I2C (Slave)</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Low Power Mode</td>
<td>LPM3</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Active Scan Rate</td>
<td>33</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Wake-on-Proximity Scan Rate</td>
<td>N/A</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Conversion Count</td>
<td>500</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Frequency Divider</td>
<td>f/4</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<div class="figure" id="id77">
<img alt="Design Center Configuration" src="../_images/design_uart_to_i2c.png" />
<p class="caption"><span class="caption-number">Fig. 63 </span><span class="caption-text">Design Center Configuration</span></p>
</div>
<p>Making this change has lowered the current to <strong>68 uA-avg</strong>. We can still do better! Note that the Design Center must be connected to see these power numbers, otherwise the I2C requests will time out, using more power.</p>
</div>
<div class="section" id="step-3-optimize-the-conversion-count">
<h4>Step 3: Optimize the Conversion Count<a class="headerlink" href="#step-3-optimize-the-conversion-count" title="Permalink to this headline">¶</a></h4>
<p>The project came with a default conversion count of 500. This provides a delta due to touch of about 80 on the 4 buttons. This is more resolution than is needed. Lowering the conversion count to 200 and the conversion gain to 100 (to boost sensitivity) will cut the measurement time more than in half, and still provide a delta of about 30 counts. 30 counts is significantly less, but for button detection in a battery powered application, it is adequate. The default touch thresholds still work as well.</p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="31%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Optimized?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>COMM Peripheral</td>
<td>Bulk-I2C (Slave)</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Active Scan Rate</td>
<td>33</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Wake-on-Proximity Scan Rate</td>
<td>N/A</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Conversion Count</td>
<td>200</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Frequency Divider</td>
<td>f/4</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>These changes lower the current to <strong>38 uA-avg</strong>. We are getting there.</p>
</div>
<div class="section" id="step-4-adjusting-the-active-mode-scan-period">
<h4>Step 4: Adjusting the Active Mode Scan Period<a class="headerlink" href="#step-4-adjusting-the-active-mode-scan-period" title="Permalink to this headline">¶</a></h4>
<p>The default scan period of 33ms provides good response time, but it uses power. Adjusting this down to 83ms (12 Hz) will reduce the power, but not so much that it compromises the ability to pick up a press.</p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="31%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Optimized?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>COMM Peripheral</td>
<td>Bulk-I2C (Slave)</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Active Scan Rate</td>
<td>83</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Wake-on-Proximity Scan Rate</td>
<td>N/A</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Conversion Count</td>
<td>200</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Frequency Divider</td>
<td>f/4</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>This change lowered the current to <strong>26 uA-avg</strong>.</p>
</div>
<div class="section" id="step-5-enabling-and-adjusting-the-wake-on-proximity-mode">
<h4>Step 5: Enabling and Adjusting the Wake-on-Proximity Mode<a class="headerlink" href="#step-5-enabling-and-adjusting-the-wake-on-proximity-mode" title="Permalink to this headline">¶</a></h4>
<p>Now to add the final touches, let&#8217;s enable the wake-on-proximity state machine functionality to manage states. We only have 4 buttons, with one from each measurement block, so we can measure all 4 buttons and test for proximity without any CPU involvement.</p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="31%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Optimized?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>COMM Peripheral</td>
<td>Bulk-I2C (Slave)</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Low Power Mode</td>
<td>LPM3</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Active Scan Rate</td>
<td>83</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Wake-on-Proximity Scan Rate</td>
<td>125</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Conversion Count</td>
<td>200</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Frequency Divider</td>
<td>f/4</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>The capture below shows the conversion control tab of the controller customizer, which contains most of the settings that we have been adjusting to optimize for low power.</p>
<div class="figure" id="id78">
<img alt="Lower Power Settings" src="../_images/design_lowpower_settings.png" />
<p class="caption"><span class="caption-number">Fig. 64 </span><span class="caption-text">Lower Power Settings</span></p>
</div>
<p>This change lowered the current to <strong>3 uA-avg</strong>, or about 750nA per button when no one is touching the panel. As soon as a user touches a button, the power consumption goes up to 23-26uA-avg with I2C reporting. Once the touch is removed, the UI goes back into wake-on-proximity mode after 32 samples and is back to the 3 uA-avg.</p>
</div>
</div>
<div class="section" id="a-note-about-mutual-capacitance-and-bias-current">
<h3>A Note about Mutual Capacitance and Bias Current<a class="headerlink" href="#a-note-about-mutual-capacitance-and-bias-current" title="Permalink to this headline">¶</a></h3>
<p>Mutual capacitance sensors have an extra tuning parameter: the bias current. During a mutual capacitance measurement, a sample-and-hold amplifier cancels out the effects of the parasitic / stray self capacitance on the receive electrode. This sample-and-hold amplifier has an adjustable bias current capability, which allows for the drive strength of the amplifier to be adjusted to suite the application.</p>
<p>For information on bias current settings how to adjust the bias current, see the <a class="reference external" href="ch_glossary.html#bias-current">bias current guide</a>. Note that the bias current control is only available in <a class="reference external" href="ch_designcenter.html#features">advanced mode</a>.</p>
<p>A larger bias current setting should be used when the parasitic capacitance to ground of the Rx electrode is large. The default value is the highest possible bias current, which works for the most applications but requires the highest power consumption. During low power optimization, it is desirable to lower the bias current if the layout allows for it. Most button designs with minimal parasitic capacitance work very well with the lowest bias current setting.</p>
<div class="section" id="bias-current-optimization-procedure">
<h4>Bias Current Optimization Procedure<a class="headerlink" href="#bias-current-optimization-procedure" title="Permalink to this headline">¶</a></h4>
<p>To optimize the bias current setting for a low power application, begin by setting the bias current to the lowest available setting. Test each electrode in the sensor for sensitivity to touch. One effect of setting the bias current too low is that a touch on a sensor will cause a decrease in counts rather than an increase, because the system cannot accurately compensate for the parasitic self capacitance of the receive (Rx) electrode. If this occurs, continue increasing the bias current until the behavior goes away. Note that the bias current performance also varies with the conversion frequency. Higher conversion frequencies will require higher bias current settings for designs with more parasitic capacitance to ground.</p>
</div>
</div>
</div>
<div class="section" id="moisture">
<h2>Moisture<a class="headerlink" href="#moisture" title="Permalink to this headline">¶</a></h2>
<p>This section discusses special considerations for designing products that will come into contact with moisture.</p>
<div class="section" id="id2">
<h3>Introduction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The performance of a capacitive touch panel can be affected by moisture spray and build-up, as well as liquid spills. In addition, self capacitance and mutual capacitance exhibit different phenomena depending on the nature of the moisture. For example, small water droplets on a self capacitance electrode may have little effect, but a water droplet on a mutual capacitance electrode may have the effect of improving the mutual coupling and creating a change in the measurement counts that goes the opposite direction of a touch. Interestingly still, a water droplet or spill on a self or a mutual capacitance electrode could cause a change in measurement counts in the direction of (rather than against) a touch, if the droplet or spill is also in contact with a nearby ground plane, power plane, or grounded electrode that is not being measured. This section will introduce the physics behind the effects of moisture, as well as some basic best practices to add a level of moisture resistance and
detection to an application.</p>
</div>
<div class="section" id="id3">
<h3>Expectations<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>With careful attention to detail, it is possible to create designs that can reject small amounts of moisture. Through the use of guard channels, it is also possible to create designs that can detect spills and lock out the rest of the interface when a spill is detected.</p>
</div>
<div class="section" id="moisture-physics">
<h3>Moisture Physics<a class="headerlink" href="#moisture-physics" title="Permalink to this headline">¶</a></h3>
<p>Moisture build-ups and liquid spills that occur on panels in the real world affect capacitive sensing electrodes because the liquid on the panel exhibits electrical conductivity. Water is a polarized molecule, and in addition to its polarization, it is rarely pure and typically contains ions in solution. The amount of ions dissolved directly effects the conductivity of the moisture. Distilled water will appear to have much less of an effect than salt water or sweat, for example.</p>
<p>This conductive property means that moisture can appear to have a similar effect as placing a conductor (such as a piece of metal) on a panel. It&#8217;s easy to understand how that will cause problems! Making things worse is the fact that moisture is unpredictable in multiple aspects:</p>
<ol class="arabic simple">
<li>Its actual conductivity is extremely variable</li>
<li>The shape and size of droplets and spills are unknown and constantly changing</li>
<li>Changes tend to be fast- making them look more like a touch and less like an environmental change</li>
</ol>
</div>
<div class="section" id="moisture-problems">
<h3>Moisture Problems<a class="headerlink" href="#moisture-problems" title="Permalink to this headline">¶</a></h3>
<p>At best, build-up of moisture occurs slowly over time and is tracked via environmental filtering. At worst, it happens unpredictably and quickly and triggers a false detection.</p>
</div>
<div class="section" id="moisture-mitigation-techniques">
<h3>Moisture Mitigation Techniques<a class="headerlink" href="#moisture-mitigation-techniques" title="Permalink to this headline">¶</a></h3>
<p>Because of the unpredictable nature of moisture, it is necessary to divide mitigation techniques into two types of applications: <strong>moisture tolerance</strong> and <strong>spill rejection</strong>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="29%" />
<col width="14%" />
<col width="19%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Application Type</th>
<th class="head">Full Touch Detection</th>
<th class="head">Spill Detection</th>
<th class="head">Guard Channel Required</th>
<th class="head">Typical Mechanical Mounting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Moisture Tolerance</td>
<td>Yes, typically</td>
<td>No</td>
<td>No</td>
<td>Vertical</td>
</tr>
<tr class="row-odd"><td>Spill Detection</td>
<td>No, sensors are masked during a spill</td>
<td>Yes</td>
<td>Typically required</td>
<td>Horizontal</td>
</tr>
</tbody>
</table>
<div class="section" id="moisture-tolerance-applications">
<h4>Moisture Tolerance Applications<a class="headerlink" href="#moisture-tolerance-applications" title="Permalink to this headline">¶</a></h4>
<p>Moisture tolerant applications include those which are able to operate with touch detection in the presence of steam, mist, and spray. Common applications include exterior/interior security panels, E-locks, thermostats, and car access keypads. Whether or not moisture tolerance is feasible for an application depends on the mechanical design and environment. Typically, the following must be true:</p>
<ol class="arabic simple">
<li>The touch sensing panel is installed perpendicular to the earth (vertically or at some angle) such that any moisture that accumulates on the panel will drip away on its own due to gravity</li>
<li>There is no opportunity for moisture/fluids to &#8220;pool&#8221; or &#8220;flood&#8221; the sensing panel</li>
</ol>
<div class="section" id="design-tips-for-moisture-tolerance">
<h5>Design Tips for Moisture Tolerance<a class="headerlink" href="#design-tips-for-moisture-tolerance" title="Permalink to this headline">¶</a></h5>
<p>When designing a moisture tolerant application:</p>
<ol class="arabic simple">
<li>Provide as much spacing as possible between buttons</li>
<li>Provide significant spacing between buttons and nearby ground planes</li>
<li>Route all electrode connection traces on the PCB layer furthest from the surface</li>
<li>Set sensor <a class="reference external" href="ch_glossary.html#idle-state">idle states</a> to High-Z (floating) so that nearby sensors don&#8217;t provide coupling points that can cause false detections</li>
<li>If possible, use a non-conductive enclosure for the product</li>
</ol>
</div>
</div>
<div class="section" id="spill-rejection-applications">
<h4>Spill Rejection Applications<a class="headerlink" href="#spill-rejection-applications" title="Permalink to this headline">¶</a></h4>
<p>Spill rejection applications include those which are able to detect when a fluid spill has occurred on the sensing panel. Common applications are white goods such as a cooking surface control panel. The goal of spill rejection is not to enable full touch detection (which is extremely difficult when moisture or fluids cover multiple keys and/or ground), but simply to detect the presence of a spill and lock out the keypad until the spill is cleared by a user. This is most commonly achieved with the use of a guard channel, whose purpose is to detect large objects as well as spills.</p>
<div class="section" id="design-tips-for-spill-detection">
<h5>Design Tips for Spill Detection<a class="headerlink" href="#design-tips-for-spill-detection" title="Permalink to this headline">¶</a></h5>
<p>When designing a spill detection application:</p>
<ol class="arabic simple">
<li>Implement a guard channel to detect when a large unknown object or some kind of spill comes into contact with the sensing panel</li>
<li>In software, utilize the guard channel to mask reporting of touches on other keys when a spill is detected.</li>
</ol>
<p>The <a class="reference external" href="ch_evm.html#captivate-phone-demonstration">CAPTIVATE-PHONE</a> demonstration panel has a guard channel that is used for proximity sensing, palm rejection, and basic moisture rejection.</p>
</div>
</div>
</div>
</div>
<div class="section" id="noise-immunity">
<h2>Noise Immunity<a class="headerlink" href="#noise-immunity" title="Permalink to this headline">¶</a></h2>
<p>This section discusses how to design for electromagnetic compatibility.</p>
<div class="section" id="id4">
<h3>Introduction<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Capacitive touch sensing involves the measurement of very small changes in capacitance of a sensing electrode. These changes are often on the order of a picofarad or less. Because the quantity being measured is so small, capacitive touch circuits that are going to be used in noisy environments must be designed with noise immunity in mind from the start. Often, potential noise sources may not even be known at the time of design. This chapter is dedicated to providing the necessary guidance to enable immunity to various types of noise. It introduces the most common noise threats to a capacitive touch system. For each threat, it discusses how to reduce the susceptibility of a capacitive touch circuit to that threat when using MSP CapTIvate™ MCUs.</p>
<div class="section" id="how-to-use-this-section">
<h4>How to Use This Section<a class="headerlink" href="#how-to-use-this-section" title="Permalink to this headline">¶</a></h4>
<p>If you are designing a system that will exist in a high noise environment, it is best to read and understand this guide before going through the process of schematic capture and layout design. It is strongly recommended that the <a class="reference external" href="ch_basics.html#Capcitive-Sensing-Basics">Capacitive Sensing Basics</a> chapter be read before reading this chapter.</p>
<p>The <a class="reference external" href="ch_design_guide.html#noise-immunity">introduction</a> section of the noise immunity guide establishes a knowledge base that will be used as a backdrop for the rest of the discussion. After the <a class="reference external" href="ch_design_guide.html#noise-immunity">introduction</a>, the following section will discuss several different <a class="reference external" href="ch_design_guide.html#types-of-noise">noise problems</a> (RF susceptibility, for example). Each problem will be introduced so that the phenomenon is understood. Finally, the last section will discuss the <a class="reference external" href="ch_design_guide.html#noise-mitigation-steps">noise mitigation steps</a> to apply to your design to provide robustness to all of the noise types discussed. The noise mitigation steps will be presented in the context of the <a class="reference external" href="ch_design_guide.html#the-three-sided-approach">Three Sided Approach</a>. The <a class="reference external" href="ch_design_guide.html#noise-mitigation-steps">noise mitigation steps</a> section is the most important section, as it provides a check list of considerations to apply when designing for
noise immunity. If you don&#8217;t read the entire noise immunity guide, be sure to read the <a class="reference external" href="ch_design_guide.html#noise-mitigation-steps">noise mitigation steps</a>.</p>
</div>
<div class="section" id="additional-resources">
<h4>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h4>
<p>In addition to the design documentation here, there are several TI Designs and literature available that demonstrate how to achieve noise immunity:</p>
<ul class="simple">
<li>CapTIvate EMC White Paper: <a class="reference external" href="http://www.ti.com/lit/wp/slay045/slay045.pdf">Enabling noise-tolerant capacitive-touch HMIs with MSP CapTIvate technology</a></li>
<li>CapTIvate EMC Reference Design: <a class="reference external" href="http://www.ti.com/tool/tidm-captouchemcref">Noise Tolerant Capacitive Touch HMI Reference Design TIDM-CAPTOUCHEMCREF</a></li>
<li>CapTIvate Thermostat Reference Design with Noise Immunity: <a class="reference external" href="http://www.ti.com/tool/tidm-captivate-thermostat-ui">Capacitive Touch Thermostat UI with MSP MCUs Featuring CapTIvate Technology TIDM-CAPTIVATE-THERMOSTAT-UI</a></li>
</ul>
</div>
<div class="section" id="aggressor-victim-philosophy">
<h4>Aggressor-Victim Philosophy<a class="headerlink" href="#aggressor-victim-philosophy" title="Permalink to this headline">¶</a></h4>
<p>An aggressor-victim approach is taken to understand noise in a system. The diagram below illustrates this concept.</p>
<div class="figure" id="id79">
<img alt="Aggressor-Victim Diagram" src="../_images/design_aggressor_victim_diagram.png" />
<p class="caption"><span class="caption-number">Fig. 65 </span><span class="caption-text">Aggressor-Victim Diagram</span></p>
</div>
<p>The aggressor is the noise source, which generates interference that affects the victim through the coupling medium. Generally speaking, for noise to couple from the aggressor to affect the victim, the following must be true:</p>
<ul class="simple">
<li>The noise must be at a frequency at which the victim is vulnerable</li>
<li>The noise must have enough amplitude to affect the victim</li>
<li>The noise must be present at a time when the victim is vulnerable to the noise</li>
</ul>
<p><strong>Aggressor</strong></p>
<p>The aggressor varies with every application. Common aggressors are poorly designed power supplies with high common-mode and differential-mode emissions, long cables and/or traces that act as antennas to radio frequency (RF) signals, and high-current switched inductive loads that share their power source with the victim at some level. In some cases, the viewpoint is such that the capacitive touch circuit is the aggressor.</p>
<p><strong>Coupling Medium</strong></p>
<p>The medium through which the noise travels from the aggressor to the victim is often misunderstood. Common mediums include the VCC rail, the VSS rail, the capacitive coupling between traces (in the case of crosstalk), and even users of the capacitive sensing interface themselves.</p>
<p><strong>Victim</strong></p>
<p>During most of the discussion in this chapter, the capacitive touch circuit is the victim. However, there are times where the capacitive touch circuit becomes the aggressor, at which time a neighboring subsystem may become the victim.</p>
</div>
</div>
<div class="section" id="the-three-sided-approach">
<h3>The Three Sided Approach<a class="headerlink" href="#the-three-sided-approach" title="Permalink to this headline">¶</a></h3>
<p>Based on this understanding, it becomes clear that to reduce the effects of the aggressor on the victim, it is necessary to fulfil one or more of the following objectives:</p>
<ul class="simple">
<li>Change the characteristics of the noise emitted by the aggressor to either change its frequency or reduce its amplitude to a level that does not affect the victim</li>
<li>Reduce the ability of the noise to couple from the aggressor to the victim by modifying the coupling medium</li>
<li>Reduce the susceptibility of the victim to the noise emitted by the aggressor</li>
</ul>
<p>In some cases, it is possible to reduce the noise emitted by the aggressor (per the first bullet above). This is always the best course of action. Reducing the noise simplifies PCB layout and software considerations, and reduces the potential for other issues in the system. This is typically accomplished by designing robust power supplies and IO interfaces that do not generate their own noise nor pass on noise from the outside world. However, many times this is not possible because the aggressor may be outside the control of the system being designed. In that case, a solution must be obtained by <strong>reducing the coupling medium</strong> and <strong>reducing the victim&#8217;s susceptibility</strong>.</p>
<p>Along these lines, to achieve a high level of noise immunity in a capacitive touch design it is necessary to apply the relevant CapTIvate™ peripheral features, hardware design principles, and signal processing tools. The basic tools available are listed below.</p>
<ol class="arabic simple">
<li><strong>CapTIvate™ Peripheral EMC Features</strong><ul>
<li>Low impedance, integrator-based charge transfer measurement method</li>
<li>Offset subtraction signal chain block, allowing for dense ground shielding without compromising sensitivity</li>
<li>Frequency hopping and spread-spectrum oscillator to reduce susceptibility to periodic common mode noise sources</li>
<li>Synchronization input pin to align conversions with AC mains zero-crossing events</li>
</ul>
</li>
<li><strong>Hardware Design Principles</strong><ul>
<li>Grounding techniques</li>
<li>Filtering techniques</li>
<li>Protection passives</li>
</ul>
</li>
<li><strong>Signal Processing Tools</strong><ul>
<li>Oversampling (averaging filter)</li>
<li>Multi-frequency processing (MFP) algorithm</li>
<li>Dynamic threshold adjustment (DTA) algorithm</li>
<li>IIR noise filtering</li>
<li>De-bounce</li>
</ul>
</li>
</ol>
<p>The general theme of this chapter is how these three main toolboxes (the <strong>CapTIvate™ peripheral</strong>, <strong>hardware design principles</strong>, and <strong>signal processing</strong>) may be applied together to solve several noise problems at the same time.</p>
<div class="section" id="introduction-to-electromagnetic-compatibility-emc-standards">
<h4>Introduction to Electromagnetic Compatibility (EMC) Standards<a class="headerlink" href="#introduction-to-electromagnetic-compatibility-emc-standards" title="Permalink to this headline">¶</a></h4>
<p>International standards exist to allow for consistent, repeatable electromagnetic compatibility testing to be applied to different products. The primary international standard concerning system level robustness in the area of EMC is the IEC 61000-4 family. The tests most relevant to capacitive touch circuits are introduced below, and will be addressed in detail later in this chapter.</p>
<ol class="arabic simple">
<li><a class="reference external" href="ch_design_guide.html#electostatic-discharge-esd">IEC 61000-4-2 Electrostatic Discharge (ESD)</a> describes testing for electrostatic discharge immunity.</li>
<li><a class="reference external" href="ch_design_guide.html#rf-susceptibility-conducted-and-radiated">IEC 61000-4-3 Radiated RF Noise</a> describes testing for immunity to radiated RF noise between 80 MHz and 1 GHz.</li>
<li><a class="reference external" href="ch_design_guide.html#electrical-fast-transient-eft">IEC 61000-4-4 Electrical Fast Transient/Burst (EFT/B)</a> describes testing for immunity to high voltage fast transients.</li>
<li><strong>IEC 61000-4-5 Surge</strong> Describes immunity to power surge energy levels. This is not discussed here as it is considered a system-level problem that is the responsibility of the power supply.</li>
<li><a class="reference external" href="ch_design_guide.html#rf-susceptibility-conducted-and-radiated">IEC 61000-4-6 Conducted RF Noise</a> describes testing for immunity to conducted RF noise between 150kHz and 80 MHz.</li>
<li><a class="reference external" href="ch_design_guide.html#rf-susceptibility-conducted-and-radiated">IEC 61000-4-16 LF Conducted Noise</a> describes testing for immunity to conducted disturbances in the frequency range of 0 Hz to 150 kHz.</li>
</ol>
</div>
<div class="section" id="signal-to-noise-ratio">
<h4>Signal-to-Noise Ratio<a class="headerlink" href="#signal-to-noise-ratio" title="Permalink to this headline">¶</a></h4>
<p>The signal is the change in capacitance that results in a meaningful change in counts. Noise, on the other hand, is any disturbance that does not change the capacitance but does change the counts. Most often these disturbances are the result of power supply switching noise, electrostatic discharges (ESD), electrical fast transients (EFT), radiated RF noise, or some other type of electrical noise that couples into the system.</p>
<p>SNR is a system-level specification and needs to be tested at the system level. In achieving an acceptable level of SNR, the competing requirements for noise and signal must be addressed. The most common example of competing requirements is seen with ground shields. Ground shields help reduce susceptibility to radiated and conducted interference, and the closer these structures are to the circuit being protected, the more effective they are. However, moving these structures closer to the capacitive touch circuit has an unwanted effect of increasing the parasitic capacitance and consequently lowering the sensitivity.</p>
<p>In addition to managing the competing goals of sensitivity and noise immunity, these goals need to be managed within the overall requirements of the end product. This can mean trying to achieve a solution in a limited space, under a large aesthetic housing, or in the presence of other electrical activity (noise).</p>
</div>
</div>
<div class="section" id="types-of-noise">
<h3>Types of Noise<a class="headerlink" href="#types-of-noise" title="Permalink to this headline">¶</a></h3>
<p>This section introduces the major types of noise that a capacitive sensing system may encounter. For each topic, the problem, MCU solution, and required design actions are discussed.</p>
<div class="section" id="differential-mode-supply-rail-noise">
<h4>Differential Mode Supply Rail Noise<a class="headerlink" href="#differential-mode-supply-rail-noise" title="Permalink to this headline">¶</a></h4>
<p>Differential-mode supply rail noise is any noise seen at the DVCC supply rail of the capacitive touch MCU with respect to the DVSS (circuit common) supply rail. Some touch solutions on the market require a dedicated LDO just for the capacitive touch circuit to reduce these issues.</p>
<div class="section" id="problem">
<h5>Problem<a class="headerlink" href="#problem" title="Permalink to this headline">¶</a></h5>
<p>Some of the problems associated with a direct reference to DVCC include:</p>
<ol class="arabic simple">
<li>Changes in sensitivity as DVCC drifts down as a battery supply discharges</li>
<li>Vulnerability to false detects from ripple voltage on the DVCC supply rail</li>
<li>Increased vulnerability to EFT spikes on the DVCC supply rail</li>
</ol>
</div>
<div class="section" id="captivate-mcu-solution">
<h5>CapTIvate™ MCU Solution<a class="headerlink" href="#captivate-mcu-solution" title="Permalink to this headline">¶</a></h5>
<p>To address these issues, the CapTIvate™ peripheral has low drop-out regulator that is dedicated to the capacitive sensing analog circuitry. This regulator provides decoupling from the supply rail (DVCC) as well as digital noise on-chip. Issue 1 above is resolved immediately, as the capacitive touch analog circuitry will always run at a constant, internally regulated voltage that does not drift with DVCC. The regulator is functional across the DVCC supply voltage range of the MCU (see the device datasheet for details). Issues 2 and 3 above are dramatically reduced as a result of the power supply rejection ratio of the dedicated regulator. While a dedicated regulator is not required, it does provide a compounded PSRR in very noisy systems and is still recommended.</p>
</div>
<div class="section" id="design-actions-required">
<h5>Design Actions Required<a class="headerlink" href="#design-actions-required" title="Permalink to this headline">¶</a></h5>
<p>In general, no specific action is required- the on-chip regulator provides the benefits described above.</p>
<ol class="arabic simple">
<li><strong>CapTIvate™ Peripheral EMC Features</strong><ul>
<li>Dedicated CapTIvate™ LDO provides a constant voltage across the DVCC input range, and provides a level of PSRR against ripple voltages</li>
</ul>
</li>
<li><strong>Hardware Design Principles</strong><ul>
<li>Follow all recommendations for DVCC decoupling capacitance (per the device-specific datasheet).</li>
<li>Follow all recommendations for the dedicated voltage regulator (VREG) tank capacitor (per the device specific datasheet).</li>
<li>Place capacitors as close to the IC as possible.</li>
</ul>
</li>
<li><strong>Signal Processing Tools</strong><ul>
<li><a class="reference external" href="ch_glossary.html#debounce">De-bounce</a> may be applied as necessary if noise spikes are of significant amplitude to be seen in the measurement.</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="electrostatic-discharge-esd">
<h4>Electrostatic Discharge (ESD)<a class="headerlink" href="#electrostatic-discharge-esd" title="Permalink to this headline">¶</a></h4>
<p>Electrostatic discharge, if not properly managed, can disrupt a sample or even damage the MCU permanently. Fortunately, many tools exist to prevent this.</p>
<div class="section" id="id5">
<h5>Problem<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>An electrostatic discharge involves a sudden flow of current between two charged objects. The flow of current may be caused by the breakdown of a dielectric material (such as plastic or even air), or direct contact. The voltage differential in a discharge may be on the order of several kilovolts (kV) or more. An electrostatic discharge applied to a device pin can permanently damage the device. Since capacitive touch panels by definition are interacted with by users or other objects that may be electrically charged, ESD deserves consideration during the design process.</p>
</div>
<div class="section" id="id6">
<h5>CapTIvate™ MCU Solution<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p>The primary line of defense against ESD is always the touch panel overlay material. The overlay provides electrical isolation between the conductive electrode and any user or outside object that might interact with it. The ability of the overlay material to defend against ESD damage is dependent upon two main factors- the thickness of the material and its breakdown voltage, which is usually specified in terms of breakdown per unit of thickness. It is important to note that even if a discharge breaks down the dielectric material, the stress observed at the electrode (and possibly the device IO) will be less than the original stress on the overlay itself (since the breakdown accounts for some of the energy). Different materials will have different breakdown specifications. Generally speaking, plastics such as acrylic or polycarbonate have a higher breakdown voltage than materials such as glass. However, glass has a higher dielectric constant, which allows for better sensitivity through
thicker overlays, allowing for both materials to be used easily.</p>
<p>Care should be taken to account for all places in a system that a discharge could slip through (say around the bezel of a product or through a ventilation gap). This is generally of more concern with products that have plastic enclosures than with those that have metallic enclosures that can be tied to an ESD ground or safety ground.</p>
<p>If it is not possible to obtain the needed protection mechanically, the next best alternative is to employ the use of series resistors on electrode pins, followed by low-capacitance TVS diode clamps if needed.</p>
<div class="figure" id="id80">
<img alt="ESD Protection Network for Off-System Connections" src="../_images/design_esd_protection.png" />
<p class="caption"><span class="caption-number">Fig. 66 </span><span class="caption-text">ESD Protection Network for Off-System Connections</span></p>
</div>
<p>The primary clamp (the external TVS) clamps the electrode voltage to a lower, manageable level. This clamping action reduces the current into the sensitive internal circuit. A series resistance of a few hundred ohms to a few thousand ohms between the TVS and the MCU IO further reduces this current, and is required for the TVS to work properly. The remaining voltage present on the IO is clamped with the on-chip ESD protection clamps.</p>
<p>The TVS diode should be placed close to the electrode where and electrostatic discharge is likely to enter the system, and must have a low impedance path to the circuit return (ground) net.</p>
</div>
<div class="section" id="id7">
<h5>Design Actions Required<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li><strong>CapTIvate™ Peripheral EMC Features</strong><ul>
<li>Internal protection ESD clamps on the IO provide some chip-level protection during device handling and product assembly, but this should not be solely relied on for system level ESD protection.</li>
</ul>
</li>
<li><strong>Hardware Design Principles</strong><ul>
<li>Populate a 470-1k ohm resistor in series with the electrode to provide ESD protection, with a protection clamp such as a TVS diode placed between the electrode and ground (return) on the electrode side of the resistor.</li>
<li>Follow recommended <a class="reference external" href="ch_design_guide.html#noise-mitigation-steps">hardware best practices</a> for noise immunity</li>
</ul>
</li>
<li><strong>Signal Processing Tools</strong><ul>
<li><a class="reference external" href="ch_glossary.html#debounce">De-bounce</a> of at least one sample is recommended to reduce the possibility of a false detection due to a discharge on an IO during a conversion. ESD transients are fast, and in theory do not affect multiple samples in a periodic way (like RF interference, for example).</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="electrical-fast-transient-eft">
<h4>Electrical Fast Transient (EFT)<a class="headerlink" href="#electrical-fast-transient-eft" title="Permalink to this headline">¶</a></h4>
<p>Electrical fast transients are common in industrial environments as well as within commercial products that contain switching inductive loads. These transients are similar in nature to ESD, but exhibit a lower magnitude and longer event length. When high-current inductive loads are switched on and off, high voltage transients may appear on power supply lines. Transients may also appear on signal lines if a system is connected to another system that is generating noise. The transients are a result of the inductance in the load that attempts to maintain the flow of current, and in so doing generates large voltages.</p>
<p>The IEC test simulates these threats by injecting bursts repetitively into the supply or signal lines of a system, in differential or common mode (though common mode is the most typical).</p>
<div class="section" id="id8">
<h5>Expectations<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<p>High voltage transients are one of the issues that must be considered ahead of time when designing the system. They can wreak havoc on simple analog circuits like the MCU reset circuit. However, with proper design techniques it is possible to realize designs with immunity to 4kV per the IEC 61000-4-4 test specification.</p>
</div>
<div class="section" id="id9">
<h5>Problem<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<p>Fast transients can create effects similar to that of conducted noise, but generally only for brief periods of time as the duration of a transient is often quite short (on the order of 50 nanoseconds). This short burst time often means that not every capacitive touch sample will be affected by a burst. The figure below is data captured from a self capacitance button exposed to 1.5kV EFT bursts that were 50ns each. The 50ns transients were repeated at a 5 kHz burst rate for 15ms. That pattern was then repeated every 300ms, per the IEC test specification. The different effects observed on the electrode can be attributed to the amount of time a sample may have overlapped with a 15ms burst window. There is about a 5% chance of a sample overlapping with a burst, due to the 300ms test period. It is important to note, however, that real world threats will likely not follow this pattern! The IEC test should be used as a tool to understand the implications of EFT on a system- but real world
testing in-application is just as if not more valuable.</p>
<div class="figure" id="id81">
<img alt="Self Capacitance Button 1.5kV EFT Test" src="../_images/design_SelfCap_EFTSpike.png" />
<p class="caption"><span class="caption-number">Fig. 67 </span><span class="caption-text">Self Capacitance Button 1.5kV EFT Test</span></p>
</div>
</div>
<div class="section" id="id10">
<h5>CapTIvate™ MCU Solution<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<p>The primary line of defense against EFT must be hardware design. The best place to stop transients is at the power supply before they have a chance to effect different components of a product. Chances are good that the capacitive sensing MCU will not be the only component that is vulnerable to fast transients. Supplementing a good power supply, software should be EMC hardened. This includes de-bouncing the device reset pin, as well as implementing a watchdog timer. If EFT is a concern in a safety application, memory integrity self-tests should also be applied periodically for robustness.</p>
<p>Heavy de-bounce of the capacitive touch sensor is also extremely valuable- almost more so than IIR filtering in an EFT environment. Take the figure below as an example. The EFT burst only affected a single sample- something a basic de-bounce can easily handle. However, the magnitude of the pulse was significant enough to pull down the IIR filter for more than one sample, overwhelming a de-bounce level of 1 and requiring a de-bounce level of 2+ or a weaker filter coefficient.</p>
<p>In addition to <a class="reference external" href="ch_glossary.html#debounce">de-bounce</a>, applying <a class="reference external" href="ch_library.html#create-a-custom-emc-configuration">oversampling</a> improves EFT immunity more than IIR filtering, because of the finite impulse response nature of the averaging filter.</p>
<div class="figure" id="id82">
<img alt="Self Capacitance Button 1.5kV EFT Test - Filter Ineffectiveness" src="../_images/design_SelfCap_EFTFilterError.png" />
<p class="caption"><span class="caption-number">Fig. 68 </span><span class="caption-text">Self Capacitance Button 1.5kV EFT Test - Filter Ineffectiveness</span></p>
</div>
</div>
<div class="section" id="id11">
<h5>Design Actions Required<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li><strong>CapTIvate™ Peripheral EMC Features</strong><ul>
<li>Integrator-based charge transfer sensing technology</li>
</ul>
</li>
<li><strong>Hardware Design Principles</strong><ul>
<li>If possible, design a robust power supply for the system that blocks high frequency transients</li>
<li>Follow the same layout techniques as presented in the RF immunity section</li>
</ul>
</li>
<li><strong>Signal Processing Tools</strong><ul>
<li><a class="reference external" href="ch_glossary.html#debounce">De-bounce</a></li>
<li>Re-purpose the reset pin as a non-maskable interrupt (NMI) to de-bounce potential IC reset conditions.</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="rf-susceptibility-conducted-and-radiated">
<h4>RF Susceptibility (Conducted and Radiated)<a class="headerlink" href="#rf-susceptibility-conducted-and-radiated" title="Permalink to this headline">¶</a></h4>
<p>Capacitive touch circuits are inherently vulnerable to RF interference, since it can lead to injected noise currents into transmit (Tx) and receive (Rx) sensing IOs. By applying a combination of peripheral features, hardware techniques, and signal processing, it is possible to realize capacitive touch designs that are robust in the presence of RF interference.</p>
<p>RF interference will be broken down into two categories (conducted and radiated) based upon the frequency of the interference. The distinction between the two is important, as it defines the nature of the coupling medium between the aggressor and the victim. The breakdown is as follows:</p>
<ul class="simple">
<li>Conducted RF Interference<ul>
<li>10&#8217;s of kHz to 10&#8217;s of MHz</li>
<li>Long wavelengths</li>
<li>PCB traces are not efficient antennas</li>
<li>Noise is generally assumed to be coupled into the system via the power supply or through IO cables</li>
<li>Cables are of sufficient length to be efficient antennas</li>
<li>Generally of the most concern for capacitive touch circuits since the frequency range overlaps with the charge transfer frequency range</li>
</ul>
</li>
<li>Radiated RF Interference<ul>
<li>100&#8217;s of MHz to GHz</li>
<li>Short wavelengths</li>
<li>PCB traces can be efficient antennas</li>
<li>Generally of less concern for capacitive touch circuits</li>
</ul>
</li>
</ul>
<div class="section" id="id12">
<h5>Expectations<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<p>The following table breaks down what kind of immunity can be expected when testing a system to the IEC 61000-4-6 specification.</p>
<p><strong>IEC 61000-4-6 Class A Immunity Table (Fully Functional in Presence of Noise)</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="36%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sensing Method</th>
<th class="head">Sensor Type</th>
<th class="head">Direct Noise Coupling to DC Supply</th>
<th class="head">Noise Coupling to AC Supply</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Self</td>
<td>Buttons</td>
<td>Level 3 (10V RMS)</td>
<td>Level 3 (10V RMS)</td>
</tr>
<tr class="row-odd"><td>Self</td>
<td>Sliders/Wheels</td>
<td>Level 3 (10V RMS)</td>
<td>Level 3 (10V RMS)</td>
</tr>
<tr class="row-even"><td>Self</td>
<td>Proximity</td>
<td>Level 1 (1V RMS)</td>
<td>Level 1 (1V RMS)</td>
</tr>
<tr class="row-odd"><td>Mutual</td>
<td>Buttons</td>
<td>Level 2 (3V RMS)</td>
<td>Level 3 (10V RMS)</td>
</tr>
<tr class="row-even"><td>Mutual</td>
<td>Sliders/Wheels</td>
<td>Level 1 (1V RMS)</td>
<td>Level 2 (3V RMS)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="conducted-rf-noise-test-system">
<h5>Conducted RF Noise Test System<a class="headerlink" href="#conducted-rf-noise-test-system" title="Permalink to this headline">¶</a></h5>
<p>Conducted noise immunity is most reliably tested with the coupling/decoupling network method as specified in IEC 61000-4-6. A block diagram of the test configuration is shown below. This test setup couples noise directly onto the DC power supply rail to the equipment under test. This is the worst-case coupling location, as no power supply filtering is applied. Most products are not stressed to this level, as some filtering occurs in the AC to DC power supply itself.</p>
<div class="figure" id="id83">
<img alt="Conducted RF Test System" src="../_images/design_IEC6100046_TestBench_BlockDiagram.png" />
<p class="caption"><span class="caption-number">Fig. 69 </span><span class="caption-text">Conducted RF Test System</span></p>
</div>
<p>The frequency range tested is typically 150 kHz to 80 MHz, amplitude modulated at 80% depth on a 1 kHz carrier frequency to simulate real threats.</p>
</div>
<div class="section" id="id13">
<h5>Problem<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<p>The problem with RF interference is that it leads to injected currents that can couple into receive (Rx) electrodes. Typically, the currents are common mode in nature with respect to some reference (usually earth ground). The adverse effects observed on capacitive touch circuits are different for self capacitance than for mutual capacitance, so the two will be treated separately in the following section.</p>
<p>Self Capacitance</p>
<p>Self capacitance sensors experience several different effects in the presence of noise depending upon the following factors:</p>
<ol class="arabic simple">
<li>Frequency of the noise.</li>
</ol>
<ul class="simple">
<li>If the noise is centered directly on the conversion frequency or its lower harmonics (+/- 50 kHz), the measurement data will be corrupted positively and negatively, as shown below. This occurs whether or not a touch is present, although the effect is amplified when a touch is present (as shown).</li>
</ul>
<div class="figure" id="id84">
<img alt="Self Capacitance Button with No Noise and 3Vrms Conducted Noise at Conversion Frequency" src="../_images/design_SelfCap_WithAndWithoutNoise_NoAlg.png" />
<p class="caption"><span class="caption-number">Fig. 70 </span><span class="caption-text">Self Capacitance Button with No Noise and 3Vrms Conducted Noise at Conversion Frequency</span></p>
</div>
<ul class="simple">
<li>If the noise is nearby the conversion frequency, but not directly aligned with it or a low harmonic, the measurement will not be corrupted but it will experience an increase in sensitivity to touch with a time-varying noise component.</li>
</ul>
<div class="figure" id="id85">
<img alt="Self Capacitance Button with No Noise and 3Vrms Conducted Noise nearby the Conversion Frequency" src="../_images/design_SelfCap_WithAndWithoutNoise_NoAlg_Near.png" />
<p class="caption"><span class="caption-number">Fig. 71 </span><span class="caption-text">Self Capacitance Button with No Noise and 3Vrms Conducted Noise nearby the Conversion Frequency</span></p>
</div>
<ul class="simple">
<li>Note that the measurement is stable, and the noise only occurs in one direction. Self capacitance sensors will exhibit susceptibility in this way beginning just below their charge transfer frequency and going out past it with diminishing noise farther out in frequency.</li>
</ul>
<ol class="arabic simple" start="2">
<li>Amplitude of the noise. As the noise amplitude increases, the average delta due to a touch increases. This is a result of injected current into the Rx. This effect shows up as an increase in sensitivity to touch. For example, a button may trigger with a few mm of proximity rather than a full touch.</li>
</ol>
<p>Mutual Capacitance</p>
<p>Mutual capacitance sensors exhibit corruption of data if noise is present at the conversion frequency or its lower harmonics. The susceptibility band is typically 100 kHz around the conversion frequency. The effect can be seen in the diagram below.</p>
<div class="figure" id="id86">
<img alt="Mutual Capacitance Button with No Noise and 3Vrms Conducted Noise" src="../_images/design_MutualCap_WithAndWithoutNoise_NoAlg.png" />
<p class="caption"><span class="caption-number">Fig. 72 </span><span class="caption-text">Mutual Capacitance Button with No Noise and 3Vrms Conducted Noise</span></p>
</div>
<p>Notice how the data captured is completely unusable at this point. If the recommended layout practices are not followed, the result will be a widening of the susceptibility band in frequency beyond the typical value of ~100 kHz. This will limit the performance of the frequency hopping solution described next.</p>
</div>
<div class="section" id="id14">
<h5>CapTIvate™ MCU Solution<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<p>Several methods are employed to improve immunity to conducted and radiated RF interference:</p>
<ul class="simple">
<li>Liberal use of ground structures in the PCB layout to reduce the fringe free-space coupling of the electrode and its trace back to earth ground and the user.</li>
<li>Frequency hopping is applied to prevent noise in a given frequency band from corrupting the measurement by aggregating the data from 4 different conversion frequencies with the multi frequency processing (MFP) algorithm</li>
<li>In mutual mode, filter capacitors are placed between Rx lines and circuit common to narrow the susceptibility band in frequency, improving the benefit of frequency hopping</li>
<li>In self mode, spread spectrum clock modulation and the dynamic threshold adjustment (DTA) algorithm are applied to compensate for the increased sensitivity to touch</li>
<li>Oversampling, <a class="reference external" href="ch_glossary.html#count-filter">IIR filtering</a> and <a class="reference external" href="ch_glossary.html#debounce">de-bounce</a> may be used to add additional robustness</li>
</ul>
<p>Self Capacitance</p>
<p>To achieve self-capacitance immunity, it is imperative that dense grounding structures be applied to limit fringing E-field lines. This has the effect of stabilizing the electrode. Then the use of frequency hopping and spread-spectrum clocking improves the data to a level where it may be processed by an algorithm, as shown below. In the plot below, noise is being injected at F3. Notice how F3 looks the same as the plot shown above in the problem section- it has positive and negative noise. However, F0-F2 are clean when no touch is present, and only exhibit the additional sensitivity in the negative direction when the button is touched. Applying spread-spectrum clock modulation reduces the effect of the noise at F3 to the point where it looks similar to F0-F2.</p>
<div class="figure" id="id87">
<img alt="Self Capacitance Button with 3Vrms Conducted Noise, 4 Frequency Raw Data Without and With Modulation" src="../_images/design_SelfCap_3Vrms_Modulation.png" />
<p class="caption"><span class="caption-number">Fig. 73 </span><span class="caption-text">Self Capacitance Button with 3Vrms Conducted Noise, 4 Frequency Raw Data Without and With Modulation</span></p>
</div>
<p>Taking that data set and applying the multi-frequency processing algorithm results in a fairly clean signal that may be filtered via the addition of the IIR count filter, as shown below. Notice that the signal still has an increased delta due to the injected noise current.</p>
<div class="figure" id="id88">
<img alt="Self Capacitance Button with 3Vrms Conducted Noise, MFP Data Without and With IIR Filtering" src="../_images/design_SelfCap_3Vrms_Modulation_MFP_IIR.png" />
<p class="caption"><span class="caption-number">Fig. 74 </span><span class="caption-text">Self Capacitance Button with 3Vrms Conducted Noise, MFP Data Without and With IIR Filtering</span></p>
</div>
<p>Now that a clean signal has been obtained, the noise level that was measured in the original raw data is used to compute a threshold adjustment factor via the dynamic threshold adjustment algorithm (DTA). This provides compensation for the slight gain in sensitivity due to noise in the system. The noise level is also reported, should it be of interest to the application. Below is a comparison of a no-noise touch and a touch in the presence of 3Vrms conducted noise at the base conversion frequency.</p>
<div class="figure" id="id89">
<img alt="Self Capacitance Button with No Noise and 3Vrms Conducted Noise, with MFP, IIR, and DTA" src="../_images/design_SelfCap_3Vrms_Modulation_MFP_IIR_DTA.png" />
<p class="caption"><span class="caption-number">Fig. 75 </span><span class="caption-text">Self Capacitance Button with No Noise and 3Vrms Conducted Noise, with MFP, IIR, and DTA</span></p>
</div>
<p>The application of all these design principles results in a button that dynamically responds to changes in the environment, compensating for noise. These techniques also work quite well on slider and wheel sensors.</p>
<p>Mutual Capacitance</p>
<p>As shown below, the application of frequency hopping and filter capacitors in mutual mode produces usable measurements at the auxiliary frequencies (left plot). The multi-frequency processing (MFP) algorithm may then resolve the data set into a usable count value that is fed into the standard element and sensor processing algorithms.</p>
<div class="figure" id="id90">
<img alt="Mutual Capacitance Button with 3Vrms Conducted Noise, Raw Data and Processed Data" src="../_images/design_MutualCap_3Vrms_4Freq_WithAndWithoutAlg_NoiseAt1.png" />
<p class="caption"><span class="caption-number">Fig. 76 </span><span class="caption-text">Mutual Capacitance Button with 3Vrms Conducted Noise, Raw Data and Processed Data</span></p>
</div>
<p>If the solution is looked at across a frequency sweep, the benefit of the frequency hopping approach becomes evident. This data set corresponds to a button that was not touched during the test.</p>
<div class="figure" id="id91">
<img alt="Mutual Capacitance Button with 3Vrms Conducted Noise, No-Touch Noise Sweep" src="../_images/design_MutualCap_NoiseSweep_Untouched.png" />
<p class="caption"><span class="caption-number">Fig. 77 </span><span class="caption-text">Mutual Capacitance Button with 3Vrms Conducted Noise, No-Touch Noise Sweep</span></p>
</div>
<p>Note how the noise bands are very narrow, and are easily overcome by the frequency hopping algorithm. When touched, the susceptibility band increases and the amplitude of the noise increases. However, usable data is still obtained.</p>
<div class="figure" id="id92">
<img alt="Mutual Capacitance Button with 3Vrms Conducted Noise, Touched Noise Sweep" src="../_images/design_MutualCap_NoiseSweep_Touched.png" />
<p class="caption"><span class="caption-number">Fig. 78 </span><span class="caption-text">Mutual Capacitance Button with 3Vrms Conducted Noise, Touched Noise Sweep</span></p>
</div>
<p>In both the untouched and touched diagrams, it is easy to pick out the fundamental frequencies at the left, and their corresponding harmonics. It may become obvious from reviewing the above diagrams that noise may affect more than one frequency at a time. In the event that this occurs, the frequency hopping approach is still able to handle most situations. The diagram below shows noise affecting two frequencies at the same time.</p>
<div class="figure" id="id93">
<img alt="Mutual Capacitance Button 3Vrms Conducted Noise" src="../_images/design_MutualCap_3Vrms_4Freq_WithAndWithoutAlg_NoiseAt2.png" />
<p class="caption"><span class="caption-number">Fig. 79 </span><span class="caption-text">Mutual Capacitance Button 3Vrms Conducted Noise</span></p>
</div>
<p>In the event that the noise become too great for the algorithm to determine what is happening, it is possible to use the noise threshold and noise status bits of the elements to alert the application and lock out a safety critical function.</p>
</div>
<div class="section" id="id15">
<h5>Design Actions Required<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<p>Designing for immunity to RF interference does require hardware and software considerations. Be sure to review the final section of this guide, <a class="reference external" href="ch_design_guide.html#noise-mitigation-steps">Noise Mitigation Steps</a>, for implementation details.</p>
<ol class="arabic simple">
<li><strong>CapTIvate™ Peripheral EMC Features</strong><ul>
<li>Integrator-based charge transfer method</li>
<li>Offset subtraction signal chain block</li>
<li>Frequency hopping</li>
<li>Spread-spectrum clocking</li>
</ul>
</li>
<li><strong>Hardware Design Principles</strong><ul>
<li>Implement conducted noise immunity layout best practices, taking into account the thickness and dielectric of the overlay material</li>
<li>Eliminate or limit use of off-board connectors that carry capacitive sensing lines</li>
</ul>
</li>
<li><strong>Signal Processing Tools</strong><ul>
<li><a class="reference external" href="ch_library.html#multi-frequency-processign-mfp-algorithm">CapTIvate™ EMC Multi Frequency Processing (MFP)</a> algorithm</li>
<li><a class="reference external" href="ch_library.html#dynamic-threshold-adjustment-dta-algorithm">CapTIvate™ EMC Dynamic Threshold Adjustment (DTA)</a> algorithm</li>
<li><a class="reference external" href="ch_glossary.html#count-filter">IIR Count Filtering</a></li>
<li><a class="reference external" href="ch_glossary.html#debounce">De-bounce</a></li>
</ul>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="noise-mitigation-steps">
<h3>Noise Mitigation Steps<a class="headerlink" href="#noise-mitigation-steps" title="Permalink to this headline">¶</a></h3>
<p>One of the nice things about designing for EMC is that many of the techniques used to improve a design for one type of noise also tend to improve the design for other types of noise as well. This section steps through noise mitigation steps that should be applied to all designs that require noise immunity. It is best to think of this section as a design check list. All of the items discussed here should be applied when designing a product to have robust noise immunity.</p>
<ol class="arabic simple">
<li>Determine whether the design will be using self or mutual capacitance (or both).</li>
<li>Before beginning a PCB layout, review the <a class="reference external" href="ch_design_guide.html#noise-immunitiy-hardware-check-list">hardware checklist</a>.</li>
<li>When configuring a project in the CapTIvate™ Design Center, review the <a class="reference external" href="ch_design_guide.html#tuning-check-list">tuning checklist</a>.</li>
</ol>
<div class="section" id="noise-immunity-hardware-check-list">
<h4>Noise Immunity Hardware Check List<a class="headerlink" href="#noise-immunity-hardware-check-list" title="Permalink to this headline">¶</a></h4>
<p>Review this check list before starting a PCB layout.</p>
<ol class="arabic simple">
<li>Follow <a class="reference external" href="ch_design_guide.html#noise-immunity-electrode-design-best-practices">electrode design best practices</a> for noise immunity.</li>
<li>Utilize dense <a class="reference external" href="ch_design_guide.html#noise-immunity-sheilding-best-practices">return (ground) plane structures</a> to limit fringe E-field lines.</li>
<li>For mutual (projected) capacitance sensors, populate a 68pF ceramic capacitor between each Rx and circuit return (ground). This capacitor should be placed close to the MCU. It is also a good idea to allow a provision to populate a capacitor between each Tx and circuit return, should it be needed during qualification. The TI noise immunity reference designs do not require the Tx capacitor.</li>
<li>Avoid routing capacitive sensing lines (Rx&#8217;s or Tx&#8217;s) through board-to-board connectors or cables. Connectors can be significant noise receptors.</li>
<li>Optimize the overlay thickness as much as possible. The thicker the overlay material, the higher the chance of a touch on one key affecting a nearby key. With thinner overlays, electrodes will be more susceptible to ESD. The sweet spot is 1.5mm to 4mm for a typical PC/ABS/acrylic overlay.</li>
<li>Use good power supply design principles to limit noise at the entry point. If possible, implement a common mode choke coil with a high impedance to common-mode noise in the range of 100 kHz to 100 MHz.</li>
</ol>
<div class="section" id="noise-immunity-electrode-design-best-practices">
<h5>Noise Immunity Electrode Design Best Practices<a class="headerlink" href="#noise-immunity-electrode-design-best-practices" title="Permalink to this headline">¶</a></h5>
<p>When designing for noise immunity, there are several best practices to apply to electrode geometry. Self capacitance and mutual capacitance will be discussed separately.</p>
<p>Self Capacitance</p>
<p>In the case of self capacitance, 3Vrms immunity is usually attainable without significant overhaul to the electrode design principles discussed in the <a class="reference external" href="ch_design_guide.html#self-capacitive-button-shapes">button design section</a>.</p>
<p>The following principles should be applied:</p>
<ol class="arabic simple">
<li>Limit the size of the electrodes where possible. Do not oversize electrodes beyond what is needed to achieve the desired sensitivity with the overlay that will be used with the product.</li>
<li>Avoid air gaps in the overlay stackup</li>
<li>Keep traces from the MCU to the electrode as short as possible</li>
<li>If possible, do not place electrodes on the edges of the PCB, as this limits the effectiveness of <a class="reference external" href="ch_design_guide.html#noise-immunity-hardware-check-list">ground shielding</a></li>
<li>If the design has a thin overlay stackup (&lt;3mm), a special electrode design may be used which has a ground plane in the center of the button.</li>
</ol>
<p>Placing a ground plane in the center of a button has two effects: additional stability for the electrode, and a path for noise currents into the ground plane and not into the electrode during a touch</p>
<p>Below is a comparison of a standard button layout with the special button layout discussed in principle #5. The special button layout is really only suitable for designs with overlay stackups less than 3mm. Above 3mm, the sensitivity trade-off becomes too great.</p>
<div class="figure" id="id94">
<img alt="Self Buttons (Grid = 0.5mm)" src="../_images/design_noise_button_self.png" />
<p class="caption"><span class="caption-number">Fig. 80 </span><span class="caption-text">Self Buttons (Grid = 0.5mm)</span></p>
</div>
<p>Mutual Capacitance</p>
<p>Mutual capacitance requires a specific geometry to achieve immunity. The layout below depicts the recommended geometry. The goals are as follows:</p>
<ol class="arabic simple">
<li>Limit the size of the Rx</li>
<li>Overlay stackup air gaps are not permitted for mutual capacitance</li>
<li>Optionally, place a small ground fill in the center of the electrode to add a path for noise currents into the ground plane and not into the electrode during a touch</li>
<li>Route all Rx signals on the bottom layer if possible to limit their exposure to a touch</li>
<li>Keep the number of Tx lines per Rx as low as possible. This limits the vulnerability of the receiver to noise.</li>
</ol>
<div class="figure" id="id95">
<img alt="Mutual Button Geometry" src="../_images/design_electrode_mut_10mm.png" />
<p class="caption"><span class="caption-number">Fig. 81 </span><span class="caption-text">Mutual Button Geometry</span></p>
</div>
<p>The recommended mutual capacitance button geometry is as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Overall Geometry</td>
<td>10mm x 10mm</td>
</tr>
<tr class="row-odd"><td>Plane Keepout</td>
<td>0.5mm from overall geometry on top layer, flooded on bottom layer</td>
</tr>
<tr class="row-even"><td>Tx Thickness</td>
<td>1mm</td>
</tr>
<tr class="row-odd"><td>Rx Thickness</td>
<td>0.5mm</td>
</tr>
<tr class="row-even"><td>Tx to Rx Spacing</td>
<td>0.5mm</td>
</tr>
</tbody>
</table>
<p>This electrode geometry has been proven with overlays up to 3mm of thickness.</p>
</div>
<div class="section" id="noise-immunity-electrode-shielding-best-practices">
<h5>Noise Immunity Electrode Shielding Best Practices<a class="headerlink" href="#noise-immunity-electrode-shielding-best-practices" title="Permalink to this headline">¶</a></h5>
<p>Proper ground shielding of electrodes is required to achieve noise immunity. This applies to both self and mutual capacitance designs.</p>
<p>Self Capacitance Shielding</p>
<p>For self capacitance designs, utilize a solid ground or power plane on the top layer of the PCB, and a medium-density hatched power or ground plane on the bottom layer of the PCB. As an example, if the <a class="reference external" href="ch_evm.html#captivate-bswp">CAPTIVATE-BSWP</a> panel (which was designed for low power battery operation) was modified to attain noise immunity, the following changes would be made:</p>
<ol class="arabic simple">
<li>Removal of the proximity sensor</li>
<li>Addition of a solid ground/power plane on the top layer</li>
<li>Expansion of the hatched ground/power plane on the bottom layer to the size of the PCB</li>
</ol>
<p>Below are before and after images of the top and bottom layers, applying the principles described above:</p>
<div class="figure" id="id96">
<img alt="CAPTIVATE-BSWP Modified for Noise Immunity (Top Layer)" src="../_images/design_noise_bswp_mod_top.png" />
<p class="caption"><span class="caption-number">Fig. 82 </span><span class="caption-text">CAPTIVATE-BSWP Modified for Noise Immunity (Top Layer)</span></p>
</div>
<div class="figure" id="id97">
<img alt="CAPTIVATE-BSWP Modified for Noise Immunity (Bottom Layer)" src="../_images/design_noise_bswp_mod_bottom.png" />
<p class="caption"><span class="caption-number">Fig. 83 </span><span class="caption-text">CAPTIVATE-BSWP Modified for Noise Immunity (Bottom Layer)</span></p>
</div>
<p>The addition of these dense ground structures serves to limit fringing E-field lines as much as possible, stabilizing the electrodes. Normally the addition of this much parasitic capacitance is considered bad practice, but in the case of noise immunity the trade-off is extremely beneficial. In addition, the gain and offset subtraction capability of the CapTIvate™ technology makes it possible to maintain decent sensitivity even with the ground shield structures.</p>
<p>Mutual Capacitance Shielding</p>
<p>For mutual capacitance designs, utilize solid ground or power planes on the top and bottom layer of the PCB. Mutual receive electrodes (Rx&#8217;s) are extremely sensitive (on the order of &lt;1mV). As a result, they are very vulnerable to noise currents. It is necessary to keep the Rx tracks as short as possible and as well-shielded as possible.</p>
<p>The design below illustrates these concepts for a 4x2 8-button mutual capacitance matrix:</p>
<div class="figure" id="id98">
<img alt="TIDM-CAPTIVATE-THERMOSTAT-UI (Top and Bottom Layer)" src="../_images/design_noise_mutual_board.png" />
<p class="caption"><span class="caption-number">Fig. 84 </span><span class="caption-text">TIDM-CAPTIVATE-THERMOSTAT-UI (Top and Bottom Layer)</span></p>
</div>
</div>
</div>
<div class="section" id="tuning-check-list">
<h4>Tuning Check List<a class="headerlink" href="#tuning-check-list" title="Permalink to this headline">¶</a></h4>
<p>Review this check list when tuning a design that requires noise immunity.</p>
<ol class="arabic simple">
<li>If RF immunity is required, enable <a class="reference external" href="ch_designcenter.html#select-compile-time-options">noise immunity mode</a> in the CapTIvate™ Design Center. This will enable frequency hopping during measurement, and will increase the measurement time for each sensor by just over 4x.</li>
<li>Set strong <a class="reference external" href="ch_glossary.html#debounce">de-bounce settings</a>. A value of 2 or greater is recommended.</li>
<li>Set a strong <a class="reference external" href="ch_glossary.html#count-filter">count filter beta</a>. A value of 2-3 for buttons and 1-2 for sliders/wheels is recommended.</li>
<li>For self capacitance sensors, <strong>enable</strong> <a class="reference external" href="ch_glossary.html#modulation-enable">modulation</a>. In self mode, the modulation improves the performance of the DTA (dynamic threshold adjustment) algorithm by spreading the conversion clock frequency and reducing noise spikes directly at the conversion frequencies and lower harmonics.</li>
<li>For mutual (projected) capacitance sensors, <strong>disable</strong> <a class="reference external" href="ch_glossary.html#modulation-enable">modulation</a>. In mutual mode, the modulation interferes with frequency hopping, as it widens the susceptibility bands.</li>
<li>For mutual (projected) capacitance sensors, use a conversion frequency of 2 MHz to 4 MHz. If the <a class="reference external" href="ch_glossary.html#phase-lengths">phase lengths</a> are both set to 1, a <a class="reference external" href="ch_glossary.html#frequency-divider">frequency</a> divider of f/4 provides an effective conversion frequency of 2 MHz. Utilizing a faster conversion frequency increases the effectiveness of the frequency hopping mechanism by providing a wider spread between hop points.</li>
<li>Set an error threshold for each sensor. For mutual capacitance, a good rule-of-thumb is to take the conversion count + 2-3x the maximum expected touch strength. For example, if a button has conversion count setting of 400, and a maximum expected delta due to touch of 100, than setting an error threshold of 600-700 would be appropriate. This serves to &#8220;cap&#8221; every conversion result to a maximum value. If noise in the system attempts to cause a conversion to continue beyond the error threshold, then the conversion will be halted. This prevents rogue samples from having extremely long sample times and effecting the response time / filtering of the system. For self capacitance, a good value is the conversion count * 1.25. For example, a sensor with a conversion count of 800 would have an error threshold of 1000. This allows space for the runtime re-calibration algorithm to kick in (which happens if the LTA drifts outside +/- 1/8th of the conversion count, if enabled).</li>
<li>For mutual (projected) capacitance sensors, set the <a class="reference external" href="ch_glossary.html#bias-current">bias current</a> value to the highest setting.</li>
<li>Become familiar with the <a class="reference external" href="ch_library.html#emc">EMC module</a> configuration parameters, should you need to adjust them during development. Reference the software library how-to section on <a class="reference external" href="ch_library.html#create-a-custom-emc-configuration">creating a custom EMC configuration</a> to add oversampling if needed.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="http://wcalc.sourceforge.net/cgi-wcalc.html">http://wcalc.sourceforge.net/cgi-wcalc.html</a></li>
</ol>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ch_designcenter.html" class="btn btn-neutral float-right" title="Design Center GUI" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ch_technology.html" class="btn btn-neutral" title="Technology" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2018</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.70.00.03',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });

        $('body').on("mousewheel", function () {
            // Remove default behavior
            event.preventDefault();
            // Scroll without smoothing
            var wheelDelta = event.wheelDelta;
            var currentScrollPosition = window.pageYOffset;
            window.scrollTo(0, currentScrollPosition - wheelDelta);
        });
      });
  </script>
   

</body>
</html>