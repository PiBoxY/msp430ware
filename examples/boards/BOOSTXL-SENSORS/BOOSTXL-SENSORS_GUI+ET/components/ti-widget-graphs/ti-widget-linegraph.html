<!--
'ti-widget-linegraph' plots series of data in line form.
... to be completed ...

@group TI Instrument Widgets
@element ti-widget-linegraph
@homepage ../ti-guicomposer-helpindex/demo.html
-->
<!--
    Copyright (c) 2015, Texas Instruments Incorporated
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions
    are met:

    *   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.
    *   Neither the name of Texas Instruments Incorporated nor the names of
    its contributors may be used to endorse or promote products derived
    from this software without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
    AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
    THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
    OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
    WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
    OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
    EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-resizable/core-resizable.html">
<link rel="import" href="../ti-widget-common/ti-widget-base.html">
<link rel="import" href="../ti-widget-common/ti-widget-label.html">

<script language="javascript" type="text/javascript" src="assets/flot/jquery.js"></script>
<script language="javascript" type="text/javascript" src="assets/flot/jquery.flot.js"></script>
<!--
  <script language="javascript" type="text/javascript" src="assets/flot/jquery.flot.navigate.js"></script>
-->

<polymer-element name="ti-widget-linegraph" extends="ti-widget-base">
    <template>
        <style>
            :host {
                transition:width 0.01s, height 0.01s;
            }
            #title {
                color: #555;
                font-size: large;
                white-space: normal;
                text-align: center;
                padding-bottom: 1em;
            }
            #chart {
                height:90%;
                width:90%;
                bottom: 1em;
                left: 50%;
                margin-right: -50%;
                transform: translate(-50%, 0);
                background-color:{{backgroundColor}};
            }
            #xAxisLabel {
                width:100%;
                text-align:center;
                font-size:x-small;
                bottom: 0.25em;
                padding-bottom: 3px;
            }
        </style>

        <!-- -->
        <div style="height:100%; width:100%;" layout vertical justified>
            <label id="title">{{titleLabel}}</label>
            <div id="chart" onresize="{{this.onResize}}" ></div>
            <div id="xAxisLabel" style="{{_isHidden(hideXAxis)}}">{{xAxisLabel}}</div>
            <content></content>
        </div>
    </template>

    <script>
        // global variable here, common to all instances
        var _debug = false;

        // register to polymer
        Polymer( Polymer.mixin({
            _plotObj: undefined,
            _plotOptions: undefined,
            _dataArray0: undefined,
            _dataArray1: undefined,
            _dataArray2: undefined,
            _dataArray3: undefined,
            _redrawOnValuesChange: true,
            _redrawOnOptionsChange: true,
            _delayingPlot: false,
            _delayPlotWaitTime: 250,    //


            publish: {
                /**
                 * Provides an optional title for the graph.
                 *
                 * @attribute titleLabel
                 * @type string
                 */
                titleLabel: "",
                /**
                 * The number of data series to display.
                 *
                 * @attribute numChannels
                 * @type int
                 * @default 2
                 */
                numChannels: 1,

                /**
                 * The label string to be displayed under the X axis (e.g. "time (s)" )
                 *
                 * @attribute xAxisLabel
                 * @type string
                 * @default ''
                 */
                xAxisLabel: "",
                /**
                 * The label of data series 0.
                 *
                 * @attribute series_0_Label
                 * @type string
                 * @default undefined
                 */
                series_0_Label: undefined,
                /**
                 * The units of data series 0 to be displayed on the Y axis.
                 *
                 * @attribute series_0_Label
                 * @type string
                 * @default undefined
                 */
                series_0_Units: undefined,
                /**
                 * The color of data series 0.
                 *
                 * @attribute series_0_Color
                 * @type string
                 * @default undefined
                 */
                series_0_Color: '#00bbcc',
                /**
                 * The fixed minimum value of data series 0.
                 *
                 * @attribute series_0_Min
                 * @type number
                 * @default undefined
                 */
                series_0_Min: undefined,
                /**
                 * The fixed maximum value of data series 0.
                 *
                 * @attribute series_0_Max
                 * @type number
                 * @default undefined
                 */
                series_0_Max: undefined,
                /**
                 * The array represent data series 0. X+Y pair or Y-Only.
                 *
                 * @attribute series_0_Values
                 * @type string
                 * @default undefined
                 */
                series_0_Values: undefined,
                /**
                 * The label of data series 1.
                 *
                 * @attribute series_1_Label
                 * @type string
                 * @default undefined
                 */
                series_1_Label: undefined,
                /**
                 * The units of data series 1 to be displayed on the Y axis.
                 *
                 * @attribute series_1_Units
                 * @type string
                 * @default undefined
                 */
                series_1_Unitsl: undefined,
                /**
                 * The color of data series 1.
                 *
                 * @attribute series_1_Color
                 * @type string
                 * @default undefined
                 */
                series_1_Color: '#115566',
                /**
                 * The fixed minimum value of data series 1.
                 *
                 * @attribute series_1_Min
                 * @type number
                 * @default undefined
                 */
                series_1_Min: undefined,
                /**
                 * The fixed maximum value of data series 1.
                 *
                 * @attribute series_1_Max
                 * @type number
                 * @default undefined
                 */
                series_1_Max: undefined,
                /**
                 *  The array represent data series 1. X+Y pair or Y-Only.
                 *
                 * @attribute series_1_Values
                 * @type array
                 * @default undefined
                 */
                series_1_Values: undefined,
                /**
                 * The label of data series 2.
                 *
                 * @attribute series_2_Label
                 * @type string
                 * @default undefined
                 */
                series_2_Label: undefined,
                /**
                 * The units of data series 2 to be displayed on the Y axis.
                 *
                 * @attribute series_2_Units
                 * @type string
                 * @default undefined
                 */
                series_2_Units: undefined,
                /**
                 * The color of data series 2.
                 *
                 * @attribute series_2_Color
                 * @type string
                 * @default undefined
                 */
                series_2_Color: '#aaaaaa',
                /**
                 * The fixed minimum value of data series 2.
                 *
                 * @attribute series_2_Min
                 * @type number
                 * @default undefined
                 */
                series_2_Min: undefined,
                /**
                 * The fixed maximum value of data series 2.
                 *
                 * @attribute series_2_Max
                 * @type number
                 * @default undefined
                 */
                series_2_Max: undefined,
                /**
                 * The array represent data series 2. X+Y pair or Y-Only.
                 *
                 * @attribute series_2_Values
                 * @type string
                 * @default undefined
                 */
                series_2_Values: undefined,
                /**
                 * The label of data series 3.
                 *
                 * @attribute series_3_Label
                 * @type string
                 * @default undefined
                 */
                series_3_Label: undefined,
                /**
                 * The units of data series 3 to be displayed on the Y axis.
                 *
                 * @attribute series_3_Units
                 * @type string
                 * @default undefined
                 */
                series_3_Units: undefined,
                /**
                 * The color of data series 2.
                 *
                 * @attribute series_3_Color
                 * @type string
                 * @default undefined
                 */
                series_3_Color: '#0000aa',
                /**
                 * The fixed minimum value of data series 3.
                 *
                 * @attribute series_3_Min
                 * @type number
                 * @default undefined
                 */
                series_3_Min: undefined,
                /**
                 * The fixed maximum value of data series 3.
                 *
                 * @attribute series_3_Max
                 * @type number
                 * @default undefined
                 */
                series_3_Max: undefined,
                /**
                 * The array represent data series 3. X+Y pair or Y-Only.
                 *
                 * @attribute series_3_Values
                 * @type string
                 * @default undefined
                 */
                series_3_Values: undefined,

                /**
                 * The fixed-scale flag.
                 *
                 * @attribute fixedScale
                 * @type boolean
                 * @default false
                 */
                fixedScale: false,
                /**
                 * The hide x-axis flag.
                 *
                 * @attribute hideXAxis
                 * @type boolean
                 * @default false
                 */
                hideXAxis: false,
                /**
                 * hides the y-axis for all data series when true
                 *
                 * @attribute hideYAxis
                 * @type boolean
                 * @default false
                 */
                hideYAxis: false,
                /**
                 * hides the y-axis for data series 1 when true
                 * AND hideYAxis is false
                 *
                 * @attribute hideYAxis1
                 * @type boolean
                 * @default false
                 */
                hideYAxis1: false,
                /**
                 * hides the y-axis for data series 2 when true
                 * AND hideYAxis is false
                 *
                 * @attribute hideYAxis2
                 * @type boolean
                 * @default false
                 */
                hideYAxis2: false,
                /**
                 * hides the y-axis for data series 3 when true
                 * AND hideYAxis is false
                 *
                 * @attribute hideYAxis2
                 * @type boolean
                 * @default false
                 */
                hideYAxis3: false,
                /**
                 * The hide legend flag.
                 *
                 * @attribute hideLegend
                 * @type boolean
                 * @default false
                 */
                hideLegend: false,
                /**
                 * The hide border flag.
                 *
                 * @attribute hideBorder
                 * @type boolean
                 * @default false
                 */
                hideBorder: false,
                /**
                 * The visible flag.
                 *
                 * @attribute visible
                 * @type boolean
                 * @default true
                 */
                //visible: true,
                /**
                 * The disabled flag.
                 *
                 * @attribute disabled
                 * @type boolean
                 * @default false
                 */
                //disabled: false,
                /**
                 * The show points flag
                 *
                 * @attribute showPoints
                 * @type boolean
                 * @default false
                 */
                showPoints: false,
                /**
                 * The show bars flag - show as bar graph
                 *
                 * @attribute showBars
                 * @type boolean
                 * @default false
                 */
                showBars: false,
//        series_0_values_string: undefined,
                /**
                 * The fill flag - fill area between line and 0
                 *
                 * @attribute fill
                 * @type boolean
                 * @default false
                 */
                fill: false,
                /**
                 * The background color.
                 *
                 * @attribute backgroundColor
                 * @type string
                 * @default '#ffffff'
                 */
                backgroundColor: '#ffffff',
                /**
                 * The plot counter.
                 *
                 * @attribute plotCounter
                 * @type number
                 * @default 0
                 */
                plotCounter: 0


            },

            observe: {
                numChannels: 'onOptionsChange',
                fixedScale: 'onOptionsChange',
                hideXAxis: 'onOptionsChange',
                hideYAxis: 'onOptionsChange',
                hideYAxis1: 'onOptionsChange',
                hideYAxis2: 'onOptionsChange',
                hideYAxis3: 'onOptionsChange',
                hideLegend: 'onOptionsChange',
                hideBorder: 'onOptionsChange',
                disabled: 'onOptionsChange',

                // style change will affect the canvas for drawing
                backgroundColor: 'onOptionsChange',
                series_0_Color: 'onOptionsChange',
                series_1_Color: 'onOptionsChange',
                series_2_Color: 'onOptionsChange',
                series_3_Color: 'onOptionsChange',

                //visible: 'onOptionsChange',
                showPoints: 'onOptionsChange',
                showBars: 'onOptionsChange',
                fill: 'onOptionsChange',
                series_0_Min: 'onOptionsChange',
                series_0_Max: 'onOptionsChange',
                series_1_Min: 'onOptionsChange',
                series_1_Max: 'onOptionsChange',
                series_2_Min: 'onOptionsChange',
                series_2_Max: 'onOptionsChange',
                series_3_Min: 'onOptionsChange',
                series_3_Max: 'onOptionsChange',
                series_0_Units: 'onOptionsChange',
                series_1_Units: 'onOptionsChange',
                series_2_Units: 'onOptionsChange',
                series_3_Units: 'onOptionsChange',
                series_0_Values: 'onValuesChange',
                series_1_Values: 'onValuesChange',
                series_2_Values: 'onValuesChange',
                series_3_Values: 'onValuesChange'
            },

            created: function() {
                this._debugLog("created()");
                this.yAxisFormatter = this._yAxisFormatter.bind(this);
            },

            enteredView: function() {
                this._debugLog("enteredView()");
            },

            ready: function() {
                this._debugLog("ready()");

                // will be called when the instant is ready

                // notify listeners chart is ready so properties can be set
                this.fire("ready");

                // initialize plot options after client set properties
                // use async call to prevent intermittent effects
                this.asyncInitOptions();

            },

            update: function() {
                //console.log("update()");
            },

            attached: function () {
                this.resizableAttachedHandler();
                this.addEventListener("transitionend",function(e){
                    //console.log("transition handler");
                    this.onResize();
                })
            },
            detached:function(){
                this.resizableDetachedHandler();
            },
            eventDelegates: {
                'core-resize': 'onResize'
            },

            _debugLog: function(msg) {
                if(_debug) {
                    console.log(msg);
                }
            },

            getElement : function() {
                return this.$.chart;
            },

            asyncInitOptions: function() {
                var _self = this;

                this.async(function() {
                     _self.initOptions();
                 }, null, 0);
            },
            _isHidden: function(flag){
                var result = "";
                if (flag){
                    result = "display:none";
                }
                return result;
            },
            _yAxisFormatter: function(val, axis) {
                var strColor = 'black';
                var strUnits = undefined;
                var label = axis.options.label;
                if (label !== undefined){
                    switch(label){
                        case 'series0':
                            strColor = this.series_0_Color;
                            strUnits = this.series_0_Units;
                            break;
                        case 'series1':
                            strColor = this.series_1_Color;
                            strUnits = this.series_1_Units;
                            break;
                        case 'series2':
                            strColor = this.series_2_Color;
                            strUnits = this.series_2_Units;
                            break;
                        case 'series3':
                            strColor = this.series_3_Color;
                            strUnits = this.series_3_Units;
                            break;
                    }
                }
                if (strUnits === undefined){
                    strUnits = '';
                }

                var result = val;
                var numDecimals = 0;

                if ((!isNaN(val)) && (val.toString().indexOf('.') > 0)){
                    var strVal = val.toString();

                    numDecimals = strVal.substring(strVal.indexOf('.')+1).length;
                    if (numDecimals > 2){
                        result = val.toFixed(2);
                    }
                }

                if ((val >= axis.max) && (strUnits.length > 0)) {
                    result = result + ' ' + strUnits;
                }
                if (this.numChannels > 1) {
                    result = '<span style="color:' + strColor + ';">' + result + '</span>';
                }
                return result;
            },
            yAxisFormatter: undefined,

            initOptions: function() {
                this._debugLog("initOptions()");

                if(this.$.chart.clientHeight <= 0 || this.$.chart.clientWidth <= 0) {
                    return;
                }


                    this._plotOptions = {
                        xaxes: [ {
                            mode: null,
                        }],
                        yaxes: [ {
                            alignTicksWithAxis: 1,
                            position: "left",
                            zoomRange: null,
                            label: 'series0',
                            tickFormatter: this.yAxisFormatter
                        },
                            {
                                alignTicksWithAxis: 1,
                                position: "right",
                                label: 'series1',
                                tickFormatter: this.yAxisFormatter
                            },
                            {
                                alignTicksWithAxis: 1,
                                position: "right",
                                label: 'series2',
                                tickFormatter: this.yAxisFormatter
                            },
                            {
                                alignTicksWithAxis: 1,
                                position: "right",
                                label: 'series3',
                                tickFormatter: this.yAxisFormatter
                            }
                        ],
                        series: {shadowSize: 0, lines: {show:true}, points: {show:false}, bars: {show:false}},
                        colors: [this.series_0_Color, this.series_1_Color,this.series_2_Color,this.series_3_Color],
                        grid: {borderWidth:2}
                    };
                    //

                if(this.hideXAxis) {
                    this._plotOptions.xaxes[0].show = false;
                }
                if(this.hideYAxis) {
                    this._plotOptions.yaxes[0].show = false;
                    if (this.numChannels > 1){
                        this._plotOptions.yaxes[1].show = false;
                        if (this.numChannels > 2) {
                            this._plotOptions.yaxes[2].show = false;
                            if (this.numChannels > 3) {
                                this._plotOptions.yaxes[3].show = false;
                            }
                        }
                    }
                } else {
                    this._plotOptions.yaxes[0].show = true;
                    if (this.numChannels > 1){
                        this._plotOptions.yaxes[1].show = !this.hideYAxis1;
                        if (this.numChannels > 2) {
                            this._plotOptions.yaxes[2].show = !this.hideYAxis2;
                            if (this.numChannels > 3) {
                                this._plotOptions.yaxes[3].show = !this.hideYAxis3;
                            }
                        }
                    }
                }

                //
                if(this.fixedScale) {

                    this._plotOptions.yaxes[0].min = this.series_0_Min;
                    this._plotOptions.yaxes[0].max = this.series_0_Max;
                    if (this.numChannels > 1){
                        this._plotOptions.yaxes[1].min = this.series_1_Min;
                        this._plotOptions.yaxes[1].max = this.series_1_Max;
                        if (this.numChannels > 2){
                            this._plotOptions.yaxes[2].min = this.series_2_Min;
                            this._plotOptions.yaxes[2].max = this.series_2_Max;
                            if (this.numChannels > 3){
                                this._plotOptions.yaxes[3].min = this.series_3_Min;
                                this._plotOptions.yaxes[3].max = this.series_3_Max;
                            }
                        }
                    }
                }
                    //
                    /*
                     if(this.hideGrid) {
                     this._plotOptions.grid = {show:false};
                     }
                     */
                    if(this.hideBorder) {
                        this._plotOptions.grid.borderWidth = 0;
                    }
                    //
                    if(this.showPoints) {
                        this._plotOptions.series.points.show = true;
                    }
                    else {
                        this._plotOptions.series.points.show = false;
                        this._plotOptions.series.points.radius = 0;
                        this._plotOptions.series.points.lineWidth = 0;
                    }
                    //
                    if(this.showBars) {
                        this._plotOptions.series.bars.show = true;
                        this._plotOptions.series.lines.show = false;
                    }
                    else {
                        this._plotOptions.series.bars.show = false;
                        this._plotOptions.series.lines.show = true;
                    }
                    //
                    if(this.fill) {
                        this._plotOptions.series.lines.fill = true;
                    }
                    //
                    var label0 = undefined;
                    var label1 = undefined;
                    var label2 = undefined;
                    var label3 = undefined;
                    if(!this.hideLegend) {
                        this._plotOptions.legend = { position: "nw", backgroundColor:"null" };
                        label0=this.series_0_Label;
                        label1=this.series_1_Label;
                        label2=this.series_2_Label;
                        label3=this.series_3_Label;
                    }
                    this.preprocessData();
                    switch (this.numChannels){
                        case 1:
                            this._plotObj = $.plot(this.$.chart,[
                                {data: this._dataArray0, label: label0}

                            ], this._plotOptions);
                            break;
                        case 2:
                            this._plotObj = $.plot(this.$.chart,[
                                {data: this._dataArray0, label: label0},
                                {data: this._dataArray1, label: label1, yaxis: 2}
                            ], this._plotOptions);
                            break;
                        case 3:
                            this._plotObj = $.plot(this.$.chart,[
                                {data: this._dataArray0, label: label0, yaxis: 1},
                                {data: this._dataArray1, label: label1, yaxis: 2},
                                {data: this._dataArray2, label: label2, yaxis: 3}
                            ], this._plotOptions);
                            break;
                        case 4:
                            this._plotObj = $.plot(this.$.chart,[
                                {data: this._dataArray0, label: label0, yaxis: 1},
                                {data: this._dataArray1, label: label1, yaxis: 2},
                                {data: this._dataArray2, label: label2, yaxis: 3},
                                {data: this._dataArray3, label: label3, yaxis: 4}
                            ], this._plotOptions);
                            break;
                    }

            },

            reset: function() {
                this._dataArray0 = undefined;
                this._dataArray1 = undefined;
                this._dataArray2 = undefined;
                this._dataArray3 = undefined;
            },

            genXSeries: function(ySeries, start, delta) {
                var darry = [];
                for (var i=0, x=start; i<ySeries.length; i++, x+=delta) {
                      darry.push([x, ySeries[i]]);
                }
                return darry;
            },

            stringToNumberArray: function(str) {
                var result = [];
                var isXY = false;

                if( typeof str !== 'string') {
                    return result;
                }

                var points = str.split(";");
                for(var i=0; i<points.length; i++) {
                    var point = points[i];
                    var xy = point.split(",");
                    if(xy.length > 1) {
                        isXY = true;
                        var x = parseFloat(xy[0]);
                        var y = parseFloat(xy[1]);
                        if( !isNaN(x)  && !isNaN(y) ) {
                            result.push([x,y]);
                        }
                    }
                    else {
                        var y = parseFloat(xy);
                        if( !isNaN(y) ) {
                            result.push(y);
                        }
                    }
                }
                return result;
            },

            preprocessData: function() {
                this._dataArray0 = undefined;
                this._dataArray1 = undefined;
                this._dataArray2 = undefined;
                this._dataArray3 = undefined;

                var varray = undefined;
                if(this.series_0_Values !== undefined) {
                    varray = this.series_0_Values;
                    if( typeof this.series_0_Values === 'string' ) {
                        // string type
                        varray = this.stringToNumberArray(this.series_0_Values);
                    }

                    if(varray.length > 0) {
                        var nElements = varray[0].length;
                        if(nElements === undefined || nElements == 1) {
                            this._dataArray0 = this.genXSeries(varray, 0, 1);
                        }
                        else if(nElements == 2) {
                            this._dataArray0 = varray;
                        }
                        else {
                        }
                    }
                }

                var varray1 = undefined;
                if(this.series_1_Values !== undefined) {
                    varray1 = this.series_1_Values;
                    if( typeof this.series_1_Values === 'string' ) {
                        // string type
                        varray1 = this.stringToNumberArray(this.series_1_Values);
                    }

                    if(varray1.length > 0) {
                        nElements = varray1[0].length;
                        if(nElements === undefined || nElements == 1) {
                            this._dataArray1 = this.genXSeries(varray1, 0, 1);
                        }
                        else if(nElements == 2) {
                            this._dataArray1 = varray1;
                        }
                        else {
                        }
                    }
                }
                var varray2 = undefined;
                if(this.series_2_Values !== undefined) {
                    varray2 = this.series_2_Values;
                    if( typeof this.series_2_Values === 'string' ) {
                        // string type
                        varray2 = this.stringToNumberArray(this.series_2_Values);
                    }

                    if(varray2.length > 0) {
                        nElements = varray2[0].length;
                        if(nElements === undefined || nElements == 1) {
                            this._dataArray2 = this.genXSeries(varray2, 0, 1);
                        }
                        else if(nElements == 2) {
                            this._dataArray2 = varray2;
                        }
                        else {
                        }
                    }
                }
                var varray3 = undefined;
                if(this.series_3_Values !== undefined) {
                    varray3 = this.series_3_Values;
                    if( typeof this.series_3_Values === 'string' ) {
                        // string type
                        varray3 = this.stringToNumberArray(this.series_3_Values);
                    }

                    if(varray3.length > 0) {
                        nElements = varray3[0].length;
                        if(nElements === undefined || nElements == 1) {
                            this._dataArray3 = this.genXSeries(varray3, 0, 1);
                        }
                        else if(nElements == 2) {
                            this._dataArray3 = varray3;
                        }
                        else {
                        }
                    }
                }

            },

            plotData: function() {
                if ((this.disabled)||(!this._plotObj)) {
                    //this.plotDone();
                    return;
                }
                this._debugLog("plotData()");

                this.preprocessData();
                switch(this.numChannels) {
                    case 1:
                        var label0 = undefined;
                        if(!this.hideLegend) {
                            label0 = this.series_0_Label;
                        }
                        //this._plotObj.setData([{data:this.series_0_Values, label:label0}, {data:this.series_1_Values, label:label1, yaxis:2}]);
                        this._plotObj.setData([{data:this._dataArray0, label:label0}]);
                        // recalculate ranges and scale
                        this._plotObj.setupGrid();
                        // draw
                        this._plotObj.draw();
                        break;
                    case 2:
                        var label0 = undefined;
                        var label1 = undefined;
                        if(!this.hideLegend) {
                            label0 = this.series_0_Label;
                            label1 = this.series_1_Label;
                        }
                        //this._plotObj.setData([{data:this.series_0_Values, label:label0}, {data:this.series_1_Values, label:label1, yaxis:2}]);
                        this._plotObj.setData([{data:this._dataArray0, label:label0}, {data:this._dataArray1, label:label1, yaxis:2}]);
                        // recalculate ranges and scale
                        this._plotObj.setupGrid();
                        // draw
                        this._plotObj.draw();
                        break;
                    case 3:
                        var label0 = undefined;
                        var label1 = undefined;
                        var label2 = undefined;
                        if(!this.hideLegend) {
                            label0 = this.series_0_Label;
                            label1 = this.series_1_Label;
                            label2 = this.series_2_Label;
                        }
                        //this._plotObj.setData([{data:this.series_0_Values, label:label0}, {data:this.series_1_Values, label:label1, yaxis:2}]);
                        this._plotObj.setData([{data:this._dataArray0, label:label0},
                            {data:this._dataArray1, label:label1, yaxis:2},
                            {data:this._dataArray2, label:label2, yaxis:3}]);
                        // recalculate ranges and scale
                        this._plotObj.setupGrid();
                        // draw
                        this._plotObj.draw();
                        break;
                    case 4:
                        var label0 = undefined;
                        var label1 = undefined;
                        var label2 = undefined;
                        var label3 = undefined;
                        if(!this.hideLegend) {
                            label0 = this.series_0_Label;
                            label1 = this.series_1_Label;
                            label2 = this.series_2_Label;
                            label3 = this.series_3_Label;
                        }
                        //this._plotObj.setData([{data:this.series_0_Values, label:label0}, {data:this.series_1_Values, label:label1, yaxis:2}]);
                        this._plotObj.setData([{data:this._dataArray0, label:label0},
                            {data:this._dataArray1, label:label1, yaxis:2},
                            {data:this._dataArray2, label:label2, yaxis:3},
                            {data:this._dataArray3, label:label3, yaxis:4}]);
                        // recalculate ranges and scale
                        this._plotObj.setupGrid();
                        // draw
                        this._plotObj.draw();
                        break;
                    default:
                        // for vary channel numbers
                        break;
                }
                //this.plotDone();
            },

            delayPlot: function() {
                // Prevent multiple plot while data is being updated
                if(this._delayingPlot) {
                    //console.log("skip plotting ... " + this._delayingPlot);
                    return;
                }
                this._delayingPlot = true;

                this.job('delayPlot', function() {
                    this.plotData();
                    this._delayingPlot = false;
                }, this._delayPlotWaitTime);
            },

            updateGraph: function() {
                this.plotData();
            },

            plotCounterChanged: function() {
                this._debugLog("plotCounterChanged("+this.plotCounter+")");

                this.plotData();
            },

            onValuesChange: function(oldVal, newVal) {
                if(this._redrawOnValuesChange) {
                    this.delayPlot();
                }
            },

            /*
             series_0_ValuesChanged: function() {
             //console.log("series_0_ValuesChanged()");
             if( typeof this.series_0_Values === 'string' ) {
             this.series_0_Values = this.stringToNumberArray(this.series_0_Values);
             }
             this.onValuesChange();
             },
             series_1_ValuesChanged: function() {
             //console.log("series_1_ValuesChanged()");
             if( typeof this.series_1_Values === 'string' ) {
             this.series_1_Values = this.stringToNumberArray(this.series_1_Values);
             }
             this.onValuesChange();
             },
             */

            onOptionsChange: function(oldVal, newVal, a, b, c) {
                this._debugLog("onOptionsChange()");
                if(this._redrawOnOptionsChange) {
                    // reinitialize options afterward
                    this.asyncInitOptions();
                }
            },

            onResize: function() {
                //console.log("linegraph.onResize");
                this.asyncInitOptions();
            },
            titleLabelChanged: function() {
                this.onResize();
            }
        },Polymer.CoreResizable));
    </script>
</polymer-element>
