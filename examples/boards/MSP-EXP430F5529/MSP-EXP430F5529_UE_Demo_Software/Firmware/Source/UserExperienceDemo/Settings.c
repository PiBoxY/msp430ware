/*******************************************************************************
 *
 *  Settings.c - Demonstrates the different VCore and MCLK settings and their
 *               effect on current consumption.
 *
 *  Copyright (C) 2010 Texas Instruments Incorporated - http://www.ti.com/
 *
 *  Redistribution and use in source and binary forms, with or without
 *  modification, are permitted provided that the following conditions
 *  are met:
 *
 *    Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 *    Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the
 *    distribution.
 *
 *    Neither the name of Texas Instruments Incorporated nor the names of
 *    its contributors may be used to endorse or promote products derived
 *    from this software without specific prior written permission.
 *
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 *  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 *  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 *  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 *  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 *  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 *  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 *  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 ******************************************************************************/

/***************************************************************************//**
 * @file       Settings.c
 * @addtogroup Settings
 * @{
 ******************************************************************************/
#include <stdint.h>
#include "msp430.h"
#include "HAL_Buttons.h"
#include "HAL_Board.h"
#include "HAL_LIS3DH.h"
#include "HAL_Dogs102x6.h"
#include "HAL_Menu.h"
#include "HAL_Wheel.h"
#include "Settings.h"

// This image has been created by ImageDog using 'small_sunglasses.png'
static const uint8_t sunglasses[] =
{
    0x30,    // Image width in pixels
    0x06,    // Image height in rows (1 row = 8 pixels)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x06, 0x1e, 0x1f, 0x3f, 0x7f,
    0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3f, 0x1f, 0x03, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x01, 0x03, 0x03, 0x0f, 0x1e, 0x1c, 0x38, 0x30, 0x70, 0xf8, 0xfc, 0x0e, 0x07, 0xf3, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xc0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0e, 0x1c, 0x3f, 0x7f, 0x7f, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3f, 0x1f, 0x01, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xc0,
    0xc0, 0xc0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x20, 0xf0, 0xf8, 0xf8, 0x3c, 0x0e, 0x07, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// This image has been created by ImageDog using 'lightbulb_outline_inverted_mini.png'
static const uint8_t lightbulb[] =
{
    0x20,    // Image width in pixels
    0x06,    // Image height in rows (1 row = 8 pixels)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x06, 0x0c, 0x18, 0x10, 0x10, 0x10, 0x30, 0x00,
    0x00, 0x00, 0x30, 0x11, 0x11, 0x11, 0x18, 0x0c, 0x04, 0x06, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x04, 0x7c, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x40, 0xe0, 0x30, 0x9d, 0xcf, 0x7f, 0x1e, 0x00, 0x80, 0xfe, 0x1c, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x0c, 0x06, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0x80, 0x01, 0x03, 0x1c, 0x70, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0x78, 0x09, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x09, 0x79, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x5f, 0x00, 0x24, 0x25, 0x25,
    0x25, 0x2d, 0x2d, 0x6d, 0x00, 0x09, 0x7f, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x30, 0x38, 0xa8, 0x2c,
    0x2c, 0x2c, 0x2c, 0x28, 0x30, 0x20, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// This image has been created by ImageDog using 'TI_usb.png'
const uint8_t TIusb[] =
{
    0x66,    // Image width in pixels
    0x08,    // Image height in rows (1 row = 8 pixels)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
    0x01, 0x00, 0x00, 0x0d, 0x0d, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x0e, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xc7, 0xc0, 0x07, 0xff, 0xff, 0xe0, 0x07, 0xc7, 0xcf, 0xff, 0xff,
    0xff, 0xff, 0x0f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x06, 0x06, 0x0d, 0x0d, 0x1b, 0x1b, 0x37, 0x37, 0x6e,
    0x6e, 0xef, 0xc7, 0xc3, 0x81, 0x80, 0x80, 0xc0, 0xc0, 0xc0, 0xe0, 0x60, 0x70, 0x30, 0x38, 0x18,
    0x1c, 0x0c, 0x0e, 0x06, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x80, 0xe0, 0xf0, 0xf8, 0xf8, 0xf0, 0xe0, 0xe0, 0xf0, 0xfc, 0xff, 0x8f, 0x03, 0xe3, 0xe3, 0x83,
    0x03, 0x8f, 0x9e, 0xfc, 0xf8, 0xf0, 0xf0, 0xe0, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x07, 0x06, 0x0e, 0x0c,
    0x1c, 0x18, 0x38, 0x30, 0x73, 0x67, 0xef, 0xcf, 0xde, 0x9c, 0xbc, 0x3c, 0x18, 0x00, 0xc1, 0xe1,
    0xf1, 0xf1, 0xf9, 0xfd, 0x3c, 0x1e, 0x1e, 0x3f, 0xff, 0xff, 0xf7, 0xe3, 0xe1, 0xe1, 0xf1, 0x71,
    0x7b, 0x3f, 0x3f, 0x1f, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x83, 0xe3, 0xff, 0x3f, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xc0, 0xe0, 0xf0, 0xf8, 0xf8, 0xf8, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01,
    0x03, 0x03, 0x06, 0x06, 0x0c, 0x0c, 0x18, 0x18, 0x38, 0x31, 0x71, 0x63, 0xe7, 0xc7, 0xcf, 0x8f,
    0x81, 0x01, 0x30, 0x30, 0x70, 0xf0, 0xf8, 0xf8, 0xbc, 0x1e, 0x9e, 0xcf, 0xef, 0xe7, 0xe3, 0xf3,
    0xf1, 0xf0, 0xf0, 0xe6, 0xe6, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xff, 0x7f, 0x7e, 0x9c, 0x80,
    0xc0, 0xf1, 0xf1, 0xe3, 0xe3, 0xc6, 0xce, 0x8c, 0x9c, 0x19, 0x3b, 0x33, 0x77, 0x66, 0xcc, 0xdc,
    0x98, 0xb8, 0x70, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03,
    0x06, 0x06, 0xfc, 0xfc, 0xcc, 0xec, 0x66, 0x36, 0x3b, 0x1b, 0x1d, 0x0d, 0x06, 0x07, 0x03, 0x83,
    0x81, 0x80, 0x80, 0x80, 0xc0, 0xe0, 0xe0, 0xf0, 0xf0, 0x78, 0x7c, 0x3c, 0x3e, 0x1e, 0x1e, 0x0f,
    0x0f, 0x0f, 0x0e, 0x8e, 0xde, 0xfe, 0xfc, 0xf8, 0x71, 0x01, 0x03, 0x03, 0x87, 0x86, 0x8c, 0x8c,
    0x19, 0x39, 0x33, 0x73, 0x67, 0xe6, 0xcc, 0xdc, 0x98, 0x38, 0x30, 0x70, 0x60, 0xc0, 0xc0, 0x80,
    0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x1d, 0x1e, 0x33, 0x31, 0x61, 0x60,
    0xe0, 0xc0, 0xc0, 0x90, 0x38, 0x7c, 0x78, 0x70, 0x21, 0x03, 0x07, 0x07, 0x07, 0x02, 0x00, 0x80,
    0x80, 0xc1, 0xc1, 0x63, 0x73, 0xb7, 0xbe, 0xde, 0xef, 0x6f, 0x70, 0x38, 0x1f, 0x0f, 0x00, 0x01,
    0x01, 0x03, 0x03, 0x07, 0x06, 0x0e, 0x0c, 0x18, 0x19, 0x31, 0x73, 0x67, 0xe6, 0xce, 0xcc, 0x9c,
    0x98, 0x38, 0x30, 0x60, 0xe0, 0xc0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0,
    0xd8, 0xcc, 0x64, 0x36, 0x9b, 0xc9, 0x6d, 0x26, 0x32, 0x1b, 0x09, 0x0c, 0x07, 0x07, 0x0e, 0x8c,
    0xdc, 0x98, 0x38, 0x31, 0x61, 0x63, 0xc3, 0xc7, 0x86, 0x8e, 0x0c, 0x18, 0x1c, 0x3c, 0xfe, 0xe6,
    0xc6, 0x67, 0xff, 0xfe, 0xc6, 0xcc, 0x8c, 0x98, 0x38, 0x30, 0x70, 0x60, 0xe0, 0xc0, 0x80, 0x80,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0x40, 0x60,
    0xb0, 0xb0, 0xf8, 0xf8, 0x38, 0x30, 0x60, 0x60, 0xc0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const char *const settingsMenuText[] = {
    "=====Settings====",
    "1. Contrast ",
    "2. Backlight ",
    "3. Calibrte Accel ",
    "4. SW Version ",
    "5. LEDs & Logo "
};

// Forward declared functions
void ContrastSetting(void);
void BacklightSetting(void);
void WriteFlashSettings(uint16_t, uint16_t);
void CalibrateAccel(void);
void Version(void);
void LEDTest(void);

/***************************************************************************//**
 * @brief  Displays the settings submenu
 * @param  none
 * @return none
 ******************************************************************************/

void Settings(void)
{
    uint8_t selection = 0;

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
    while (!(buttonsPressed & BUTTON_S2))
    {
        selection = Menu_active((char **)settingsMenuText, 5);
        if (buttonsPressed & BUTTON_S2) break;
        switch (selection)
        {
            case 1: ContrastSetting(); break;
            case 2: BacklightSetting(); break;
            case 3: CalibrateAccel(); break;
            case 4: Version(); break;
            case 5: LEDTest(); break;
            default: break;
        }
    }
    buttonsPressed = 0;
    Dogs102x6_clearScreen();
}

/***************************************************************************//**
 * @brief  Allows the user to adjust the contrast
 * @param  none
 * @return none
 ******************************************************************************/

void ContrastSetting(void)
{
    uint8_t contrast = *((unsigned char *)contrastSetpointAddress);

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
    Dogs102x6_stringDraw(0, 0, " Adjust contrast ", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(1, 0, "by turning wheel.", DOGS102x6_DRAW_NORMAL);

    Dogs102x6_imageDraw(sunglasses, 2, 27);
    __delay_cycles(10000000); //delay for user to read directions

    while (!buttonsPressed)
    {
        contrast = Wheel_getValue() / 130;
        Dogs102x6_setContrast(contrast);
    }

    WriteFlashSettings(contrast, contrastSetpointAddress);

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
}

/***************************************************************************//**
 * @brief  Allows the user to adjust the backlight brightness
 * @param  none
 * @return none
 ******************************************************************************/

void BacklightSetting(void)
{
    uint8_t brightness = *((unsigned char *)brightnessSetpointAddress);

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
    Dogs102x6_stringDraw(0, 0, "Adjust brightness", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(1, 0, "by turning wheel.", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_imageDraw(lightbulb, 2, 35);

    while (!buttonsPressed)
    {
        brightness = Wheel_getValue() / 340;
        if (brightness > 12)
            brightness = 12;
        Dogs102x6_setBacklight(brightness);
    }

    WriteFlashSettings(brightness, brightnessSetpointAddress);

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
}

/***************************************************************************//**
 * @brief  Calibrates the Accelerometer
 * @param  none
 * @return none
 ******************************************************************************/

void CalibrateAccel(void)
{
    uint8_t i;

    uint16_t LIS3DH_xAccel_offset;
    uint16_t LIS3DH_yAccel_offset;
    uint16_t LIS3DH_zAccel_offset;

    static const char *const AccelCalibrateText[] = {
        "**    Accel    **",
        "*  Calibration  *",
        "",
        " Place Board on  ",
        "  Flat Surface   ",
        "",
        "",
        "    Press S1     "
    };

    buttonsPressed = 0;
    Dogs102x6_clearScreen();

    // Initialize accelerometer
    LIS3DH_init();

    for (i = 0; i < 8; i++){
        Dogs102x6_stringDraw(i, 0, (char *)AccelCalibrateText[i], DOGS102x6_DRAW_NORMAL);
    }

    while (!buttonsPressed)
    {
        // Wait in low power mode 3 until a button is pressed
        __bis_SR_register(LPM3_bits + GIE);
    }

    LIS3DH_xAccel_offset = LIS3DH_readRegister(OUTX);    // Read to get x-Offset
    LIS3DH_yAccel_offset = -(LIS3DH_readRegister(OUTY)); // Read to get y-Offset
    LIS3DH_zAccel_offset = LIS3DH_readRegister(OUTZ);    // Read to get z-Offset

    // Store new offsets in memory
    LIS3DH_setAccel_offset(LIS3DH_xAccel_offset,
                            LIS3DH_yAccel_offset,
                            LIS3DH_zAccel_offset);

    // Write offsets to flash memory
    WriteFlashSettings(LIS3DH_xAccel_offset, accelXcalibrationAddress);
    WriteFlashSettings(LIS3DH_yAccel_offset, accelYcalibrationAddress);
    WriteFlashSettings(LIS3DH_zAccel_offset, accelZcalibrationAddress);

    buttonsPressed = 0;
    Dogs102x6_clearScreen();

    // Disable accelerometer
    LIS3DH_disable();
}

/***************************************************************************//**
 * @brief  Displays the SW Version and other info
 * @param  none
 * @return none
 ******************************************************************************/

void Version(void)
{
    buttonsPressed = 0;
    Dogs102x6_clearScreen();
    Dogs102x6_stringDraw(1, 0, "     Current     ", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(2, 0, "     Firmware    ", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(3, 0, "     Version     ", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(5, 38, (char *)SoftwareMajorVersion, DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(5, 44, ".", DOGS102x6_DRAW_NORMAL);
    Dogs102x6_stringDraw(5, 52, (char *)SoftwareMinorVersion, DOGS102x6_DRAW_NORMAL);

    // Wait for button press
    while (!buttonsPressed)
    {
        // Wait in low power mode 3 until a button is pressed
        __bis_SR_register(LPM3_bits + GIE);
    }

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
}

/***************************************************************************//**
 * @brief  Tests the LEDs
 * @param  none
 * @return none
 ******************************************************************************/

void LEDTest(void)
{
    buttonsPressed = 0;
    Dogs102x6_clearScreen();
    Dogs102x6_imageDraw(TIusb, 0, 0);

    Board_ledOn(LED_ALL);

    // Wait for button press
    while (!buttonsPressed)
    {
        // Wait in low power mode 3 until a button is pressed
        __bis_SR_register(LPM3_bits + GIE);
    }

    Board_ledOff(LED_ALL);

    buttonsPressed = 0;
    Dogs102x6_clearScreen();
}

/***************************************************************************//**
 * @brief  Writes the settings to flash
 * @param  Data to be written, and offset
 * @return none
 ******************************************************************************/

void WriteFlashSettings(uint16_t Data, uint16_t Address)
{
    uint16_t * Flash_ptr;                   // Initialize Flash pointer
    uint16_t Flash_Contents[16];            // Store Contents of Flash before Programming
    uint8_t i;

    Flash_ptr = (uint16_t *)(0x1880);       // Info C

    for (i = 0; i < 16; i++)                // We know that we will only use > 8 variables in Info C
    {
        Flash_Contents[i] = *Flash_ptr;     // Read a word from flash
        if (Flash_ptr == (uint16_t *)Address)
            Flash_Contents[i] = Data;
        *Flash_ptr++;
    }


    Flash_ptr = (uint16_t *)(0x1880);       // Info C
    FCTL3 = FWKEY;                          // Clear Lock bit
    FCTL1 = FWKEY + ERASE;                  // Set Erase bit
    *Flash_ptr = 0;                         // Dummy write to erase Flash seg
    FCTL1 = FWKEY + WRT;                    // Set WRT bit for write operation

    for (i = 0; i < 16; i++)
    {
        *Flash_ptr++ = Flash_Contents[i];   // Write a word to flash
    }

    FCTL1 = FWKEY;                          // Clear WRT bit
    FCTL3 = FWKEY + LOCK;                   // Set LOCK bit
}

/***************************************************************************//**
 * @}
 ******************************************************************************/
